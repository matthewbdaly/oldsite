<!doctype html><html amp lang="en"><head><meta charset="utf-8"><title>Django Blog Tutorial - the Next Generation - Part 4 - Matthew Daly&#x27;s Blog</title><link rel="canonical" href="https://matthewdaly.co.uk/blog/2014/02/15/django-blog-tutorial-the-next-generation-part-4/"><link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="/rss.xml"><link href="/favicon.ico" rel="icon"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#252525"><script type="application/ld+json">{
         "@context": "http://schema.org",
         "@type": "BlogPosting",
         "mainEntityOfPage": "https://matthewdaly.co.uk/blog/2014/02/15/django-blog-tutorial-the-next-generation-part-4/",
         "headline": "Django Blog Tutorial - the Next Generation - Part 4",
         "datePublished": "2014-02-15T17:45:00.000Z",
         "dateModified": "2014-02-15T17:45:00.000Z",
         "description": "&lt;p&gt;Hello again! As promised, in this instalment we’ll implement categories and tags, as well as an R...",
         "author": {
              "@type": "Person",
              "name": "Matthew Daly"
         },
         "publisher": {
            "@type": "Organization",
            "name": "Matthew Daly&#x27;s Blog",
            "logo": {
               "@type": "ImageObject",
               "url": "https://matthewdaly.co.uk/favicon.ico",
               "height": 16,
               "width": 16
            }
         },
         "image": {
            "@type": "ImageObject",
            "url": "https://matthewdaly.co.uk/logo.png",
            "height": 120,
            "width": 1200
         }
      }</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link href="https://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet" type="text/css"><style amp-custom>body {
   background-color: #252525;
}
      div.container {
         background-color: #f8f8f8;
         width: 100%;
      }
      p, h1, h2, h3, h4, h5, h6, li, nav a {
         font-family: "PT Serif","Georgia","Helvetica Neue",Arial,sans-serif;
         text-rendering: optimizelegibility;
      }
      p, li {
         font-size: 1.4em;
         line-height: 1.5em;
      }
      header {
         padding: 20px;
         color: #505050;
      }
      header h1 {
         font-size: 3em;
         line-height: 1.2em;
         color: #7f7f7f;
      }
      header h2 {
         font-size: 1.5em;
         color: #7f7f7f;
      }
      h1 a {
         text-decoration: none;
         color: #7f7f7f;
      }
      code {
         white-space: pre-wrap;
         word-wrap: break-word;
         font-family: Menlo, Monaco, "Andale Mono", "Ubuntu Mono", "lucida console", monospace;
         background-color: #cfcfcf;
         padding: 5px;
         border-radius: 3px;
      }
      pre {
         white-space: pre-wrap;
         word-wrap: break-word;
      }
      pre code {
         display: block;
         overflow-wrap: normal;
         word-wrap: normal;
         white-space: pre;
         font-size: 1.2em;
      }
      article {
         padding: 20px;
      }
      section {
         margin-top: 10px;
         margin-bottom: 10px;
      }
      amp-img {
         background-color: gray;
         border: 1px solid black;
      }
      .hljs {
         display: block;
         overflow-x: auto;
         padding: 0.5em;
         background: #474949;
         color: #d1d9e1;
      }
      .hljs-comment,
      .hljs-quote {
         color: #969896;
         font-style: italic;
      }
      .hljs-keyword,
      .hljs-selector-tag,
      .hljs-literal,
      .hljs-type,
      .hljs-addition {
         color: #cc99cc;
      }
      .hljs-number,
      .hljs-selector-attr,
      .hljs-selector-pseudo {
         color: #f99157;
      }
      .hljs-string,
      .hljs-doctag,
      .hljs-regexp {
         color: #8abeb7;
      }
      .hljs-title,
      .hljs-name,
      .hljs-section,
      .hljs-built_in {
         color: #b5bd68;
      }
      .hljs-variable,
      .hljs-template-variable,
      .hljs-selector-id,
      .hljs-class .hljs-title {
         color: #ffcc66;
      }
      .hljs-section,
      .hljs-name,
      .hljs-strong {
         font-weight: bold;
      }
      .hljs-symbol,
      .hljs-bullet,
      .hljs-subst,
      .hljs-meta,
      .hljs-link {
         color: #f99157;
      }
      .hljs-deletion {
         color: #dc322f;
      }
      .hljs-formula {
         background: #eee8d5;
      }
      .hljs-attr,
      .hljs-attribute {
         color: #81a2be;
      }
      .hljs-emphasis {
         font-style: italic;
      }
      ul.categories {
         padding-left: 0px;
         margin-bottom: 20px;
      }
      ul.categories li {
         list-style-type: none;
         display: inline-block;
         margin-right: 20px;
      }
      ul.categories li a {
         background-color: #303030;
         border-radius: 3px;
         padding: 3px;
         color: #fff;
         text-decoration: none;
      }
      a.commentlink, a.postlink {
         background-color: #303030;
         border-radius: 3px;
         padding: 3px;
         color: #fff;
         text-decoration: none;
      }
      blockquote {
         font-style: italic;
         border-left: 2px solid #cfcfcf;
      }
      blockquote p {
         font-size: 2.2em;
      }</style><script async src="https://cdn.ampproject.org/v0.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script></head><body><header><h1><a href="/">Matthew Daly&#x27;s Blog</a></h1><h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2></header><div class="container"><div class="row"><div class="col-md-8"><article class="post"><p class="date">15th February 2014 5:45 pm</p><h1>Django Blog Tutorial - the Next Generation - Part 4</h1><p>Hello again! As promised, in this instalment we’ll implement categories and tags, as well as an RSS feed.</p><p>As usual, we need to switch into our virtualenv:</p><pre><code class="hljs lang-bash">$ <span class="hljs-built_in">source</span> venv/bin/activate
</code></pre><h2 id="categories">Categories</h2><p>It’s worth taking a little time at this point to set out what we mean by categories and tags in this case, as the two can be very similar. In this case, we’ll use the following criteria:</p><ul><li>A post can have only one category, or none, but a category can be applied to any number of posts</li><li>A post can have any number of tags, and a tag can be applied to any number of posts</li></ul><p>If you’re not too familiar with relational database theory, the significance of this may not be apparent, so here’s a quick explanation. Because the categories are limited to one per post, the relationship between a post and a category is known as <em>one-to-many</em>. In other words, one post can only have one category, but one category can have many posts. You can therefore define the categories in one table in your database, and refer to them by their ID (the reference to the category in the post table is referred to as a <em>foreign key</em>).</p><p>As usual, we will write a test first. Open up <code>blogengine/tests.py</code> and edit the line importing the <code>Post</code> model as follows:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category
</code></pre><p>Also, add the following method before <code>test_create_post</code>:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()

        <span class="hljs-comment"># Add attributes</span>
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>

        <span class="hljs-comment"># Save it</span>
        category.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
        only_category = all_categories[<span class="hljs-number">0</span>]
        self.assertEquals(only_category, category)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_category.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_category.description, <span class="hljs-string">'The Python programming language'</span>)
</code></pre><p>This test checks that we can create categories. But categories aren’t much use unless we can actually apply them to our posts. So we need to edit our <code>Post</code> model as well, and to do so we need to have a test in place first. Edit the <code>test_create_post</code> method as follows:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()

        <span class="hljs-comment"># Set the attributes</span>
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category

        <span class="hljs-comment"># Save it</span>
        post.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)
        self.assertEquals(only_post.slug, <span class="hljs-string">'my-first-post'</span>)
        self.assertEquals(only_post.site.name, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.site.domain, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.pub_date.day, post.pub_date.day)
        self.assertEquals(only_post.pub_date.month, post.pub_date.month)
        self.assertEquals(only_post.pub_date.year, post.pub_date.year)
        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)
        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)
        self.assertEquals(only_post.pub_date.second, post.pub_date.second)
        self.assertEquals(only_post.author.username, <span class="hljs-string">'testuser'</span>)
        self.assertEquals(only_post.author.email, <span class="hljs-string">'user@example.com'</span>)
        self.assertEquals(only_post.category.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_post.category.description, <span class="hljs-string">'The Python programming language'</span>)
</code></pre><p>What we’re doing here is adding a <code>category</code> attribute to the posts. This attribute contains a reference to a <code>Category</code> object.</p><p>Now, we also want to test adding, editing, and deleting a category from the admin interface. Add this code to the <code>AdminTest</code> class:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/category/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/add/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
            },
            follow=<span class="hljs-literal">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new category now in database</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/1/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
            }, follow=<span class="hljs-literal">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check category amended</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">1</span>)
        only_category = all_categories[<span class="hljs-number">0</span>]
        self.assertEquals(only_category.name, <span class="hljs-string">'perl'</span>)
        self.assertEquals(only_category.description, <span class="hljs-string">'The Perl programming language'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_category</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the category</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/category/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-literal">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check category deleted</span>
        all_categories = Category.objects.all()
        self.assertEquals(len(all_categories), <span class="hljs-number">0</span>) 
</code></pre><p>This is very similar to the prior code for the posts, and just checks we can create categories via the admin. We also need to check we can apply these categories to posts, and that they don’t break the existing tests:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-literal">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-literal">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.site = site
        post.author = author
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-literal">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post deleted</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)
</code></pre><p>Here we basically take our existing post tests in the admin interface and add the category to them. Finally, we edit the <code>PostViewTest</code> class to include categories:</p><pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Fetch the index</span>
        response = self.client.get(<span class="hljs-string">'/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_post_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the post URL</span>
        post_url = only_post.get_absolute_url()

        <span class="hljs-comment"># Fetch the post</span>
        response = self.client.get(post_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre><p>Now it’s time to run our tests:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
E
======================================================================
ERROR: blogengine.tests (unittest.loader.ModuleImportFailure)
----------------------------------------------------------------------
ImportError: Failed to import <span class="hljs-built_in">test</span> module: blogengine.tests
Traceback (most recent call last):
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line 254, <span class="hljs-keyword">in</span> _find_tests
    module = self._get_module_from_name(name)
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line 232, <span class="hljs-keyword">in</span> _get_module_from_name
    __import__(name)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 3, <span class="hljs-keyword">in</span> &lt;module&gt;
    from blogengine.models import Post, Category
ImportError: cannot import name Category


----------------------------------------------------------------------
Ran 1 <span class="hljs-built_in">test</span> <span class="hljs-keyword">in</span> 0.000s

FAILED (errors=1)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>This is the expected result. We need to create our Category model. So let’s do that:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site

<span class="hljs-comment"># Create your models here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Category</span><span class="hljs-params">(models.Model)</span>:</span>
    name = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField()


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-literal">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-literal">True</span>, null=<span class="hljs-literal">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre><p>Note that we add <code>Category</code> before <code>Post</code> - this is because <code>Category</code> is a foreign key in <code>Post</code>, and must be defined in order to be used. Also, note that we add the <code>category</code> attribute as a <code>ForeignKey</code> field, like <code>User</code> and <code>Site</code>, indicating that it is an item in another table being references.</p><p>We also allow for <code>category</code> to be blank or null, so the user does not have to apply a category if they don’t wish to.</p><p>If we run our tests, they should still fail:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
EEFEEEEE...EE
======================================================================
ERROR: test_create_category (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 20, <span class="hljs-keyword">in</span> test_create_category
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: test_create_post (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 37, <span class="hljs-keyword">in</span> test_create_post
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: test_create_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 215, <span class="hljs-keyword">in</span> test_create_post
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: test_delete_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 192, <span class="hljs-keyword">in</span> test_delete_category
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: test_delete_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 304, <span class="hljs-keyword">in</span> test_delete_post
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: test_edit_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 165, <span class="hljs-keyword">in</span> test_edit_category
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: test_edit_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 250, <span class="hljs-keyword">in</span> test_edit_post
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: test_index (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 353, <span class="hljs-keyword">in</span> test_index
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
ERROR: test_post_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 403, <span class="hljs-keyword">in</span> test_post_page
    category.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_category

======================================================================
FAIL: test_create_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 142, <span class="hljs-keyword">in</span> test_create_category
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

----------------------------------------------------------------------
Ran 13 tests <span class="hljs-keyword">in</span> 3.393s

FAILED (failures=1, errors=9)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>The category table hasn’t yet been created, so we need to use South to create and run the migrations:</p><pre><code class="hljs lang-bash">$ python manage.py schemamigration --auto blogengine
$ python manage.py migrate
</code></pre><p>If we then run our tests again, some of them will still fail:</p><pre><code class="hljs lang-bash">Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..F.F.F......
======================================================================
FAIL: test_create_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 142, <span class="hljs-keyword">in</span> test_create_category
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

======================================================================
FAIL: test_delete_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 201, <span class="hljs-keyword">in</span> test_delete_category
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

======================================================================
FAIL: test_edit_category (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 175, <span class="hljs-keyword">in</span> test_edit_category
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

----------------------------------------------------------------------
Ran 13 tests <span class="hljs-keyword">in</span> 4.047s

FAILED (failures=3)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>That’s because we haven’t registered the categories in the admin. So, that’s our next job:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostAdmin</span><span class="hljs-params">(admin.ModelAdmin)</span>:</span>
    prepopulated_fields = {<span class="hljs-string">"slug"</span>: (<span class="hljs-string">"title"</span>,)}
    exclude = (<span class="hljs-string">'author'</span>,)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_model</span><span class="hljs-params">(self, request, obj, form, change)</span>:</span>
        obj.author = request.user
        obj.save()

admin.site.register(models.Category)
admin.site.register(models.Post, PostAdmin)
</code></pre><p>Now we try again:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.............
----------------------------------------------------------------------
Ran 13 tests <span class="hljs-keyword">in</span> 4.092s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>It passes! Let’s do a quick sense check before committing. Run the server:</p><pre><code class="hljs lang-bash">$ python manage.py runserver
</code></pre><p>If you visit the <a href="http://127.0.0.1:8000/admin/">admin</a>, you’ll see the text for category is <code>Categorys</code>, which is incorrect. We also don’t have a good representation of the category in the admin. Let’s fix that:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site

<span class="hljs-comment"># Create your models here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Category</span><span class="hljs-params">(models.Model)</span>:</span>
    name = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.name

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        verbose_name_plural = <span class="hljs-string">'categories'</span>


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-literal">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-literal">True</span>, null=<span class="hljs-literal">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre><p>Let’s commit our changes:</p><pre><code class="hljs lang-bash">$ git add blogengine/
$ git commit -m <span class="hljs-string">'Implemented categories'</span>
</code></pre><p>Now, as yet our categories don’t actually do all that much. We would like to be able to:</p><ul><li>List all posts under a category</li><li>Show the post category at the base of the post</li></ul><p>So, let’s implement that. First, as usual, we implement tests first:</p><pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Fetch the index</span>
        response = self.client.get(<span class="hljs-string">'/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post category is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_post_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the post URL</span>
        post_url = only_post.get_absolute_url()

        <span class="hljs-comment"># Fetch the post</span>
        response = self.client.get(post_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post category is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre><p>All we do here is assert that for both the post pages and the index, the text from the category name is shown in the response. We also need to check the category-specific route works. Add this method to <code>PostViewTest</code>:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_category_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the category URL</span>
        category_url = post.category.get_absolute_url()

        <span class="hljs-comment"># Fetch the category</span>
        response = self.client.get(category_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the category name is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre><p>This is very similar to the previous tests, but fetches the absolute URL for the category, and ensures the category name and post content are shown. Now, let’s run our new tests:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
...........EFF
======================================================================
ERROR: test_category_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 494, <span class="hljs-keyword">in</span> test_category_page
    category_url = post.category.get_absolute_url()
AttributeError: <span class="hljs-string">'Category'</span> object has no attribute <span class="hljs-string">'get_absolute_url'</span>

======================================================================
FAIL: test_index (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 391, <span class="hljs-keyword">in</span> test_index
    self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: test_post_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 446, <span class="hljs-keyword">in</span> test_post_page
    self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

----------------------------------------------------------------------
Ran 14 tests <span class="hljs-keyword">in</span> 5.017s

FAILED (failures=2, errors=1)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>Let’s take a look at why they failed. <code>test_category_page</code> failed because the <code>Category</code> object had no method <code>get_absolute_url</code>. So we need to implement one. To do so, we really need to add a slug field, like the posts already have. Ideally, we want this to be populated automatically, but with the option to create one manually. So, edit the models as follows:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> django.contrib.sites.models <span class="hljs-keyword">import</span> Site
<span class="hljs-keyword">from</span> django.utils.text <span class="hljs-keyword">import</span> slugify

<span class="hljs-comment"># Create your models here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Category</span><span class="hljs-params">(models.Model)</span>:</span>
    name = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-literal">True</span>, blank=<span class="hljs-literal">True</span>, null=<span class="hljs-literal">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.slug:
            self.slug = slugify(unicode(self.name))
        super(Category, self).save()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/category/%s/"</span> % (self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.name

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        verbose_name_plural = <span class="hljs-string">'categories'</span>


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-literal">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-literal">True</span>, null=<span class="hljs-literal">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre><p>We’re adding the <code>slug</code> attribute to the <code>Category</code> model here. However, we’re also overriding the <code>save</code> method to detect if the slug is set, and if not, to create a slug using the <code>slugify</code> function, and set it as the category’s slug. We also define an absolute URL for the category.</p><p>Now, if you run the tests, they will fail because we haven’t made the changes to the database. So, we use South again:</p><pre><code class="hljs lang-bash">$ python manage.py schemamigration --auto blogengine
</code></pre><p>Then run the migration:</p><pre><code class="hljs lang-bash">$ python manage.py migrate
</code></pre><p>Now, running our tests will show that the tables are in place, but we still have some work to do. The index and post pages don’t show our categories, so we’ll fix that. First, we’ll fix our post list:</p><pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">extends</span></span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">load</span></span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">block</span></span> content %}</span><span class="xml">
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">for</span></span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span><span class="hljs-template-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span></span><span class="hljs-template-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        </span><span class="hljs-template-variable">{{ post.text|custom_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span><span class="hljs-template-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %}</span><span class="xml">

        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">if</span></span> page_obj.has_previous %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/</span></span></span><span class="hljs-template-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endif</span></span> %}</span><span class="xml">
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">if</span></span> page_obj.has_next %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/</span></span></span><span class="hljs-template-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endif</span></span> %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %}</span><span class="xml"></span>
</code></pre><p>Next, we’ll take care of our post detail page:</p><pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">extends</span></span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">load</span></span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">block</span></span> content %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span></span><span class="hljs-template-variable">{{ object.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span></span><span class="hljs-template-variable">{{ object.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        </span><span class="hljs-template-variable">{{ object.text|custom_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ object.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span><span class="hljs-template-variable">{{ object.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Comments<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fb-comments"</span> <span class="hljs-attr">data-href</span>=<span class="hljs-string">"http://</span></span></span><span class="hljs-template-variable">{{ post.site }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string"></span></span></span><span class="hljs-template-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">data-width</span>=<span class="hljs-string">"470"</span> <span class="hljs-attr">data-num-posts</span>=<span class="hljs-string">"10"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %}</span><span class="xml"></span>
</code></pre><p>Note that in both cases we include a link to the category URL.</p><p>Now, we should only have one failing test outstanding - the category page. For this, generic views aren’t sufficient as we need to limit the queryset to only show those posts with a specific category. Fortunately, we can extend Django’s generic views to add this functionality. First, we edit our URLconfs:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, url
<span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView, DetailView
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category
<span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView

urlpatterns = patterns(<span class="hljs-string">''</span>,
    <span class="hljs-comment"># Index</span>
    url(<span class="hljs-string">r'^(?P&lt;page&gt;\d+)?/?$'</span>, ListView.as_view(
        model=Post,
        paginate_by=<span class="hljs-number">5</span>,
        )),

    <span class="hljs-comment"># Individual posts</span>
    url(<span class="hljs-string">r'^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, DetailView.as_view(
        model=Post,
        )),

    <span class="hljs-comment"># Categories</span>
    url(<span class="hljs-string">r'^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryListView.as_view(
        paginate_by=<span class="hljs-number">5</span>,
        model=Category,
        )),
)
</code></pre><p>Note we import a new view from <code>blogengine.views</code> called <code>CategoryListView</code>. Next, we create that listview:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render
<span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Category, Post

<span class="hljs-comment"># Create your views here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryListView</span><span class="hljs-params">(ListView)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
        <span class="hljs-keyword">try</span>:
            category = Category.objects.get(slug=slug)
            <span class="hljs-keyword">return</span> Post.objects.filter(category=category)
        <span class="hljs-keyword">except</span> Category.DoesNotExist:
            <span class="hljs-keyword">return</span> Post.objects.none()
</code></pre><p>This is quite simple. We import the <code>ListView</code>, as well as our models. Then we extend <code>ListView</code> by getting the slug from the request, fetching the appropriate category, and returning only those posts that have that category. If the category does not exist, we return the empty <code>Post</code> object list. We haven’t had to set the template manually as it is inherited from <code>ListView</code>.</p><p>If you run the tests, they should now pass:</p><pre><code class="hljs lang-bash">Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..............
----------------------------------------------------------------------
Ran 14 tests <span class="hljs-keyword">in</span> 5.083s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>So let’s commit our changes:</p><pre><code class="hljs lang-bash">$ git add blogengine/ templates/
$ git commit -m <span class="hljs-string">'Categories are now shown'</span>
</code></pre><h2 id="tags">Tags</h2><p>Tags are fairly similar to categories, but more complex. The relationship they have is called <em>many-to-many</em> - in other words, a tag can be applied to many posts, and one post can have many tags. This is more difficult to model with a relational database. The usual way to do so is to create an intermediate table between the posts and tags, to identify mappings between the two. Fortunately, Django makes this quite easy.</p><p>Let’s write the tests for our tagging system. As with the categories, we’ll write the tests for creating and editing them first, and add in tests for them being visible later. First we’ll create a test for creating a new tag object:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()

        <span class="hljs-comment"># Add attributes</span>
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>

        <span class="hljs-comment"># Save it</span>
        tag.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
        only_tag = all_tags[<span class="hljs-number">0</span>]
        self.assertEquals(only_tag, tag)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_tag.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_tag.description, <span class="hljs-string">'The Python programming language'</span>)
</code></pre><p>Next, we’ll amend the test for creating a post to include tags:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()

        <span class="hljs-comment"># Set the attributes</span>
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category

        <span class="hljs-comment"># Save it</span>
        post.save()

        <span class="hljs-comment"># Add the tag</span>
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Check attributes</span>
        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)
        self.assertEquals(only_post.slug, <span class="hljs-string">'my-first-post'</span>)
        self.assertEquals(only_post.site.name, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.site.domain, <span class="hljs-string">'example.com'</span>)
        self.assertEquals(only_post.pub_date.day, post.pub_date.day)
        self.assertEquals(only_post.pub_date.month, post.pub_date.month)
        self.assertEquals(only_post.pub_date.year, post.pub_date.year)
        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)
        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)
        self.assertEquals(only_post.pub_date.second, post.pub_date.second)
        self.assertEquals(only_post.author.username, <span class="hljs-string">'testuser'</span>)
        self.assertEquals(only_post.author.email, <span class="hljs-string">'user@example.com'</span>)
        self.assertEquals(only_post.category.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_post.category.description, <span class="hljs-string">'The Python programming language'</span>)

        <span class="hljs-comment"># Check tags</span>
        post_tags = only_post.tags.all()
        self.assertEquals(len(post_tags), <span class="hljs-number">1</span>)
        only_post_tag = post_tags[<span class="hljs-number">0</span>]
        self.assertEquals(only_post_tag, tag)
        self.assertEquals(only_post_tag.name, <span class="hljs-string">'python'</span>)
        self.assertEquals(only_post_tag.description, <span class="hljs-string">'The Python programming language'</span>)
</code></pre><p>Note the difference in how we apply the tags. Because a post can have more than one tag, we can’t just define <code>post.tag</code> in the same way. Instead, we have <code>post.tags</code>, which you can think of as a list, and we use the <code>add</code> method to add a new tag. Note also that the post must already exist before we can add a tag.</p><p>We also need to create acceptance tests for creating, editing and deleting tags:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/add/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'python'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Python programming language'</span>
            },
            follow=<span class="hljs-literal">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new tag now in database</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/1/'</span>, {
            <span class="hljs-string">'name'</span>: <span class="hljs-string">'perl'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The Perl programming language'</span>
            }, follow=<span class="hljs-literal">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check tag amended</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">1</span>)
        only_tag = all_tags[<span class="hljs-number">0</span>]
        self.assertEquals(only_tag.name, <span class="hljs-string">'perl'</span>)
        self.assertEquals(only_tag.description, <span class="hljs-string">'The Perl programming language'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_tag</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the tag</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/tag/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-literal">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check tag deleted</span>
        all_tags = Tag.objects.all()
        self.assertEquals(len(all_tags), <span class="hljs-number">0</span>)
</code></pre><p>These tests are virtually identical to those for the <code>Category</code> objects, as we plan for our <code>Tag</code> objects to be very similar. Finally, we need to amend the acceptance tests for <code>Post</code> objects to include a tag:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Check response code</span>
        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Create the new post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-first-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'tags'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-literal">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check added successfully</span>
        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check new post now in database</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Edit the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/'</span>, {
            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,
            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,
            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,
            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span>,
            <span class="hljs-string">'slug'</span>: <span class="hljs-string">'my-second-post'</span>,
            <span class="hljs-string">'site'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'category'</span>: <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'tags'</span>: <span class="hljs-string">'1'</span>
        },
        follow=<span class="hljs-literal">True</span>
        )
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check changed successfully</span>
        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post amended</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)
        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.site = site
        post.author = author
        post.category = category
        post.save()
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Log in</span>
        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)

        <span class="hljs-comment"># Delete the post</span>
        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/delete/'</span>, {
            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span>
        }, follow=<span class="hljs-literal">True</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check deleted successfully</span>
        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check post deleted</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)
</code></pre><p>Here we’re just adding tags to our <code>Post</code> objects.</p><p>Now it’s time to run our tests to make sure they fail as expected:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
E
======================================================================
ERROR: blogengine.tests (unittest.loader.ModuleImportFailure)
----------------------------------------------------------------------
ImportError: Failed to import <span class="hljs-built_in">test</span> module: blogengine.tests
Traceback (most recent call last):
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line 254, <span class="hljs-keyword">in</span> _find_tests
    module = self._get_module_from_name(name)
  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line 232, <span class="hljs-keyword">in</span> _get_module_from_name
    __import__(name)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 3, <span class="hljs-keyword">in</span> &lt;module&gt;
    from blogengine.models import Post, Category, Tag
ImportError: cannot import name Tag


----------------------------------------------------------------------
Ran 1 <span class="hljs-built_in">test</span> <span class="hljs-keyword">in</span> 0.000s

FAILED (errors=1)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>So here we can’t import our <code>Tag</code> model, because we haven’t created it. So, we’ll do that:</p><pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tag</span><span class="hljs-params">(models.Model)</span>:</span>
    name = models.CharField(max_length=<span class="hljs-number">200</span>)
    description = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-literal">True</span>, blank=<span class="hljs-literal">True</span>, null=<span class="hljs-literal">True</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.slug:
            self.slug = slugify(unicode(self.name))
        super(Tag, self).save()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/tag/%s/"</span> % (self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.name
</code></pre><p>Our <code>Tag</code> model is very much like our <code>Category</code> model, but we don’t need to change the <code>verbose_name_plural</code> value, and we amend the absolute URL to show it as a tag rather than a category.</p><p>We also need to amend our <code>Post</code> model to include a <code>tags</code> field:</p><pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    pub_date = models.DateTimeField()
    text = models.TextField()
    slug = models.SlugField(max_length=<span class="hljs-number">40</span>, unique=<span class="hljs-literal">True</span>)
    author = models.ForeignKey(User)
    site = models.ForeignKey(Site)
    category = models.ForeignKey(Category, blank=<span class="hljs-literal">True</span>, null=<span class="hljs-literal">True</span>)
    tags = models.ManyToManyField(Tag)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_absolute_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/%s/%s/%s/"</span> % (self.pub_date.year, self.pub_date.month, self.slug)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unicode__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.title

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        ordering = [<span class="hljs-string">"-pub_date"</span>]
</code></pre><p>Note that <code>tags</code> is a <code>ManyToManyField</code>, and we pass through the model we wish to use, much like we did with the categories. The difference is that one tag can be applied to many posts and a post can have many tags, so we need an intermediate database table to handle the relationship between the two. With Django’s ORM we can handle this quickly and easily.</p><p>Run our tests and they should still fail:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.EE.EF.EE.EE......
======================================================================
ERROR: test_create_post (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 64, <span class="hljs-keyword">in</span> test_create_post
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line 34, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: test_create_tag (blogengine.tests.PostTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 41, <span class="hljs-keyword">in</span> test_create_tag
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line 34, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: test_create_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 335, <span class="hljs-keyword">in</span> test_create_post
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line 34, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: test_delete_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 440, <span class="hljs-keyword">in</span> test_delete_post
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line 34, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: test_delete_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 306, <span class="hljs-keyword">in</span> test_delete_tag
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line 34, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: test_edit_post (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 377, <span class="hljs-keyword">in</span> test_edit_post
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line 34, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
ERROR: test_edit_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 279, <span class="hljs-keyword">in</span> test_edit_tag
    tag.save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py"</span>, line 34, <span class="hljs-keyword">in</span> save
    super(Tag, self).save()
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 545, <span class="hljs-keyword">in</span> save
    force_update=force_update, update_fields=update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 573, <span class="hljs-keyword">in</span> save_base
    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 654, <span class="hljs-keyword">in</span> _save_table
    result = self._do_insert(cls._base_manager, using, fields, update_pk, raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line 687, <span class="hljs-keyword">in</span> _do_insert
    using=using, raw=raw)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line 232, <span class="hljs-keyword">in</span> _insert
    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line 1511, <span class="hljs-keyword">in</span> insert_query
    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(return_id)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line 898, <span class="hljs-keyword">in</span> execute_sql
    cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line 99, <span class="hljs-keyword">in</span> __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line 53, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line 450, <span class="hljs-keyword">in</span> execute
    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)
OperationalError: no such table: blogengine_tag

======================================================================
FAIL: test_create_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 256, <span class="hljs-keyword">in</span> test_create_tag
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

----------------------------------------------------------------------
Ran 18 tests <span class="hljs-keyword">in</span> 3.981s

FAILED (failures=1, errors=7)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>Again, we can easily see why they failed - the <code>blogengine_tag</code> table is not in place. So let’s create and run our migrations to fix that:</p><pre><code class="hljs lang-bash">$ python manage.py schemamigration --auto blogengine
$ python manage.py migrate
</code></pre><p>Now, we run our tests again:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
.....F..F..F......
======================================================================
FAIL: test_create_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 256, <span class="hljs-keyword">in</span> test_create_tag
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

======================================================================
FAIL: test_delete_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 315, <span class="hljs-keyword">in</span> test_delete_tag
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

======================================================================
FAIL: test_edit_tag (blogengine.tests.AdminTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 289, <span class="hljs-keyword">in</span> test_edit_tag
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

----------------------------------------------------------------------
Ran 18 tests <span class="hljs-keyword">in</span> 5.124s

FAILED (failures=3)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>We can’t yet amend our tags in the admin, because we haven’t registered them. So we do that next:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostAdmin</span><span class="hljs-params">(admin.ModelAdmin)</span>:</span>
    prepopulated_fields = {<span class="hljs-string">"slug"</span>: (<span class="hljs-string">"title"</span>,)}
    exclude = (<span class="hljs-string">'author'</span>,)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_model</span><span class="hljs-params">(self, request, obj, form, change)</span>:</span>
        obj.author = request.user
        obj.save()

admin.site.register(models.Category)
admin.site.register(models.Tag)
admin.site.register(models.Post, PostAdmin)
</code></pre><p>Now, if we run our tests, they should pass:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..................
----------------------------------------------------------------------
Ran 18 tests <span class="hljs-keyword">in</span> 5.444s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>Time to commit our changes:</p><pre><code class="hljs lang-bash">$ git add blogengine/
$ git commit -m <span class="hljs-string">'Implemented tags'</span>
</code></pre><p>Now, like with the categories beforehand, we want to be able to show the tags applied to a post at the base of it, and list all posts for a specific tag. So, first of all, we’ll amend our <code>PostViewTest</code> class to check for the tags:</p><pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'perl'</span>
        tag.description = <span class="hljs-string">'The Perl programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()
        post.tags.add(tag)

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Fetch the index</span>
        response = self.client.get(<span class="hljs-string">'/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post category is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post tag is in the response</span>
        post_tag = all_posts[<span class="hljs-number">0</span>].tags.all()[<span class="hljs-number">0</span>]
        self.assertTrue(post_tag.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_post_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'perl'</span>
        tag.description = <span class="hljs-string">'The Perl programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category
        post.save()
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the post URL</span>
        post_url = only_post.get_absolute_url()

        <span class="hljs-comment"># Fetch the post</span>
        response = self.client.get(post_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the post title is in the response</span>
        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post category is in the response</span>
        self.assertTrue(post.category.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post tag is in the response</span>
        post_tag = all_posts[<span class="hljs-number">0</span>].tags.all()[<span class="hljs-number">0</span>]
        self.assertTrue(post_tag.name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre><p>We create a tag near the top, and check for the text in the page (note that to avoid false positives from the categories, we set the name of the tags to something different). We do this on both the index and post pages.</p><p>We also need to put a test in place for the tag-specific page:</p><pre><code class="hljs lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_tag_page</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create the post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is [my first blog post](http://127.0.0.1:8000/)'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.save()
        post.tags.add(tag)

        <span class="hljs-comment"># Check new post saved</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Get the tag URL</span>
        tag_url = post.tags.all()[<span class="hljs-number">0</span>].get_absolute_url()

        <span class="hljs-comment"># Fetch the tag</span>
        response = self.client.get(tag_url)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Check the tag name is in the response</span>
        self.assertTrue(post.tags.all()[<span class="hljs-number">0</span>].name <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post text is in the response</span>
        self.assertTrue(markdown.markdown(post.text) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the post date is in the response</span>
        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)
        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)

        <span class="hljs-comment"># Check the link is marked up properly</span>
        self.assertTrue(<span class="hljs-string">'&lt;a href="http://127.0.0.1:8000/"&gt;my first blog post&lt;/a&gt;'</span> <span class="hljs-keyword">in</span> response.content)
</code></pre><p>Again, this is virtually identical to the category page, adjusted to allow for the fact that we need to get a specific tag. If we now run our tests, they should fail as expected:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
................FFF
======================================================================
FAIL: test_index (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 540, <span class="hljs-keyword">in</span> test_index
    self.assertTrue(post_tag.name <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: test_post_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 607, <span class="hljs-keyword">in</span> test_post_page
    self.assertTrue(post_tag.name <span class="hljs-keyword">in</span> response.content)
AssertionError: False is not <span class="hljs-literal">true</span>

======================================================================
FAIL: test_tag_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 714, <span class="hljs-keyword">in</span> test_tag_page
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

----------------------------------------------------------------------
Ran 19 tests <span class="hljs-keyword">in</span> 5.375s

FAILED (failures=3)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>So, we need to implement the following things:</p><ul><li>Show tags on the index page</li><li>Show tags on the post pages</li><li>Create a page listing the posts with a specific tag</li></ul><p>As we have seen already with the categories, this is actually quite simple. First, we’ll sort out the tags on the index page:</p><pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">extends</span></span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">load</span></span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">block</span></span> content %}</span><span class="xml">
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">for</span></span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span><span class="hljs-template-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span></span><span class="hljs-template-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        </span><span class="hljs-template-variable">{{ post.text|custom_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ post.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span><span class="hljs-template-variable">{{ post.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">for</span></span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span><span class="hljs-template-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %}</span><span class="xml">
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %}</span><span class="xml">

        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">if</span></span> page_obj.has_previous %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/</span></span></span><span class="hljs-template-variable">{{ page_obj.previous_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">/"</span>&gt;</span>Previous Page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endif</span></span> %}</span><span class="xml">
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">if</span></span> page_obj.has_next %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/</span></span></span><span class="hljs-template-variable">{{ page_obj.next_page_number }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">/"</span>&gt;</span>Next Page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endif</span></span> %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %}</span><span class="xml"></span>
</code></pre><p>This is quite simple. We retrieve all the tags with <code>post.tags.all</code> and loop through them. We then do basically the same for the individual post pages:</p><pre><code class="hljs lang-django"><span class="xml"></span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">extends</span></span> "blogengine/includes/base.html" %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">load</span></span> custom_markdown %}</span><span class="xml">

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">block</span></span> content %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"post"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span></span><span class="hljs-template-variable">{{ object.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span></span><span class="hljs-template-variable">{{ object.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        </span><span class="hljs-template-variable">{{ object.text|custom_markdown }}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ object.category.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span><span class="hljs-template-variable">{{ object.category.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">for</span></span> tag <span class="hljs-keyword">in</span> post.tags.all %}</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{{ tag.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span></span><span class="hljs-template-variable">{{ tag.name }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endfor</span></span> %}</span><span class="xml">

        <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Comments<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fb-comments"</span> <span class="hljs-attr">data-href</span>=<span class="hljs-string">"http://</span></span></span><span class="hljs-template-variable">{{ post.site }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string"></span></span></span><span class="hljs-template-variable">{{ post.get_absolute_url }}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">data-width</span>=<span class="hljs-string">"470"</span> <span class="hljs-attr">data-num-posts</span>=<span class="hljs-string">"10"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    </span><span class="hljs-template-tag">{% <span class="hljs-name"><span class="hljs-name">endblock</span></span> %}</span><span class="xml">
</span>
</code></pre><p>This should resolve two of our outstanding tests:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..................F
======================================================================
FAIL: test_tag_page (blogengine.tests.PostViewTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 714, <span class="hljs-keyword">in</span> test_tag_page
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

----------------------------------------------------------------------
Ran 19 tests <span class="hljs-keyword">in</span> 5.440s

FAILED (failures=1)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>The final test is for the tag pages. As we saw with the categories, we can limit our querysets on specific pages. So we’ll extend the <code>ListView</code> generic view again to handle tags:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render
<span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Category, Post, Tag

<span class="hljs-comment"># Create your views here.</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryListView</span><span class="hljs-params">(ListView)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
        <span class="hljs-keyword">try</span>:
            category = Category.objects.get(slug=slug)
            <span class="hljs-keyword">return</span> Post.objects.filter(category=category)
        <span class="hljs-keyword">except</span> Category.DoesNotExist:
            <span class="hljs-keyword">return</span> Post.objects.none()


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagListView</span><span class="hljs-params">(ListView)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span><span class="hljs-params">(self)</span>:</span>
        slug = self.kwargs[<span class="hljs-string">'slug'</span>]
        <span class="hljs-keyword">try</span>:
            tag = Tag.objects.get(slug=slug)
            <span class="hljs-keyword">return</span> tag.post_set.all()
        <span class="hljs-keyword">except</span> Tag.DoesNotExist:
            <span class="hljs-keyword">return</span> Post.objects.none()
</code></pre><p>Note that here, <code>Tag</code> objects have access to their assigned <code>Post</code> objects - we just use <code>post_set</code> to refer to them and get all of the posts associated with that tag. Next we’ll add the URLconfs:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, url
<span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView, DetailView
<span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post, Category, Tag
<span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView, TagListView

urlpatterns = patterns(<span class="hljs-string">''</span>,
    <span class="hljs-comment"># Index</span>
    url(<span class="hljs-string">r'^(?P&lt;page&gt;\d+)?/?$'</span>, ListView.as_view(
        model=Post,
        paginate_by=<span class="hljs-number">5</span>,
        )),

    <span class="hljs-comment"># Individual posts</span>
    url(<span class="hljs-string">r'^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, DetailView.as_view(
        model=Post,
        )),

    <span class="hljs-comment"># Categories</span>
    url(<span class="hljs-string">r'^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, CategoryListView.as_view(
        paginate_by=<span class="hljs-number">5</span>,
        model=Category,
        )),

    <span class="hljs-comment"># Tags</span>
    url(<span class="hljs-string">r'^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$'</span>, TagListView.as_view(
        paginate_by=<span class="hljs-number">5</span>,
        model=Tag,
        )),
)
</code></pre><p>We import the <code>Tag</code> model and the <code>TagListView</code> view, and use them to set up the tag page.</p><p>If we now run our tests again, they should pass:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
...................
----------------------------------------------------------------------
Ran 19 tests <span class="hljs-keyword">in</span> 5.473s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>Well done! Time to commit:</p><pre><code class="hljs lang-bash">$ git add templates/ blogengine/
$ git commit -m <span class="hljs-string">'Tags are now shown'</span>
</code></pre><h2 id="rss-feed">RSS Feed</h2><p>For the final task today, we’ll implement an RSS feed for our posts. Django ships with a handy syndication framework that makes it easy to implement this kind of functionality.</p><p>As usual, we’ll create some tests first. In this case, we won’t be adding any new models, so we don’t need to test them. Instead we can jump straight into creating acceptance tests for our feed. For now we’ll just create one type of feed: a feed of all the blog posts. In a later instalment we’ll add feeds for categories and tags.</p><p>First of all, we’ll implement our test. Now, in order to test our feed, we need to have a solution in place for parsing an RSS feed. Django won’t do this natively, so we’ll install the <code>feedparser</code> Python module. Run the following commands:</p><pre><code class="hljs lang-bash">$ pip install feedparser
$ pip freeze &gt; requirements.txt
</code></pre><p>Once that’s done, feedparser should be available. You may wish to refer to the <a href="http://pythonhosted.org/feedparser/">documentation</a> as we go to help.</p><p>Let’s write our test for the RSS feed. First, we import feedparser near the top of the file:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">import</span> feedparser
</code></pre><p>Then we define a new class for our feed tests. Put this towards the end of the file - I put it just before the flat page tests:</p><pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeedTest</span><span class="hljs-params">(BaseAcceptanceTest)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_all_post_feed</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Create the category</span>
        category = Category()
        category.name = <span class="hljs-string">'python'</span>
        category.description = <span class="hljs-string">'The Python programming language'</span>
        category.save()

        <span class="hljs-comment"># Create the tag</span>
        tag = Tag()
        tag.name = <span class="hljs-string">'python'</span>
        tag.description = <span class="hljs-string">'The Python programming language'</span>
        tag.save()

        <span class="hljs-comment"># Create the author</span>
        author = User.objects.create_user(<span class="hljs-string">'testuser'</span>, <span class="hljs-string">'user@example.com'</span>, <span class="hljs-string">'password'</span>)
        author.save()

        <span class="hljs-comment"># Create the site</span>
        site = Site()
        site.name = <span class="hljs-string">'example.com'</span>
        site.domain = <span class="hljs-string">'example.com'</span>
        site.save()

        <span class="hljs-comment"># Create a post</span>
        post = Post()
        post.title = <span class="hljs-string">'My first post'</span>
        post.text = <span class="hljs-string">'This is my first blog post'</span>
        post.slug = <span class="hljs-string">'my-first-post'</span>
        post.pub_date = timezone.now()
        post.author = author
        post.site = site
        post.category = category

        <span class="hljs-comment"># Save it</span>
        post.save()

        <span class="hljs-comment"># Add the tag</span>
        post.tags.add(tag)
        post.save()

        <span class="hljs-comment"># Check we can find it</span>
        all_posts = Post.objects.all()
        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)
        only_post = all_posts[<span class="hljs-number">0</span>]
        self.assertEquals(only_post, post)

        <span class="hljs-comment"># Fetch the feed</span>
        response = self.client.get(<span class="hljs-string">'/feeds/posts/'</span>)
        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)

        <span class="hljs-comment"># Parse the feed</span>
        feed = feedparser.parse(response.content)

        <span class="hljs-comment"># Check length</span>
        self.assertEquals(len(feed.entries), <span class="hljs-number">1</span>)

        <span class="hljs-comment"># Check post retrieved is the correct one</span>
        feed_post = feed.entries[<span class="hljs-number">0</span>]
        self.assertEquals(feed_post.title, post.title)
        self.assertEquals(feed_post.description, post.text)
</code></pre><p>Run the tests and you’ll see something like this:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
..............F.....
======================================================================
FAIL: test_all_post_feed (blogengine.tests.FeedTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line 781, <span class="hljs-keyword">in</span> test_all_post_feed
    self.assertEquals(response.status_code, 200)
AssertionError: 404 != 200

----------------------------------------------------------------------
Ran 20 tests <span class="hljs-keyword">in</span> 6.743s

FAILED (failures=1)
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>We’re getting a 404 error because the post feed isn’t implemented. So let’s implement it. We’re going to use Django’s syndication framework, which will make it easy, but we need to enable it. Open up <code>django_tutorial_blog_ng/settings/py</code> and add the following under <code>INSTALLED_APPS</code>:</p><pre><code class="hljs lang-python">    <span class="hljs-string">'django.contrib.syndication'</span>,
</code></pre><p>Next, we need to enable the URLconf for this RSS feed. Open up <code>blogengine/urls.py and amend the import from</code>blogengine.views` near the top:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> blogengine.views <span class="hljs-keyword">import</span> CategoryListView, TagListView, PostsFeed
</code></pre><p>Further down, add in the following code to define the URL for the feed:</p><pre><code class="hljs lang-python">    <span class="hljs-comment"># Post RSS feed</span>
    url(<span class="hljs-string">r'^feeds/posts/$'</span>, PostsFeed()),
</code></pre><p>Note that we imported the PostsFeed class, but that hasn’t yet been defined. So we need to do that. First of all, add this line near the top:</p><pre><code class="hljs lang-python"><span class="hljs-keyword">from</span> django.contrib.syndication.views <span class="hljs-keyword">import</span> Feed
</code></pre><p>This imports the syndication views - yes, they’re another generic view! Our <code>PostsFeed</code> class is going to inherit from <code>Feed</code>. Next, we define the class:</p><pre><code class="hljs lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostsFeed</span><span class="hljs-params">(Feed)</span>:</span>
    title = <span class="hljs-string">"RSS feed - posts"</span>
    link = <span class="hljs-string">"feeds/posts/"</span>
    description = <span class="hljs-string">"RSS feed - blog posts"</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">items</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> Post.objects.order_by(<span class="hljs-string">'-pub_date'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_title</span><span class="hljs-params">(self, item)</span>:</span>
        <span class="hljs-keyword">return</span> item.title

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">item_description</span><span class="hljs-params">(self, item)</span>:</span>
        <span class="hljs-keyword">return</span> item.text
</code></pre><p>This is fairly straightforward. We define our title, link, and description for the feed inside the class definition. We define the <code>items</code> method which sets what items are returned by the RSS feed. We also define the <code>item_title</code> and <code>item_description</code> methods.</p><p>Now, if we run our tests, they should pass:</p><pre><code class="hljs lang-bash">(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span> blogengine
Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
....................
----------------------------------------------------------------------
Ran 20 tests <span class="hljs-keyword">in</span> 5.933s

OK
Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...
</code></pre><p>Let’s commit our changes:</p><pre><code class="hljs lang-bash">$ git add blogengine/ django_tutorial_blog_ng/ requirements.txt
$ git commit -m <span class="hljs-string">'RSS feed implemented'</span>
</code></pre><p>And that’s enough for now. Don’t forget, you can get the code for this lesson by cloning the repository from <a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">Github</a> and running <code>git checkout lesson-4</code> to switch to this lesson.</p><p>Next time we’ll:</p><ul><li>Implement a search system</li><li>Add feeds for categories and posts</li><li>Tidy up the user interface</li></ul><p>Hope to see you then!</p><section><ul class="categories"><li><a href="/blog/categories/python/">python</a></li><li><a href="/blog/categories/django/">django</a></li><li><a href="/blog/categories/tdd/">tdd</a></li><li><a href="/blog/categories/django-blog-tutorial/">django-blog-tutorial</a></li></ul></section><section><a class="commentlink" href="https://matthewdaly.co.uk/blog/2014/02/15/django-blog-tutorial-the-next-generation-part-4/">View the article with comments</a></section><section><a class="postlink" href="/blog/2014/05/24/django-blog-tutorial-the-next-generation-part-5/amp/">Django Blog Tutorial - the Next Generation - Part 5</a> <a class="postlink" href="/blog/2014/01/25/my-first-yeoman-generator/amp/">My First Yeoman Generator</a></section></article></div></div></div><amp-analytics type="googleanalytics" id="analytics1"><script type="application/json">{
					"vars": {
						"account": "UA-17043630-1"
					},
					"triggers": {
						"trackPageview": {
							"on": "visible",
							"request": "pageview"
						}
					}
				}</script></amp-analytics></body></html>