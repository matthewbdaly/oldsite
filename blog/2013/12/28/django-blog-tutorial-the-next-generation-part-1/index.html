<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0"><meta name="description" content="I&#x27;m a web developer in Norfolk. This is my blog..."><meta name="keywords" content="python,django,tdd"><link rel="canonical" href="http://matthewdaly.co.uk/blog/2013/12/28/django-blog-tutorial-the-next-generation-part-1/"><link href="/favicon.ico" rel="icon"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link href="http://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet" type="text/css"><link rel="stylesheet" type="text/css" href="/static/css/style.min.css" media="all"><link rel="alternate" type="application/rss+xml" title="Matthew Daly&#x27;s Blog - feed" href="/rss.xml"><link rel="alternate" type="application/atom+xml" title="Matthew Daly&#x27;s Blog - feed" href="/atom.xml"><title>Django Blog Tutorial - the Next Generation - Part 1 - Matthew Daly&#x27;s Blog</title></head><body><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=MattBD" async="async"></script><header><div class="container headercontainer"><div class="jumbotron"><h1><a href="/">Matthew Daly&#x27;s Blog</a></h1><h2>I&#x27;m a web developer in Norfolk. This is my blog...</h2></div></div><div class="container headercontainer"><nav class="navbar navbar-inverse navbar-static-top"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#header-nav"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><div class="collapse navbar-collapse" id="header-nav"><ul class="nav navbar-nav"><li><a href="/">Home</a></li><li><a href="/blog/archives/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="/rss.xml">RSS</a></li></ul><form action="http://www.google.com/search" method="GET" name="searchForm" id="searchForm" enctype="application/x-www-form-urlencoded" class="navbar-form navbar-right"><div class="form-group"><input id="search" type="search" name="q" placeholder="Search..." maxlength="200" autocomplete="off" class="form-control"><ul class="searchresults"></ul></div></form></div></div></nav></div></header><div class="container"><div class="row"><div class="col-md-8"><article class="post"><p class="date">28th December 2013 3:00 pm</p><h1>Django Blog Tutorial - the Next Generation - Part 1</h1><p>My series of Django tutorials for building a blogging engine are by far the most popular posts I’ve ever written on here. I’ve had a lot of people contact me with questions or just to express their thanks, for which I’m very grateful!</p><p>However, these tutorials haven’t really aged well. I’ve since had the opportunity to use Django in a professional capacity, which has significantly improved my understanding of the framework and the whole Python ecosystem, and there’s a lot of best practices that I didn’t follow and now wish I had. There’s also been a few gotchas that have hindered a few people in the past that I’d like to have the opportunity to correct.</p><p>So, I’m therefore creating a brand new series of tutorials to remedy this situation. This series will cover exactly the same basic idea of using Django to build a blogging engine, but will expand on what the original series did in many ways. We will cover such additional topics as:</p><ul><li>Using Twitter Bootstrap to make your blog look good without too much hassle</li><li>Using Virtualenv to sandbox your blog application</li><li>Using South to effectively manage changes to your database structure</li><li>Writing some simple unit tests</li><li>Deploying the finished application to Heroku</li></ul><p>Ready? Let’s get started!</p><h2 id="getting-everything-set-up">Getting everything set up</h2><p>Now, first of all, I’m going to assume you’re using some variant of Unix, such as Linux or Mac OS X. I’m not saying you can’t follow this tutorial with Windows, but you’ll have a harder time, because Windows just isn’t as developer-friendly as Unix in general. A modern Linux distro like Ubuntu is generally pretty easy to use, and you can easily run it in Virtualbox, so if you use Windows I would recommend you use that to make things easier.</p><p>You should also have at least a basic grasp of the command line, such as how to create and navigate directories. You don’t have to be a wizard with it, though.</p><p>You also need a proper programmer’s text editor. I use Vim, but I freely admit that Vim has a very steep learning curve and you may have trouble picking it up at the same time as following this tutorial. Emacs is also a very powerful text editor, and if you like it, feel free to use it. If you haven’t yet found a programmer’s text editor you like, I suggest you check out <a href="http://www.sublimetext.com/">Sublime Text</a>, which is easy to get started with, but also very powerful, and can be used without purchasing a license. Don’t worry too much about your text editor - it’s not vitally import that you use what I use, just find one that works for you. That said, I will say one thing - DON’T use an IDE. IDE’s hide too many details from new users and make it harder to figure out what’s going on.</p><p>You will also need to ensure you have the following installed:</p><ul><li>Python. I recommend installing Python 2.7, because you may have issues with Python 2.6, and Python 3 isn’t universally supported yet so you might have some issues with that</li><li>Virtualenv</li><li>Pip</li><li>Git</li></ul><p>On most Linux distros, you can find packages for all of these items easily enough using your package manager. On Mac OS X, I recommend using Homebrew to install them, though if you have another package manager installed you can use that too. If you have issues with installing any of these, a quick Google search should be sufficient to resolve the issue.</p><h2 id="beginning-work">Beginning work</h2><p>With all that done, we’re ready to get started. Create a folder in a suitable place on your file system and switch into it. I generally keep a dedicated folder in my home directory called <code>Projects</code> to use for all of my projects, and give each project a folder within it - in this case the project is called <code>django_tutorial_blog_ng</code>.</p><p>Now, we’ll use Git to keep track of our source code. If you prefer Mercurial, feel free to use that, but this tutorial will assume use of Git, so you’ll want to adapt the commands used accordingly. Start tracking your project with the following command from the shell, when you’re in the project directory:</p><pre><code class="hljs lang-bash singleline"><table>$ git init</table></code></pre><p>If you haven’t used Git before, you’ll also want to <a href="http://git-scm.com/book/en/Getting-Started-First-Time-Git-Setup">configure it</a>.</p><p>Next, we set up our virtualenv. Run the following command:</p><pre><code class="hljs lang-bash singleline"><table>$ virtualenv venv --distribute</table></code></pre><p>Followed by:</p><pre><code class="hljs lang-bash singleline"><table>$ <span class="hljs-built_in">source</span> venv/bin/activate</table></code></pre><p>Every time you come back to work on this project, you’ll need to run the previous command to make sure you’re running the version of Python installed under venv/ rather than your system Python. You can tell it’s using this because your shell prompt will be prefixed with <code>(venv)</code>.</p><p>Why do this? Well, it means you can install whatever version of a Python module you like, without having root access, and means the Python install you’re using will only have those modules you explicitly install, rather than all of those ones available with your operating system. For instance, you could have multiple projects using different versions of Django, rather than having to update a global installation of Django and potentially break existing applications.</p><p>Now that our virtualenv is set up, we’ll install Django, as well as several other useful Python modules. Run the following command:</p><pre><code class="hljs lang-bash singleline"><table>$ pip install django-toolbelt South</table></code></pre><p>A little explanation is called for here. The package <code>django-toolbelt</code> includes a number of packages we’ll be using, including Django, as well as Gunicorn (a simple web server we’ll use when the time comes to deploy the app to Heroku). South is a migration tool that is commonly used with Django - basically, if you make changes to existing models, Django doesn’t natively have the capacity to apply those changes (yet - native migrations are planned at some point in the future), so South can be used to apply those changes for you without having to either manually change the database structure or dump the database and rebuild it.</p><p>Please note that one of the packages, <code>psycopg2</code>, may fail if you don’t have PostgreSQL installed, but don’t worry about installing it. We’ll be using SQLite for developing the application locally, and we’ll be deploying the finished product to Heroku, which does have it installed.</p><p>Once the installation is complete, run the following command to record the new modules installed:</p><pre><code class="hljs lang-bash singleline"><table>$ pip freeze &gt; requirements.txt</table></code></pre><p>The file <code>requirements.txt</code> will be created, which stores the packages and versions you have installed so that they can be easily recreated. If you had issues installing <code>psycopg2</code>, then here’s what your <code>requirements.txt</code> should look like - feel free to edit it manually to look like this, as when we deploy it to Heroku, it will need to be correct to ensure that our application can be deployed successfully:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>Django==<span class="hljs-number">1.6</span>.<span class="hljs-number">1</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>South==<span class="hljs-number">0.8</span>.<span class="hljs-number">4</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>dj-database-url==<span class="hljs-number">0.2</span>.<span class="hljs-number">2</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>dj-static==<span class="hljs-number">0.0</span>.<span class="hljs-number">5</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>django-toolbelt==<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>gunicorn==<span class="hljs-number">18.0</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>psycopg2==<span class="hljs-number">2.5</span>.<span class="hljs-number">1</span></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>static==<span class="hljs-number">0.4</span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>wsgiref==<span class="hljs-number">0.1</span>.<span class="hljs-number">2</span></td></tr></table></code></pre><p>Next, we’ll commit these changes with Git:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add requirements.txt</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Committed requirements'</span></td></tr></table></code></pre><p>Next we’ll add a <code>.gitignore</code> file to ignore our virtualenv - we want to keep this out of version control because it’s something specific to that install. We have all we need to recreate it so we don’t want to store it. In addition, we also want to ignore any compiled Python files (identifiable by the .pyc suffix):</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>venv/</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>*.pyc</td></tr></table></code></pre><p>Let’s commit that too:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add .gitignore</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Added a gitignore file'</span></td></tr></table></code></pre><p>Now, let’s generate our project’s basic skeleton:</p><pre><code class="hljs lang-bash singleline"><table>$ django-admin.py startproject django_tutorial_blog_ng .</table></code></pre><p>This application skeleton includes a basic configuration which will be sufficient for now, but you will also want to add the SQLite database file to your <code>.gitignore</code>:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>env/</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>*.pyc</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>db.sqlite3</td></tr></table></code></pre><p>Let’s commit what we’ve done:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add .gitignore django_tutorial_blog_ng/ manage.py</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Created project skeleton'</span></td></tr></table></code></pre><p>Now, before we create our database, we need to ensure we are using South. Go into <code>django_tutorial_blog_ng/settings.py</code> and find <code>INSTALLED_APPS</code>. Edit it to look like this:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>INSTALLED_APPS = (</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    <span class="hljs-string">'django.contrib.admin'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>    <span class="hljs-string">'django.contrib.auth'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>    <span class="hljs-string">'django.contrib.contenttypes'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>    <span class="hljs-string">'django.contrib.sessions'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>    <span class="hljs-string">'django.contrib.messages'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    <span class="hljs-string">'django.contrib.staticfiles'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>    <span class="hljs-string">'south'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>)</td></tr></table></code></pre><p>Now, you can create your database. Run the following command:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py syncdb</table></code></pre><p>You’ll be prompted to create a superuser - go ahead and fill in the details. Now, run the following command:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py runserver</table></code></pre><p>This will run Django’s built-in web server on port 8000, and if you click <a href="http://127.0.0.1:8000">here</a>, you should see a page congratulating you on your first Django-powered page. Once you’re finished with it, you can stop the web server with <kbd>Ctrl-C</kbd>.</p><p>Don’t forget to commit your changes:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add django_tutorial_blog_ng/settings.py</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Added South to installed apps'</span></td></tr></table></code></pre><h2 id="your-first-app">Your first app</h2><p>Django distinguishes between the concepts of <strong>projects</strong> and <strong>apps</strong>. A project is a specific project that may consist of one or more apps, such as a web app, whereas an app is a set of functionality within a project. For instance, one website might include some flat pages, an admin interface, and a blogging engine, and these could easily be different apps. By encouraging you to separate different types of functionality into different apps, Django makes it easier for you to reuse existing content elsewhere.</p><p>We’re going to create our first app, which is the blogging engine. Run the following command to create a basic skeleton for this app:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py startapp blogengine</table></code></pre><p>Next, we need to amend our settings to install this app:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>INSTALLED_APPS = (</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    <span class="hljs-string">'django.contrib.admin'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>    <span class="hljs-string">'django.contrib.auth'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>    <span class="hljs-string">'django.contrib.contenttypes'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>    <span class="hljs-string">'django.contrib.sessions'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>    <span class="hljs-string">'django.contrib.messages'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    <span class="hljs-string">'django.contrib.staticfiles'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>    <span class="hljs-string">'south'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>    <span class="hljs-string">'blogengine'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>)</td></tr></table></code></pre><p>Now, before we can use this app, we want to let South know about it so that changes to your database structure will be managed right from the start by South. Run the following command to create your initial migration:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py schemamigration --initial blogengine</table></code></pre><p>That creates the file for your first migration,but doesn’t run it. To migrate your database structure to the latest version, run the following:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py migrate</table></code></pre><p>This won’t actually make any changes, but it will ensure that all future changes to your models for the <code>blogengine</code> app are handled by South. Let’s commit our app skeleton:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add django_tutorial_blog_ng/settings.py blogengine/</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Added blogengine app skeleton'</span></td></tr></table></code></pre><p>So, we now have our first app set up, but it doesn’t do anything much.</p><p>Remember that I mentioned how Django differentiates between projects and apps? Well, Django actually ships with a number of useful apps, and one of those is the admin interface. I consider the Django admin to be one of the framework’s killer features because it’s easy to use and customise, and saves you a lot of grief.</p><p>In the past, the admin interface needed a little work to get it working, but in Django 1.6 it’s configured to work out of the box, so if you click <a href="http://127.0.0.1:8000/admin/">here</a>, you should see the login screen for it. You should be able to sign in using the username and password you set when you ran <code>syncdb</code>.</p><p>Next, we’ll set up our first model.</p><h2 id="an-introduction-to-mvc">An introduction to MVC</h2><p>MVC is a common pattern used in web development. Many web development frameworks can be loosely described as MVC, including Django, Rails, CodeIgniter, Laravel and Symfony, as well as some client-side frameworks like Backbone.js. The basic concept is that a web app is divided into three basic components:</p><ul><li><strong>Models</strong> - the data managed with the application</li><li><strong>Views</strong> - the presentation of the data</li><li><strong>Controllers</strong> - an intermediary between the models and the views</li></ul><p>Now, Django’s interpretation of MVC is slightly different to many other frameworks. While in most frameworks the views are HTML templates for rendering the data, in Django this role is taken by the templates, and the views are functions or objects that render data from the models using a template. Effectively, you can think of Django’s views as being like controllers in other frameworks, and Django templates as being views.</p><p>In Django, you create your models as Python classes that represent your data, and you use the Django ORM to query the database. As a result, it’s rare to have to directly query your database using SQL, making it more portable between different databases.</p><p>Now, our first model is going to be of a blog post. At least initially, each post will have the following attributes:</p><ul><li>A title</li><li>A publication date and time</li><li>Some text</li></ul><p>Now, we could just jump straight into creating our first model, but we’re going to make a point of following the practices of test-driven development here. The basic concept of TDD is that you write a failing test before writing any code, then you write the code to pass that test afterwards. It does make things a bit slower, but it’s all too easy to neglect writing tests at all if you leave it till later.</p><p>If you take a look in the <code>blogengine</code> folder you’ll notice there’s a file called <code>tests.py</code>. Open it up and you should see the following:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">from</span> django.test <span class="hljs-keyword">import</span> TestCase</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-comment"># Create your tests here.</span></td></tr></table></code></pre><p>It’s worth taking a little time to plan out what we want to test from our post model. Each post object will have the attributes I mentioned above, and what we want to be able to do is test that we can:</p><ul><li>Set the title</li><li>Set the publication date and time</li><li>Set the text</li><li>Save it successfully</li><li>Retrieve it successfully</li></ul><p>So, let’s create a test for our post model. We’ll go through the relevant sections of the test bit by bit:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">from</span> django.test <span class="hljs-keyword">import</span> TestCase</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-keyword">from</span> django.utils <span class="hljs-keyword">import</span> timezone</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post</td></tr></table></code></pre><p>Here we’re importing the required functionality. <code>TestCase</code> is provided by Django, and is an object all of your tests should inherit from. <code>timezone</code> is a utility for handling dates and times correctly. Finally, <code>Post</code> is our model, which we have yet to implement.</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-comment"># Create your tests here.</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostTest</span><span class="hljs-params">(TestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>        <span class="hljs-comment"># Create the post</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        post = Post()</td></tr></table></code></pre><p>Here we create the PostTest class, which represents a test for your <code>Post</code> model. So far it only has one method, but you can add additional ones if required.</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-comment"># Set the attributes</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        post.title = <span class="hljs-string">'My first post'</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>        post.text = <span class="hljs-string">'This is my first blog post'</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        post.pub_date = timezone.now()</td></tr></table></code></pre><p>Here we set the post’s attributes.</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-comment"># Save it</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        post.save()</td></tr></table></code></pre><p>Now we save it. At this point it has been added to the database, and the rest of the test involves us ensuring it has been saved correctly and can be retrieved.</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-comment"># Check we can find it</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        all_posts = Post.objects.all()</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        only_post = all_posts[<span class="hljs-number">0</span>]</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        self.assertEquals(only_post, post)</td></tr></table></code></pre><p>Here we use the Django database API to fetch all of the Post objects, assert that there is only 1 post object, retrieve that post object, and assert that it is the same object as the post object we just saved.</p><p>If unit testing is new to you, assertions may be new to you. Essentially you’re saying to the Python interpreter, “I assert that X is true, so please raise an error if this is not true”. Here we assert that the length of the variable <code>all_posts</code> is 1, and that that post is the same object as the previously saved object, so that the test will fail if that is not the case.</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-comment"># Check attributes</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        self.assertEquals(only_post.pub_date.day, post.pub_date.day)</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        self.assertEquals(only_post.pub_date.month, post.pub_date.month)</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        self.assertEquals(only_post.pub_date.year, post.pub_date.year)</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>        self.assertEquals(only_post.pub_date.second, post.pub_date.second)</td></tr></table></code></pre><p>Finally, we assert that the values of each of the post’s attributes as stored in the database match up with those in the post object we set. For the <code>title</code> and <code>text</code> fields, these are easy to validate as we can just check the values against those we set. For the <code>pub_date</code> field, things are a bit more complex, since this will be an object in its own right, so you need to check the day, month, year, hour, minute and second attributes separately.</p><p>The whole thing should look like this:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">from</span> django.test <span class="hljs-keyword">import</span> TestCase</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-keyword">from</span> django.utils <span class="hljs-keyword">import</span> timezone</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-comment"># Create your tests here.</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostTest</span><span class="hljs-params">(TestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        <span class="hljs-comment"># Create the post</span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        post = Post()</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>        <span class="hljs-comment"># Set the attributes</span></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        post.title = <span class="hljs-string">'My first post'</span></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>        post.text = <span class="hljs-string">'This is my first blog post'</span></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>        post.pub_date = timezone.now()</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>        <span class="hljs-comment"># Save it</span></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        post.save()</td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>        <span class="hljs-comment"># Check we can find it</span></td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        all_posts = Post.objects.all()</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        only_post = all_posts[<span class="hljs-number">0</span>]</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td>        self.assertEquals(only_post, post)</td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>        <span class="hljs-comment"># Check attributes</span></td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td>        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>        self.assertEquals(only_post.pub_date.day, post.pub_date.day)</td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td>        self.assertEquals(only_post.pub_date.month, post.pub_date.month)</td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td>        self.assertEquals(only_post.pub_date.year, post.pub_date.year)</td></tr><tr><td class="linenos" data-pseudo-content="31"></td><td>        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)</td></tr><tr><td class="linenos" data-pseudo-content="32"></td><td>        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)</td></tr><tr><td class="linenos" data-pseudo-content="33"></td><td>        self.assertEquals(only_post.pub_date.second, post.pub_date.second)</td></tr></table></code></pre><p>With that in place, the time has come to run our test with the following command:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py <span class="hljs-built_in">test</span></table></code></pre><p>You should see something like this:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>E</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>======================================================================</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>ERROR: blogengine.tests (unittest.loader.ModuleImportFailure)</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>----------------------------------------------------------------------</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>ImportError: Failed to import <span class="hljs-built_in">test</span> module: blogengine.tests</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>Traceback (most recent call last):</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line <span class="hljs-number">254</span>, <span class="hljs-keyword">in</span> _find_tests</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>    module = self._get_module_from_name(name)</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>  File <span class="hljs-string">"/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _get_module_from_name</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>    __import__(name)</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">3</span>, <span class="hljs-keyword">in</span> &lt;module&gt;</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>    from blogengine.models import Post</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>ImportError: cannot import name Post</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>----------------------------------------------------------------------</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>Ran <span class="hljs-number">1</span> <span class="hljs-built_in">test</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0.000</span>s</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>FAILED (errors=<span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</td></tr></table></code></pre><p>Don’t worry about the error - this is exactly what we expect to see because we haven’t implemented our Post model yet. Now that we have a failing test in place, we can implement our model to make the test pass. Open up <code>blogengine/models.py</code> and enter the following:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-comment"># Create your models here.</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(models.Model)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>    title = models.CharField(max_length=<span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>    pub_date = models.DateTimeField()</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    text = models.TextField()</td></tr></table></code></pre><p>Save the file and run the test again:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>E</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>======================================================================</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>ERROR: <span class="hljs-built_in">test</span>_create_post (blogengine.tests.PostTest)</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>----------------------------------------------------------------------</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>Traceback (most recent call last):</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">17</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_create_post</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>    post.save()</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">545</span>, <span class="hljs-keyword">in</span> save</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>    force_update=force_update, update_fields=update_fields)</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">573</span>, <span class="hljs-keyword">in</span> save_base</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>    updated = self._save_table(raw, cls, force_insert, force_update, using, update_fields)</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">654</span>, <span class="hljs-keyword">in</span> _save_table</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>    result = self._<span class="hljs-keyword">do</span>_insert(cls._base_manager, using, fields, update_pk, raw)</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py"</span>, line <span class="hljs-number">687</span>, <span class="hljs-keyword">in</span> _<span class="hljs-keyword">do</span>_insert</td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>    using=using, raw=raw)</td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py"</span>, line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> _insert</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>    <span class="hljs-built_in">return</span> insert_query(self.model, objs, fields, **kwargs)</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py"</span>, line <span class="hljs-number">1511</span>, <span class="hljs-keyword">in</span> insert_query</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>    <span class="hljs-built_in">return</span> query.get_compiler(using=using).execute_sql(<span class="hljs-built_in">return</span>_id)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py"</span>, line <span class="hljs-number">898</span>, <span class="hljs-keyword">in</span> execute_sql</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td>    cursor.execute(sql, params)</td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute</td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)</td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py"</span>, line <span class="hljs-number">99</span>, <span class="hljs-keyword">in</span> __<span class="hljs-built_in">exit</span>__</td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>    six.reraise(dj_exc_<span class="hljs-built_in">type</span>, dj_exc_value, traceback)</td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py"</span>, line <span class="hljs-number">53</span>, <span class="hljs-keyword">in</span> execute</td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td>    <span class="hljs-built_in">return</span> self.cursor.execute(sql, params)</td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py"</span>, line <span class="hljs-number">450</span>, <span class="hljs-keyword">in</span> execute</td></tr><tr><td class="linenos" data-pseudo-content="31"></td><td>    <span class="hljs-built_in">return</span> Database.Cursor.execute(self, query, params)</td></tr><tr><td class="linenos" data-pseudo-content="32"></td><td>OperationalError: no such table: blogengine_post</td></tr><tr><td class="linenos" data-pseudo-content="33"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="34"></td><td>----------------------------------------------------------------------</td></tr><tr><td class="linenos" data-pseudo-content="35"></td><td>Ran <span class="hljs-number">1</span> <span class="hljs-built_in">test</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0.059</span>s</td></tr><tr><td class="linenos" data-pseudo-content="36"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="37"></td><td>FAILED (errors=<span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="38"></td><td>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</td></tr></table></code></pre><p>Our test still fails, but if we take a look at this error message, we can see why - there is no database table for the posts (called <code>blogengine_post</code>). Using South, we can easily remedy that by creating a new migration to create this table:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py schemamigration --auto blogengine</table></code></pre><p>That creates the new migration. Now let’s run it:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py migrate</table></code></pre><p>Now, let’s run our tests to check it’s working as expected:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py <span class="hljs-built_in">test</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>.</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>----------------------------------------------------------------------</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>Ran <span class="hljs-number">1</span> <span class="hljs-built_in">test</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0.001</span>s</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>OK</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</td></tr></table></code></pre><p>Success! We now have a model in place that passes our test. Let’s commit our changes:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add blogengine/</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Added post model with passing test'</span></td></tr></table></code></pre><p>Now, Django’s ORM is basically a layer on top of SQL that abstracts away differences between different relational databases, but the underlying queries are still being run. You can view the SQL created to generate the table by using the <code>sqlall</code> command. Just run <code>python manage.py sqlall blogengine</code> and you should see something like this:</p><pre><code class="hljs lang-sql"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-operator"><span class="hljs-keyword">BEGIN</span>;</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">"blogengine_post"</span> (</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>    <span class="hljs-string">"id"</span> <span class="hljs-built_in">integer</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>    <span class="hljs-string">"title"</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>    <span class="hljs-string">"pub_date"</span> datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>    <span class="hljs-string">"text"</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>)</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>;</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td><span class="hljs-operator"><span class="hljs-keyword">COMMIT</span>;</span></td></tr></table></code></pre><p>Note the addition of the <code>id</code> field as the primary key. If you’re at all familiar with relational databases, you’ll know that every table must have one field, called a primary key, that is a unique reference to that row. This can be overridden, but here it’s exactly the behaviour we want.</p><h2 id="creating-blog-posts-via-the-admin">Creating blog posts via the admin</h2><p>Now, we need a way to be able to create, edit and delete blog posts. Django’s admin interface allows us to do so easily. However, before we do so, we want to create automated acceptance tests for this functionality, in order to test the ability to create posts from an end-user’s perspective. While unit tests are for testing sections of an application’s functionality from the perspective of other sections of the application, acceptance tests are testing from the user’s perspective. In other words, they test what the application needs to do to be acceptable.</p><p>First, we will test logging into the admin. Open up <code>blogengine/tests.py</code> and amend it as follows:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">from</span> django.test <span class="hljs-keyword">import</span> TestCase, LiveServerTestCase, Client</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-keyword">from</span> django.utils <span class="hljs-keyword">import</span> timezone</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td><span class="hljs-comment"># Create your tests here.</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostTest</span><span class="hljs-params">(TestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        <span class="hljs-comment"># Create the post</span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        post = Post()</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>        <span class="hljs-comment"># Set the attributes</span></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        post.title = <span class="hljs-string">'My first post'</span></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>        post.text = <span class="hljs-string">'This is my first blog post'</span></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>        post.pub_date = timezone.now()</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>        <span class="hljs-comment"># Save it</span></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        post.save()</td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>        <span class="hljs-comment"># Check we can find it</span></td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        all_posts = Post.objects.all()</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        only_post = all_posts[<span class="hljs-number">0</span>]</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td>        self.assertEquals(only_post, post)</td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>        <span class="hljs-comment"># Check attributes</span></td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td>        self.assertEquals(only_post.title, <span class="hljs-string">'My first post'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>        self.assertEquals(only_post.text, <span class="hljs-string">'This is my first blog post'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>        self.assertEquals(only_post.pub_date.day, post.pub_date.day)</td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td>        self.assertEquals(only_post.pub_date.month, post.pub_date.month)</td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td>        self.assertEquals(only_post.pub_date.year, post.pub_date.year)</td></tr><tr><td class="linenos" data-pseudo-content="31"></td><td>        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)</td></tr><tr><td class="linenos" data-pseudo-content="32"></td><td>        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)</td></tr><tr><td class="linenos" data-pseudo-content="33"></td><td>        self.assertEquals(only_post.pub_date.second, post.pub_date.second)</td></tr><tr><td class="linenos" data-pseudo-content="34"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="35"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="36"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="37"></td><td>        <span class="hljs-comment"># Create client</span></td></tr><tr><td class="linenos" data-pseudo-content="38"></td><td>        c = Client()</td></tr><tr><td class="linenos" data-pseudo-content="39"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="40"></td><td>        <span class="hljs-comment"># Get login page</span></td></tr><tr><td class="linenos" data-pseudo-content="41"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="42"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="43"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="44"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr></table></code></pre><p>First of all, we import two new objects from <code>django.test</code>, <code>LiveServerTestCase</code> and <code>Client</code>. Then we create the first part of our first test for the admin, named <code>AdminTest</code>. Eventually, this will test that we can log successfully into the admin interface. For now, we’re just doing the following:</p><ul><li>Creating a Client object</li><li>Fetching the <code>/admin/</code> route</li><li>Asserting that the status code for this HTTP request is 200, (in other words, that the page was fetched successfully).</li></ul><p>If you run <code>python manage.py test</code>, you should see that both tests pass successfully. Now we’ll extend <code>AdminTest</code> - we’ll verify that the response contains the string ‘Log in’, which in the Django admin interface, appears on the login page:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        <span class="hljs-comment"># Create client</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>        c = Client()</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        <span class="hljs-comment"># Get login page</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        <span class="hljs-comment"># Check 'Log in' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)</td></tr></table></code></pre><p>Here <code>response.content</code> is a string containing the content of the HTTP response - we’re asserting that the substring ‘Log in’ appears in there. If you run <code>python manage.py test</code> again, it should pass.</p><p>Now, we need to actually log in. This could be fiddly, but Django has a handy convenience method to log you in when testing:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        <span class="hljs-comment"># Create client</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>        c = Client()</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        <span class="hljs-comment"># Get login page</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        <span class="hljs-comment"># Check 'Log in' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>        <span class="hljs-comment"># Log the user in</span></td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>        c.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        <span class="hljs-comment"># Check 'Log out' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td>        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)</td></tr></table></code></pre><p>Here, we use the <code>login</code> method of the <code>Client</code> object to log into the admin interface, and then we fetch the <code>/admin/</code> route again. We assert that we get a 200 status code, and we assert that the response contains the string ‘Log out’ - in other words, that we are logged in.</p><p>Try running <code>python manage.py test</code> and we’ll get an error., because the user details we’ve used to log in don’t exist. Let’s resolve that.</p><p>Now, you could put your own credentials in there, but that’s not a good idea because it’s a security risk. Instead, we’ll create a fixture for the test user that will be loaded when the tests are run. Run the following command:</p><pre><code class="hljs lang-bash singleline"><table>$ python manage.py createsuperuser</table></code></pre><p>Give the username as <code>bobsmith</code>, the email address as <code>bob@example.com</code>, and the password as <code>password</code>. Once that’s done, run these commands to dump the existing users to a fixture:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ mkdir blogengine/fixtures</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ python manage.py dumpdata auth.User --indent=<span class="hljs-number">2</span> &gt; blogengine/fixtures/users.json</td></tr></table></code></pre><p>This will dump all of the existing users to <code>blogengine/fixtures/users.json</code>. You may wish to edit this file to remove your own superuser account and leave only the newly created one in there.</p><p>Next we need to amend our test to load this fixture:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    fixtures = [<span class="hljs-string">'users.json'</span>]</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        <span class="hljs-comment"># Create client</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        c = Client()</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        <span class="hljs-comment"># Get login page</span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>        <span class="hljs-comment"># Check 'Log in' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        <span class="hljs-comment"># Log the user in</span></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>        c.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>        <span class="hljs-comment"># Check 'Log out' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)</td></tr></table></code></pre><p>Now, if you run <code>python manage.py test</code>, you should find that the test passes. Next, we’ll test that we can log out:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    fixtures = [<span class="hljs-string">'users.json'</span>]</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        <span class="hljs-comment"># Create client</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        c = Client()</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        <span class="hljs-comment"># Get login page</span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>        <span class="hljs-comment"># Check 'Log in' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        <span class="hljs-comment"># Log the user in</span></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>        c.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>        <span class="hljs-comment"># Check 'Log out' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_logout</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>        <span class="hljs-comment"># Create client</span></td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td>        c = Client()</td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="31"></td><td>        <span class="hljs-comment"># Log in</span></td></tr><tr><td class="linenos" data-pseudo-content="32"></td><td>        c.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="33"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="34"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="35"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="36"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="37"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="38"></td><td>        <span class="hljs-comment"># Check 'Log out' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="39"></td><td>        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="40"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="41"></td><td>        <span class="hljs-comment"># Log out</span></td></tr><tr><td class="linenos" data-pseudo-content="42"></td><td>        c.logout()</td></tr><tr><td class="linenos" data-pseudo-content="43"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="44"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="45"></td><td>        response = c.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="46"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="47"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="48"></td><td>        <span class="hljs-comment"># Check 'Log in' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="49"></td><td>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)</td></tr></table></code></pre><p>This test works along very similar lines. We log in, verify that ‘Log out’ is in the response, then we log out, and verify that ‘Log in’ is in the response. Run the tests again, and they should pass. Assuming they do, let’s commit our changes again:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add blogengine/</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Added tests for admin auth'</span></td></tr></table></code></pre><p>This code is a little repetitive. We create the client twice, when we could do so only once. Amend the AdminTest class as follows:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    fixtures = [<span class="hljs-string">'users.json'</span>]</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setUp</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        self.client = Client()</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_login</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        <span class="hljs-comment"># Get login page</span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        response = self.client.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>        <span class="hljs-comment"># Check 'Log in' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        <span class="hljs-comment"># Log the user in</span></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        response = self.client.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>        <span class="hljs-comment"># Check 'Log out' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_logout</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>        <span class="hljs-comment"># Log in</span></td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="31"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="32"></td><td>        response = self.client.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="33"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="34"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="35"></td><td>        <span class="hljs-comment"># Check 'Log out' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="36"></td><td>        self.assertTrue(<span class="hljs-string">'Log out'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="37"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="38"></td><td>        <span class="hljs-comment"># Log out</span></td></tr><tr><td class="linenos" data-pseudo-content="39"></td><td>        self.client.logout()</td></tr><tr><td class="linenos" data-pseudo-content="40"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="41"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="42"></td><td>        response = self.client.get(<span class="hljs-string">'/admin/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="43"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="44"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="45"></td><td>        <span class="hljs-comment"># Check 'Log in' in response</span></td></tr><tr><td class="linenos" data-pseudo-content="46"></td><td>        self.assertTrue(<span class="hljs-string">'Log in'</span> <span class="hljs-keyword">in</span> response.content)</td></tr></table></code></pre><p>The <code>setUp()</code> method is automatically run when the test runs, and ensures we only need to start up the client once. Run your tests to make sure they pass, then commit your changes:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add blogengine/</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Refactored admin test'</span></td></tr></table></code></pre><p>Now, we’ll implement a test for creating a new post. The admin interface implements URLs for creating new instances of a model in a consistent format of <code>/admin/app_name/model_name/add/</code>, so the URL for adding a new post will be <code>/admin/blogengine/post/add/</code>.</p><p>Add this method to the AdminTest class:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-comment"># Log in</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr></table></code></pre><p>Try running it and this will fail, because we haven’t registered the Post model in the Django admin. So we need to do that. To do so, open a new file at <code>blogengine/admin.py</code> and add the following code:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">import</span> models</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>admin.site.register(models.Post)</td></tr></table></code></pre><p>Now, run <code>python manage.py test</code> and the test should pass. If you want to confirm that the post model appears in the admin, run <code>python manage.py runserver</code> and click <a href="http://127.0.0.1:8000/admin/">here</a>.</p><p>So now we can reach the page for adding a post, but we haven’t yet tested that we can submit one. Let’s remedy that:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_create_post</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-comment"># Log in</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        <span class="hljs-comment"># Check response code</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        response = self.client.get(<span class="hljs-string">'/admin/blogengine/post/add/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        <span class="hljs-comment"># Create the new post</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/add/'</span>, {</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My first post'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my first post'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span></td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>        },</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>        follow=<span class="hljs-keyword">True</span></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        )</td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        <span class="hljs-comment"># Check added successfully</span></td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        self.assertTrue(<span class="hljs-string">'added successfully'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td>        <span class="hljs-comment"># Check new post now in database</span></td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>        all_posts = Post.objects.all()</td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)</td></tr></table></code></pre><p>Here we submit the new post via HTTP POST, with all the data passed through. This mirrors the form created by the Django admin interface - if you take a look at the HTML generated by the admin, you’ll see that the inputs are given names that match these. Note that the <code>pub_date</code> field, because it represents a datetime object, is split up into a separate date and time field. Also note the parameter <code>follow=True</code> - this denotes that the test client should follow any HTTP redirect.</p><p>We confirm that the POST request responded with a 200 code, denoting success. We also confirm that the response included the phrase ‘added successfully’. Finally we confirm that there is now a single Post object in the database. Don’t worry about any existing content - Django creates a dedicated test database and destroys it after the tests are done, so you can be sure that no posts are present unless you explicitly load them from a fixture.</p><p>We can now test creating a post, but we also need to ensure we can test editing and deleting them. First we’ll add a test for editing posts:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_edit_post</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-comment"># Create the post</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        post = Post()</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>        post.title = <span class="hljs-string">'My first post'</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        post.text = <span class="hljs-string">'This is my first blog post'</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        post.pub_date = timezone.now()</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        post.save()</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        <span class="hljs-comment"># Log in</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>        <span class="hljs-comment"># Edit the post</span></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/'</span>, {</td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>            <span class="hljs-string">'title'</span>: <span class="hljs-string">'My second post'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>            <span class="hljs-string">'text'</span>: <span class="hljs-string">'This is my second blog post'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>            <span class="hljs-string">'pub_date_0'</span>: <span class="hljs-string">'2013-12-28'</span>,</td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>            <span class="hljs-string">'pub_date_1'</span>: <span class="hljs-string">'22:00:04'</span></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>        },</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>        follow=<span class="hljs-keyword">True</span></td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        )</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td>        <span class="hljs-comment"># Check changed successfully</span></td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>        self.assertTrue(<span class="hljs-string">'changed successfully'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td>        <span class="hljs-comment"># Check post amended</span></td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>        all_posts = Post.objects.all()</td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td>        only_post = all_posts[<span class="hljs-number">0</span>]</td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td>        self.assertEquals(only_post.title, <span class="hljs-string">'My second post'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="31"></td><td>        self.assertEquals(only_post.text, <span class="hljs-string">'This is my second blog post'</span>)</td></tr></table></code></pre><p>Here we create a new blog post, then verify we can edit it by resubmitting it with different values, and checking that we get the expected response, and that the data in the database has been updated. Run <code>python manage.py test</code>, and this should pass.</p><p>Finally, we’ll set up a test for deleting posts:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_delete_post</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>        <span class="hljs-comment"># Create the post</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        post = Post()</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>        post.title = <span class="hljs-string">'My first post'</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>        post.text = <span class="hljs-string">'This is my first blog post'</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        post.pub_date = timezone.now()</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        post.save()</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        <span class="hljs-comment"># Check new post saved</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>        all_posts = Post.objects.all()</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>        <span class="hljs-comment"># Log in</span></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>        self.client.login(username=<span class="hljs-string">'bobsmith'</span>, password=<span class="hljs-string">"password"</span>)</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td>        <span class="hljs-comment"># Delete the post</span></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        response = self.client.post(<span class="hljs-string">'/admin/blogengine/post/1/delete/'</span>, {</td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>            <span class="hljs-string">'post'</span>: <span class="hljs-string">'yes'</span></td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>        }, follow=<span class="hljs-keyword">True</span>)</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        <span class="hljs-comment"># Check deleted successfully</span></td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td>        self.assertTrue(<span class="hljs-string">'deleted successfully'</span> <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>        <span class="hljs-comment"># Check post amended</span></td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td>        all_posts = Post.objects.all()</td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>        self.assertEquals(len(all_posts), <span class="hljs-number">0</span>)</td></tr></table></code></pre><p>Again, this is pretty similar to what we did before. We create a new post, verify that it is the sole post in the database, and log into the admin. Then we delete the post via the admin, and confirm that the admin interface confirmed it has been deleted, and the post is gone from the database.</p><p>I think it’s now time to commit again:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add blogengine/</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Post admin tests in place'</span></td></tr></table></code></pre><p>So we now know that we can create, edit and delete posts, and we have tests in place to confirm this. So our next task is to be able to display our posts.</p><p>For now, to keep things simple, we’re only going to implement the index view - in other words, all the posts in reverse chronological order. We’ll use Django’s generic views to keep things really easy.</p><p>Django’s generic views are another really handy feature. As mentioned earlier, a view is a function or class that describes how a specific route should render an object. Now, there are many tasks that recur in web development. For instance, many web pages you may have seen may be a list of objects - in this case, the index page for a blog is a list of blog posts. For that reason, Django has the ListView generic view, which makes it easy to render a list of objects.</p><p>Now, like before, we want to have a test in place. Open up <code>blogengine/tests.py</code> and add the following class at the end of the file:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostViewTest</span><span class="hljs-params">(LiveServerTestCase)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setUp</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        self.client = Client()</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span><span class="hljs-params">(self)</span>:</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        <span class="hljs-comment"># Create the post</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        post = Post()</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        post.title = <span class="hljs-string">'My first post'</span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        post.text = <span class="hljs-string">'This is my first blog post'</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>        post.pub_date = timezone.now()</td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>        post.save()</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>        <span class="hljs-comment"># Check new post saved</span></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>        all_posts = Post.objects.all()</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>        self.assertEquals(len(all_posts), <span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="16"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="17"></td><td>        <span class="hljs-comment"># Fetch the index</span></td></tr><tr><td class="linenos" data-pseudo-content="18"></td><td>        response = self.client.get(<span class="hljs-string">'/'</span>)</td></tr><tr><td class="linenos" data-pseudo-content="19"></td><td>        self.assertEquals(response.status_code, <span class="hljs-number">200</span>)</td></tr><tr><td class="linenos" data-pseudo-content="20"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="21"></td><td>        <span class="hljs-comment"># Check the post title is in the response</span></td></tr><tr><td class="linenos" data-pseudo-content="22"></td><td>        self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="23"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="24"></td><td>        <span class="hljs-comment"># Check the post text is in the response</span></td></tr><tr><td class="linenos" data-pseudo-content="25"></td><td>        self.assertTrue(post.text <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="26"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="27"></td><td>        <span class="hljs-comment"># Check the post date is in the response</span></td></tr><tr><td class="linenos" data-pseudo-content="28"></td><td>        self.assertTrue(str(post.pub_date.year) <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="29"></td><td>        self.assertTrue(post.pub_date.strftime(<span class="hljs-string">'%b'</span>) <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="30"></td><td>        self.assertTrue(str(post.pub_date.day) <span class="hljs-keyword">in</span> response.content)</td></tr></table></code></pre><p>Here we create the post, and assert that it is the sole post object. We then fetch the index page, and assert that the HTTP status code is 200 (ie. the page exists and is returned). We then verify that the response contains the post title, text and publication date.</p><p>Note that for the month, we need to do a bit of jiggery-pokery to get the month name. By default Django will return short month names (eg Jan, Feb etc), but Python stores months as numbers, so we need to format it as a short month name using <code>%b</code>.</p><p>If you run this, you will get an error because the index route isn’t implemented. So let’s fix that. Open up the existing <code>django_tutorial_blog_ng/urls.py</code> file and amend it to look like this:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, include, url</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>admin.autodiscover()</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>urlpatterns = patterns(<span class="hljs-string">''</span>,</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    <span class="hljs-comment"># Examples:</span></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>    <span class="hljs-comment"># url(r'^$', 'django_tutorial_blog_ng.views.home', name='home'),</span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>    <span class="hljs-comment"># url(r'^blog/', include('blog.urls')),</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>    url(<span class="hljs-string">r'^admin/'</span>, include(admin.site.urls)),</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td>    <span class="hljs-comment"># Blog URLs</span></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>    url(<span class="hljs-string">r'^.*$'</span>, include(<span class="hljs-string">'blogengine.urls'</span>)),</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>)</td></tr></table></code></pre><p>Then, create a new file at <code>blogengine/urls.py</code> and edit it as follows:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> patterns, url</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-keyword">from</span> django.views.generic <span class="hljs-keyword">import</span> ListView</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td><span class="hljs-keyword">from</span> blogengine.models <span class="hljs-keyword">import</span> Post</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>urlpatterns = patterns(<span class="hljs-string">''</span>,</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>    <span class="hljs-comment"># Index</span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>    url(<span class="hljs-string">'^$'</span>, ListView.as_view(</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        model=Post,</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        )),</td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>)</td></tr></table></code></pre><p>A little explanation is called for. The project has its own <code>urls.py</code> file that handles routing throughout the project. However, because Django encourages you to make your apps reusable, we want to keep the routes in the individual apps as far as possible. So, in the project file, we include the <code>blogengine/urls.py</code> file.</p><p>In the app-specific <code>urls.py</code>, we import the Post model and the ListView generic view. We then define a route for the index page - the regular expression <code>^$</code> will match only an empty string, so that page will be the index. For this route, we then call the <code>as_view()</code> method of the ListView object, and set the model as Post.</p><p>Now, if you either run the tests, or run the development server and visit <a href="http://127.0.0.1:8000">the index page</a>, you’ll see that it isn’t working yet - you should see the error <code>TemplateDoesNotExist: blogengine/post_list.html</code>. This tells us that we need to create a template called <code>blogengine/post_list.html</code>, so let’s do that. First of all, add the following at the end of <code>django_tutorial_blog_ng/settings.py</code>:</p><pre><code class="hljs lang-python"><table><tr><td class="linenos" data-pseudo-content="1"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td><span class="hljs-comment"># Template directory</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>TEMPLATE_DIRS = [os.path.join(BASE_DIR, <span class="hljs-string">'templates'</span>)]</td></tr></table></code></pre><p>Next, create the folders for the templates, and a blank <code>post_list.html</code> file:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ mkdir templates</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ mkdir templates/blogengine</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>$ touch templates/blogengine/post_list.html</td></tr></table></code></pre><p>Now, run your tests again, and you’ll see that the template now exists, but a new error is showing up:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>Creating <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>......F</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>======================================================================</td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>FAIL: <span class="hljs-built_in">test</span>_index (blogengine.tests.PostViewTest)</td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>----------------------------------------------------------------------</td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>Traceback (most recent call last):</td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>  File <span class="hljs-string">"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py"</span>, line <span class="hljs-number">189</span>, <span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span>_index</td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>    self.assertTrue(post.title <span class="hljs-keyword">in</span> response.content)</td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>AssertionError: False is not <span class="hljs-literal">true</span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>----------------------------------------------------------------------</td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td>Ran <span class="hljs-number">7</span> tests <span class="hljs-keyword">in</span> <span class="hljs-number">2.162</span>s</td></tr><tr><td class="linenos" data-pseudo-content="13"></td><td></td></tr><tr><td class="linenos" data-pseudo-content="14"></td><td>FAILED (failures=<span class="hljs-number">1</span>)</td></tr><tr><td class="linenos" data-pseudo-content="15"></td><td>Destroying <span class="hljs-built_in">test</span> database <span class="hljs-keyword">for</span> <span class="hljs-built_in">alias</span> <span class="hljs-string">'default'</span>...</td></tr></table></code></pre><p>To fix this, we make sure the template shows the data we want. Open up <code>templates/blogengine/post_list.html</code> and enter the following:</p><pre><code class="hljs lang-django"><table><tr><td class="linenos" data-pseudo-content="1"></td><td><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span></span></td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span></td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>        <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>My Django Blog<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span></td></tr><tr><td class="linenos" data-pseudo-content="4"></td><td>    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span></td></tr><tr><td class="linenos" data-pseudo-content="5"></td><td>    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span></td></tr><tr><td class="linenos" data-pseudo-content="6"></td><td>        <span class="hljs-template_tag">{% <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> object_list %}</span><span class="xml"></span></td></tr><tr><td class="linenos" data-pseudo-content="7"></td><td>        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-variable">{{ post.title }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span></span></td></tr><tr><td class="linenos" data-pseudo-content="8"></td><td>        <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span><span class="hljs-variable">{{ post.pub_date }}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span></span></td></tr><tr><td class="linenos" data-pseudo-content="9"></td><td>        <span class="hljs-variable">{{ post.text }}</span><span class="xml"></span></td></tr><tr><td class="linenos" data-pseudo-content="10"></td><td>        <span class="hljs-template_tag">{% <span class="hljs-keyword">endfor</span> %}</span><span class="xml"></span></td></tr><tr><td class="linenos" data-pseudo-content="11"></td><td>    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span></td></tr><tr><td class="linenos" data-pseudo-content="12"></td><td><span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></td></tr></table></code></pre><p>This is only a very basic template, and we’ll expand upon it in future.</p><p>With that done, you can run <code>python manage.py test</code>, and it should pass. Well done! Don’t forget to commit your changes:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git add django_tutorial_blog_ng/ templates/ blogengine/</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ git commit -m <span class="hljs-string">'Implemented list view for posts'</span></td></tr></table></code></pre><p>And that’s all for this lesson! We’ve done a hell of a lot in this lesson - set up our project, created a comprehensive test suite for it, and implemented the basic functionality. Next time we’ll make it a bit prettier using Twitter Bootstrap, as well as implementing more of the basic functionality for the blog.</p><p>You can find the source code <a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">on Github</a>. For your convenience, I’ve tagged this lesson as <code>lesson-1</code>, so you can just clone the repository and switch to the end of this lesson with the following commands:</p><pre><code class="hljs lang-bash"><table><tr><td class="linenos" data-pseudo-content="1"></td><td>$ git <span class="hljs-built_in">clone</span> https://github.com/matthewbdaly/django_tutorial_blog_ng.git</td></tr><tr><td class="linenos" data-pseudo-content="2"></td><td>$ <span class="hljs-built_in">cd</span> django_tutorial_blog_ng</td></tr><tr><td class="linenos" data-pseudo-content="3"></td><td>$ git checkout lesson-<span class="hljs-number">1</span></td></tr></table></code></pre><p>That way, you can easily check that what you’ve done matches up with the repository. Future lessons will be similarly tagged to make them easy to navigate.</p><ul class="categorylist"><li><a href="/blog/categories/python/">python</a></li><li><a href="/blog/categories/django/">django</a></li><li><a href="/blog/categories/tdd/">tdd</a></li></ul><div class="addthis_sharing_toolbox"></div><section class="comments"><div id="disqus_thread"></div><script type="text/javascript">window.disqus_identifier="http://matthewdaly.co.uk/blog/2013/12/28/django-blog-tutorial-the-next-generation-part-1/";
                    window.disqus_url="http://matthewdaly.co.uk/blog/2013/12/28/django-blog-tutorial-the-next-generation-part-1/";
                    window.disqus_title="Django Blog Tutorial - the Next Generation - Part 1";</script><script type="text/javascript" src="http://disqus.com/forums/matthewdaly/embed.js"></script><noscript><a href="http://matthewdaly.disqus.com/?url=ref">View the discussion thread.</a></noscript></section></article></div><div class="col-md-4"><h1>Recent Posts</h1><p><a href="/blog/2015/09/28/building-a-real-time-twitter-stream-with-node-dot-js-react-dot-js-and-redis/">Building a Real-time Twitter Stream With Node.js, React.js and Redis</a></p><p><a href="/blog/2015/09/19/a-quick-and-easy-varnish-primer/">A Quick and Easy Varnish Primer</a></p><p><a href="/blog/2015/08/22/when-you-should-not-use-wordpress/">When You Should Not Use Wordpress</a></p><p><a href="/blog/2015/08/02/testing-django-views-in-isolation/">Testing Django Views in Isolation</a></p><p><a href="/blog/2015/08/01/exploring-the-hstorefield-in-django-1-dot-8/">Exploring the Hstorefield in Django 1.8</a></p><section id="github-profile"></section><h4>My GitHub repositories</h4><ul id="github-repos"><li>Loading repositories...</li></ul></div></div><div class="row"><div class="col-md-12"><ul class="pager"><li><a href="/blog/2014/01/02/django-blog-tutorial-the-next-generation-part-2/">Django Blog Tutorial - the Next Generation - Part 2</a></li><li><a href="/blog/2013/08/16/a-starting-boilerplate-for-php-development-with-vagrant/">A Starting Boilerplate for PHP Development With Vagrant</a></li></ul></div></div></div><footer><div class="container footercontainer"><div class="col-md-12"><p class="copyright">Copyright &copy; Matthew Daly 2015.</p></div></div></footer><script type="text/javascript" src="/static/js/all.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-17043630-1');ga('send','pageview');</script></body></html>