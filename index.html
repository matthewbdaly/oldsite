
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Matthew Daly's Blog</title>
  <meta name="author" content="Matthew Daly">

  
  <meta name="description" content="The NoSQL movement is an exciting one for web developers. While relational databases such as MySQL are applicable to solving a wide range of problems &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://matthewdaly.co.uk">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Matthew Daly's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17043630-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Matthew Daly's Blog</a></h1>
  
    <h2>I'm a web developer in Norfolk. This is my blog...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:matthewdaly.co.uk" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/09/building-a-url-shortener-with-node-dot-js-and-redis/">Building a URL Shortener With Node.js and Redis</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-09T17:13:16+00:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:13 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The NoSQL movement is an exciting one for web developers. While relational databases such as MySQL are applicable to solving a wide range of problems, they aren&rsquo;t the best solution for every problem. Sometimes you may find yourself dealing with a problem where an alternative data store may make more sense.</p>

<p>Redis is one of the data stores that have appeared as part of this movement, and is arguably one of the more generally useful ones. Since it solves different problems to a relational database, it&rsquo;s not generally useful as an alternative to them - instead it is often used alongside them.</p>

<h2>What is Redis?</h2>

<p>Redis is described as follows on the website:</p>

<blockquote><p>Redis is an open source, BSD licensed, advanced key-value cache and store. It is often referred to as a data structure server since keys can contain strings, hashes, lists, sets, sorted sets, bitmaps and hyperloglogs.</p></blockquote>

<p>In other words, its core functionality is that it allows you to store a value by a key, and later retrieve that data using the key. It also allows you to set an optional expiry time for that key-value pair. It&rsquo;s quite similar to Memcached in that respect, and indeed one obvious use case for Redis is as an alternative to Memcached. However, it offers a number of additional benefits - for one thing, it supports more data types, and for another, it allows you to persist your data to disk (unlike Memcached, which only retains the data in memory, meaning it&rsquo;s lost on restart or if Memcached crashes). The latter means that for some very simple web applications, Redis can be used as your sole data store.</p>

<p>In this tutorial, we&rsquo;ll build a simple URL shortener, using Redis as the sole data store. A URL shortener only really requires two fields:</p>

<ul>
<li>A string to identify the correct URL</li>
<li>The URL</li>
</ul>


<p>That makes Redis a good fit for this use case since all we need to do is generate an ID for each URL, then when a link is followed, look up the URL for that key, and redirect the user to it. As long as this is all our application needs to do, we can quite happily use Redis for this rather than a relational database, and it will be significantly faster than a relational database would be for this use case.</p>

<h2>Getting started</h2>

<p>We&rsquo;re more interested in the fundamentals of using Redis in our application than a specific language here. As JavaScript is pretty much required to be a web developer, I think it&rsquo;s a fairly safe bet to use Node.js rather than PHP or Python, since that way, even if your only experience of JavaScript is client-side, you shouldn&rsquo;t have too much trouble following along.</p>

<p>You&rsquo;ll need to have Node.js installed, and I&rsquo;ll leave the details of installing this to you. You&rsquo;ll also need the Grunt CLI - install this globally as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo npm install -g grunt-cli
</span></code></pre></td></tr></table></div></figure>


<p>Finally, you&rsquo;ll want to have Redis itself installed. You might also want to install hiredis, which is a faster Redis client that gets used automatically where available.</p>

<p>Now, let&rsquo;s create our <code>package.json</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm init
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll see a number of questions. Your generated <code>package.json</code> file should look something like this:</p>

<figure class='code'><figcaption><span>package.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;url-shortener&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A URL shortener&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;grunt test&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;keywords&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="s2">&quot;URL&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;shortener&quot;</span>
</span><span class='line'>  <span class="p">],</span>
</span><span class='line'>  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Matthew Daly &lt;matthew@matthewdaly.co.uk&gt; (http://matthewdaly.co.uk/)&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;GPLv2&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note in particular that we set our test command to <code>grunt test</code>.</p>

<p>Next, we install our required Node.js modules. First, install, the normal dependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm install --save body-parser express redis hiredis jade shortid
</span></code></pre></td></tr></table></div></figure>


<p>Next, install the development dependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm install --save-dev grunt grunt-contrib-jshint grunt-mocha-istanbul istanbul mocha chai request
</span></code></pre></td></tr></table></div></figure>


<p>Now, we&rsquo;re going to use Grunt to run our tests, so that we can easily lint the JavaScript and generate code coverage details. Here&rsquo;s the Gruntfile:</p>

<figure class='code'><figcaption><span>Gruntfile.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">jshint</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">all</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s1">&#39;test/*.js&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="s1">&#39;index.js&#39;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">mocha_istanbul</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">coverage</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">src</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="c1">// the folder, not the files,</span>
</span><span class='line'>                <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">mask</span><span class="o">:</span> <span class="s1">&#39;*.js&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">reportFormats</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;cobertura&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">]</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Load tasks</span>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-jshint&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-mocha-istanbul&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Register tasks</span>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;jshint&#39;</span><span class="p">,</span> <span class="s1">&#39;mocha_istanbul:coverage&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll also create a <code>Procfile</code> in anticipation of deploying the app to Heroku:</p>

<figure class='code'><figcaption><span>Procfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>web: node index.js
</span></code></pre></td></tr></table></div></figure>


<h2>Creating the views</h2>

<p>For this application we&rsquo;ll be using the Express framework and the Jade templating system. We need three templates:</p>

<ul>
<li>Submission form</li>
<li>Output form</li>
<li>404 page</li>
</ul>


<p>Create the folder <code>views</code> under the application directory and add the following files:</p>

<figure class='code'><figcaption><span>views/index.jade</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nt">doctype</span> html
</span><span class='line'><span class="nt">html</span>(<span class="na">lang=</span><span class="s">&quot;en&quot;</span>)
</span><span class='line'>    <span class="nt">head</span>
</span><span class='line'>        <span class="nt">title</span><span class="p">=</span><span class="s">&quot;Shortbread&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">body</span>
</span><span class='line'>        <span class="nt">div</span><span class="nc">.container</span>
</span><span class='line'>            <span class="nt">div</span><span class="nc">.row</span>
</span><span class='line'>                <span class="nt">h1</span> Shortbread
</span><span class='line'>
</span><span class='line'>            <span class="nt">div</span><span class="nc">.row</span>
</span><span class='line'>                <span class="nt">form</span>(<span class="na">action=</span><span class="s">&quot;/&quot;</span><span class="err">,</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span>)
</span><span class='line'>                    <span class="nt">input</span>(<span class="na">type=</span><span class="s">&quot;url&quot;</span><span class="err">,</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span>)
</span><span class='line'>                    <span class="nt">input</span>(<span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="err">,</span> <span class="na">value=</span><span class="s">&quot;Submit&quot;</span>)
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>views/output.jade</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nt">doctype</span> html
</span><span class='line'><span class="nt">html</span>(<span class="na">lang=</span><span class="s">&quot;en&quot;</span>)
</span><span class='line'>    <span class="nt">head</span>
</span><span class='line'>        <span class="nt">title</span><span class="p">=</span><span class="nc">Shortbread</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">body</span>
</span><span class='line'>        <span class="nt">div</span><span class="nc">.container</span>
</span><span class='line'>            <span class="nt">div</span><span class="nc">.row</span>
</span><span class='line'>                <span class="nt">h1</span> Shortbread
</span><span class='line'>                <span class="nt">p</span> Your shortened URL is &lt;a href=&#39;<span class="si">#{</span><span class="n">base_url</span><span class="si">}</span>/<span class="si">#{</span><span class="n">id</span><span class="si">}</span>&#39;&gt;<span class="si">#{</span><span class="n">base_url</span><span class="si">}</span>/<span class="si">#{</span><span class="n">id</span><span class="si">}</span>&lt;/a&gt;
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>views/error.jade</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nt">doctype</span> html
</span><span class='line'><span class="nt">html</span>(<span class="na">lang=</span><span class="s">&quot;en&quot;</span>)
</span><span class='line'>    <span class="nt">head</span>
</span><span class='line'>        <span class="nt">title</span><span class="p">=</span><span class="nc">Shortbread</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">body</span>
</span><span class='line'>        <span class="nt">div</span><span class="nc">.container</span>
</span><span class='line'>            <span class="nt">div</span><span class="nc">.row</span>
</span><span class='line'>                <span class="nt">h1</span> Shortbread
</span><span class='line'>                <span class="nt">p</span> Link not found
</span></code></pre></td></tr></table></div></figure>


<h2>Writing our first test</h2>

<p>We&rsquo;re going to use Mocha for our tests, together with the Chai assertion library. Create a folder called <code>test</code>, and put the following in <code>test/test.js</code>:</p>

<figure class='code'><figcaption><span>test/test.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/*jslint node: true */</span>
</span><span class='line'><span class="cm">/*global describe: false, before: false, after: false, it: false */</span>
</span><span class='line'><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Declare the variables used</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">expect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;chai&#39;</span><span class="p">).</span><span class="nx">expect</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../index&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">redis</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">client</span><span class="p">;</span>
</span><span class='line'><span class="nx">client</span> <span class="o">=</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">createClient</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Server tasks</span>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Beforehand, start the server</span>
</span><span class='line'>    <span class="nx">before</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Starting the server&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Afterwards, stop the server and empty the database</span>
</span><span class='line'>    <span class="nx">after</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Stopping the server&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">client</span><span class="p">.</span><span class="nx">flushdb</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Test the index route</span>
</span><span class='line'>    <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Test the index route&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return a page with the title Shortbread&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span> <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:5000&#39;</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">expect</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;Shortbread&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s1">&#39;text/html; charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code bears a little explanation. First, we import the required modules, as well as our <code>index.js</code> file (which we have yet to add). Then we create a callback to contain our tests.</p>

<p>Inside the callback, we call the <code>before()</code> and <code>after()</code> functions, which let us set up and tear down our tests. As part of the teardown process, we flush the Redis database.</p>

<p>Finally, we fetch our home page and verify that it returns a 200 status code and a content type of text/html, as well as including the name or our application.</p>

<p>We&rsquo;ll need to create our <code>index.js</code> file to avoid a nasty error, but we won&rsquo;t populate it just yet:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>touch index.js
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>grunt <span class="nb">test</span>
</span><span class='line'>Running <span class="s2">&quot;jshint:all&quot;</span> <span class="o">(</span>jshint<span class="o">)</span> task
</span><span class='line'>&gt;&gt; <span class="m">2</span> files lint free.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> <span class="o">(</span>mocha_istanbul<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  server
</span><span class='line'>Starting the server
</span><span class='line'>    Test the index route
</span><span class='line'>      1<span class="o">)</span> should <span class="k">return</span> a page with the title Shortbread
</span><span class='line'>Stopping the server
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="m">0</span> passing <span class="o">(</span>152ms<span class="o">)</span>
</span><span class='line'>  <span class="m">1</span> failing
</span><span class='line'>
</span><span class='line'>  1<span class="o">)</span> server Test the index route should <span class="k">return</span> a page with the title Shortbread:
</span><span class='line'>     Uncaught AssertionError: expected undefined to include <span class="s1">&#39;Shortbread&#39;</span>
</span><span class='line'>      at Request._callback <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/test/test.js:33:33<span class="o">)</span>
</span><span class='line'>      at self.callback <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:372:22<span class="o">)</span>
</span><span class='line'>      at Request.emit <span class="o">(</span>events.js:95:17<span class="o">)</span>
</span><span class='line'>      at Request.onRequestError <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:963:8<span class="o">)</span>
</span><span class='line'>      at ClientRequest.emit <span class="o">(</span>events.js:95:17<span class="o">)</span>
</span><span class='line'>      at Socket.socketErrorListener <span class="o">(</span>http.js:1551:9<span class="o">)</span>
</span><span class='line'>      at Socket.emit <span class="o">(</span>events.js:95:17<span class="o">)</span>
</span><span class='line'>      at net.js:440:14
</span><span class='line'>      at process._tickCallback <span class="o">(</span>node.js:419:13<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>Writing coverage object <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json<span class="o">]</span>
</span><span class='line'>Writing coverage reports at <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage<span class="o">]</span>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>
</span><span class='line'><span class="o">===============================</span> Coverage <span class="nv">summary</span> <span class="o">===============================</span>
</span><span class='line'>Statements   : 100% <span class="o">(</span> 0/0 <span class="o">)</span>
</span><span class='line'>Branches     : 100% <span class="o">(</span> 0/0 <span class="o">)</span>
</span><span class='line'>Functions    : 100% <span class="o">(</span> 0/0 <span class="o">)</span>
</span><span class='line'>Lines        : 100% <span class="o">(</span> 0/0 <span class="o">)</span>
</span><span class='line'><span class="o">================================================================================</span>
</span><span class='line'>&gt;&gt;
</span><span class='line'>Warning: Task <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> failed. Use --force to <span class="k">continue</span>.
</span><span class='line'>
</span><span class='line'>Aborted due to warnings.
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have a failing test, we can start work on our app proper. Open up <code>index.js</code> and add the following code:</p>

<figure class='code'><figcaption><span>index.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/*jslint node: true */</span>
</span><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Declare variables used</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">base_url</span><span class="p">,</span> <span class="nx">bodyParser</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">express</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">rtg</span><span class="p">,</span> <span class="nx">shortid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Define values</span>
</span><span class='line'><span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class='line'><span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">5000</span><span class="p">;</span>
</span><span class='line'><span class="nx">shortid</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;shortid&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">base_url</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BASE_URL</span> <span class="o">||</span> <span class="s1">&#39;http://localhost:5000&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Set up connection to Redis</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDISTOGO_URL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">rtg</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDISTOGO_URL</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;redis&quot;</span><span class="p">).</span><span class="nx">createClient</span><span class="p">(</span><span class="nx">rtg</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">rtg</span><span class="p">.</span><span class="nx">hostname</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">client</span><span class="p">.</span><span class="nx">auth</span><span class="p">(</span><span class="nx">rtg</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">).</span><span class="nx">createClient</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Set up templating</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="s2">&quot;jade&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">&#39;jade&#39;</span><span class="p">,</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jade&#39;</span><span class="p">).</span><span class="nx">__express</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Set URL</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;base_url&#39;</span><span class="p">,</span> <span class="nx">base_url</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Handle POST data</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">extended</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'><span class="p">}));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Define index route</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Serve static files</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/static&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Listen</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Listening on port &#39;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s go through this code. First we confirm that linting tools should treat this as a Node app, and use strict mode (I recommend always using strict mode in JavaScript).</p>

<p>Then we declare our variables and import the required modules. Note here that we set the port to 5000, but can also set it based on the <code>PORT</code> environment variable, which is used by Heroku. We also define a base URL, which again can be overriden from an environment variable when hosted on Heroku.</p>

<p>We then set up our connection to our Redis instance. When we push the code up to Heroku, we&rsquo;ll use the Redis To Go addon, so we check for an environment variable containing the Redis URL. If it&rsquo;s set, we use that to connect. Otherwise, we just connect as normal.</p>

<p>We then set up templating using Jade, and define the folder containing our views, and store the base URL within the app. Then we set up <code>bodyParser</code> so that Express can handle POST data.</p>

<p>Next, we define our index route to just render the <code>index.jade</code> file. Finally, we set up our static folder and set the app to listen on the correct port.</p>

<p>Let&rsquo;s run our test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> grunt <span class="nb">test</span>
</span><span class='line'>Running <span class="s2">&quot;jshint:all&quot;</span> <span class="o">(</span>jshint<span class="o">)</span> task
</span><span class='line'>&gt;&gt; <span class="m">2</span> files lint free.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> <span class="o">(</span>mocha_istanbul<span class="o">)</span> task
</span><span class='line'>Listening on port 5000
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  server
</span><span class='line'>Starting the server
</span><span class='line'>    Test the index route
</span><span class='line'>       should <span class="k">return</span> a page with the title Shortbread <span class="o">(</span>116ms<span class="o">)</span>
</span><span class='line'>Stopping the server
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="m">1</span> passing <span class="o">(</span>128ms<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>Writing coverage object <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json<span class="o">]</span>
</span><span class='line'>Writing coverage reports at <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage<span class="o">]</span>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>
</span><span class='line'><span class="o">===============================</span> Coverage <span class="nv">summary</span> <span class="o">===============================</span>
</span><span class='line'>Statements   : 86.96% <span class="o">(</span> 20/23 <span class="o">)</span>
</span><span class='line'>Branches     : 83.33% <span class="o">(</span> 5/6 <span class="o">)</span>
</span><span class='line'>Functions    : 100% <span class="o">(</span> 1/1 <span class="o">)</span>
</span><span class='line'>Lines        : 86.96% <span class="o">(</span> 20/23 <span class="o">)</span>
</span><span class='line'><span class="o">================================================================================</span>
</span><span class='line'>&gt;&gt; Done. Check coverage folder.
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span></code></pre></td></tr></table></div></figure>


<p>Note that Istanbul will have generated a nice HTML coverage report, which will be at <code>coverage/index.html</code>, but this won&rsquo;t show 100% test coverage due to the Heroku-specific Redis section. To fix this, amend that section as follows:</p>

<figure class='code'><figcaption><span>index.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/* istanbul ignore if */</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDISTOGO_URL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">rtg</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDISTOGO_URL</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;redis&quot;</span><span class="p">).</span><span class="nx">createClient</span><span class="p">(</span><span class="nx">rtg</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">rtg</span><span class="p">.</span><span class="nx">hostname</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">client</span><span class="p">.</span><span class="nx">auth</span><span class="p">(</span><span class="nx">rtg</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">).</span><span class="nx">createClient</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Telling Istanbul to ignore the if clause resolves that problem nicely.</p>

<h2>Submitting a URL</h2>

<p>Next, let&rsquo;s add the ability to add a URL. First, add the following test, after the one for the index:</p>

<figure class='code'><figcaption><span>test/test.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Test submitting a URL</span>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Test submitting a URL&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return the shortened URL&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://localhost:5000&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">form</span><span class="o">:</span> <span class="p">{</span><span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.google.co.uk&#39;</span><span class="p">}},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">expect</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;Your shortened URL is&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s1">&#39;text/html; charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>This test submits a URL via POST, and checks to see that the response view gets returned. Now, let&rsquo;s run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>grunt <span class="nb">test</span>
</span><span class='line'>Running <span class="s2">&quot;jshint:all&quot;</span> <span class="o">(</span>jshint<span class="o">)</span> task
</span><span class='line'>&gt;&gt; <span class="m">2</span> files lint free.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> <span class="o">(</span>mocha_istanbul<span class="o">)</span> task
</span><span class='line'>Listening on port 5000
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  server
</span><span class='line'>Starting the server
</span><span class='line'>    Test the index route
</span><span class='line'>       should <span class="k">return</span> a page with the title Shortbread <span class="o">(</span>223ms<span class="o">)</span>
</span><span class='line'>    Test submitting a URL
</span><span class='line'>      1<span class="o">)</span> should <span class="k">return</span> the shortened URL
</span><span class='line'>Stopping the server
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="m">1</span> passing <span class="o">(</span>318ms<span class="o">)</span>
</span><span class='line'>  <span class="m">1</span> failing
</span><span class='line'>
</span><span class='line'>  1<span class="o">)</span> server Test submitting a URL should <span class="k">return</span> the shortened URL:
</span><span class='line'>     Uncaught AssertionError: expected <span class="s1">&#39;Cannot POST /\n&#39;</span> to include <span class="s1">&#39;Your shortened URL is&#39;</span>
</span><span class='line'>      at Request._callback <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/test/test.js:45:33<span class="o">)</span>
</span><span class='line'>      at Request.self.callback <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:372:22<span class="o">)</span>
</span><span class='line'>      at Request.emit <span class="o">(</span>events.js:98:17<span class="o">)</span>
</span><span class='line'>      at Request.&lt;anonymous&gt; <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1310:14<span class="o">)</span>
</span><span class='line'>      at Request.emit <span class="o">(</span>events.js:117:20<span class="o">)</span>
</span><span class='line'>      at IncomingMessage.&lt;anonymous&gt; <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1258:12<span class="o">)</span>
</span><span class='line'>      at IncomingMessage.emit <span class="o">(</span>events.js:117:20<span class="o">)</span>
</span><span class='line'>      at _stream_readable.js:943:16
</span><span class='line'>      at process._tickCallback <span class="o">(</span>node.js:419:13<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>Writing coverage object <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json<span class="o">]</span>
</span><span class='line'>Writing coverage reports at <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage<span class="o">]</span>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>
</span><span class='line'><span class="o">===============================</span> Coverage <span class="nv">summary</span> <span class="o">===============================</span>
</span><span class='line'>Statements   : 100% <span class="o">(</span> 23/23 <span class="o">)</span>, <span class="m">3</span> ignored
</span><span class='line'>Branches     : 100% <span class="o">(</span> 6/6 <span class="o">)</span>, <span class="m">1</span> ignored
</span><span class='line'>Functions    : 100% <span class="o">(</span> 1/1 <span class="o">)</span>
</span><span class='line'>Lines        : 100% <span class="o">(</span> 23/23 <span class="o">)</span>
</span><span class='line'><span class="o">================================================================================</span>
</span><span class='line'>&gt;&gt;
</span><span class='line'>Warning: Task <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> failed. Use --force to <span class="k">continue</span>.
</span><span class='line'>
</span><span class='line'>Aborted due to warnings.
</span></code></pre></td></tr></table></div></figure>


<p>We have a failing test, so let&rsquo;s make it pass. Add the following route after the index one:</p>

<figure class='code'><figcaption><span>index.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Define submit route</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Declare variables</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Get URL</span>
</span><span class='line'>    <span class="nx">url</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Create a hashed short version</span>
</span><span class='line'>    <span class="nx">id</span> <span class="o">=</span> <span class="nx">shortid</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Store them in Redis</span>
</span><span class='line'>    <span class="nx">client</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Display the response</span>
</span><span class='line'>        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">base_url</span><span class="o">:</span> <span class="nx">base_url</span> <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>This route is fairly simple. It handles POST requests to the index route, and first of all it gets the URL from the POST request. Then it randomly generates a hash to use as the key.</p>

<p>The next part is where we see Redis in action. We create a new key-value pair, with the key set to the newly generated ID, and the value set to the URL. Once Redis confirms that has been done, the callback is fired, which renders the <code>output.jade</code> view with the ID and base URL passed through, so that we can see our shortened URL.</p>

<p>With that done, our test should pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>grunt <span class="nb">test</span>
</span><span class='line'>Running <span class="s2">&quot;jshint:all&quot;</span> <span class="o">(</span>jshint<span class="o">)</span> task
</span><span class='line'>&gt;&gt; <span class="m">2</span> files lint free.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> <span class="o">(</span>mocha_istanbul<span class="o">)</span> task
</span><span class='line'>Listening on port 5000
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  server
</span><span class='line'>Starting the server
</span><span class='line'>    Test the index route
</span><span class='line'>       should <span class="k">return</span> a page with the title Shortbread <span class="o">(</span>89ms<span class="o">)</span>
</span><span class='line'>    Test submitting a URL
</span><span class='line'>       should <span class="k">return</span> the shortened URL <span class="o">(</span>65ms<span class="o">)</span>
</span><span class='line'>Stopping the server
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="m">2</span> passing <span class="o">(</span>167ms<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>Writing coverage object <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json<span class="o">]</span>
</span><span class='line'>Writing coverage reports at <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage<span class="o">]</span>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>
</span><span class='line'><span class="o">===============================</span> Coverage <span class="nv">summary</span> <span class="o">===============================</span>
</span><span class='line'>Statements   : 100% <span class="o">(</span> 29/29 <span class="o">)</span>, <span class="m">3</span> ignored
</span><span class='line'>Branches     : 100% <span class="o">(</span> 6/6 <span class="o">)</span>, <span class="m">1</span> ignored
</span><span class='line'>Functions    : 100% <span class="o">(</span> 3/3 <span class="o">)</span>
</span><span class='line'>Lines        : 100% <span class="o">(</span> 29/29 <span class="o">)</span>
</span><span class='line'><span class="o">================================================================================</span>
</span><span class='line'>&gt;&gt; Done. Check coverage folder.
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span></code></pre></td></tr></table></div></figure>


<p>Our final task is to implement the short URL handling. We want to check to see if a short URL exists. If it does, we redirect the user to the destination. If it doesn&rsquo;t, we raise a 404 error. For that we need two more tests. Here they are:</p>

<figure class='code'><figcaption><span>test/test.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>    <span class="c1">// Test following a URL</span>
</span><span class='line'>    <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Test following a URL&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should redirect the user to the shortened URL&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Create the URL</span>
</span><span class='line'>            <span class="nx">client</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;testurl&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.google.com&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// Follow the link</span>
</span><span class='line'>                <span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span>
</span><span class='line'>                    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:5000/testurl&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">followRedirect</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'>                <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">location</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s1">&#39;http://www.google.com&#39;</span><span class="p">);</span>
</span><span class='line'>                    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">301</span><span class="p">);</span>
</span><span class='line'>                    <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>                <span class="p">});</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Test non-existent link</span>
</span><span class='line'>    <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Test following a non-existent-link&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return a 404 error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Follow the link</span>
</span><span class='line'>            <span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span>
</span><span class='line'>                <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:5000/nonexistenturl&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">followRedirect</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'>            <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">expect</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">&#39;Link not found&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first test creates a URL for testing purposes. It then navigates to that URL. Note that we set <code>followRedirect</code> to <code>true</code> - this is because, by default, <code>request</code> will follow any redirect, so we need to prevent it from doing so to ensure that the headers to redirect the user are set correctly.</p>

<p>Once the response has been received, we then check that the status code is 301 (Moved Permanently), and that the <code>Location</code> header is set to the correct destination. When a real browser visits this page, it will be redirected accordingly.</p>

<p>The second test tries to fetch a non-existent URL, and checks that the status code is 404, and the response contains the words <code>Link not found</code>.</p>

<p>If we run our tests, they should now fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>grunt <span class="nb">test</span>
</span><span class='line'>Running <span class="s2">&quot;jshint:all&quot;</span> <span class="o">(</span>jshint<span class="o">)</span> task
</span><span class='line'>&gt;&gt; <span class="m">2</span> files lint free.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> <span class="o">(</span>mocha_istanbul<span class="o">)</span> task
</span><span class='line'>Listening on port 5000
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  server
</span><span class='line'>Starting the server
</span><span class='line'>    Test the index route
</span><span class='line'>       should <span class="k">return</span> a page with the title Shortbread <span class="o">(</span>252ms<span class="o">)</span>
</span><span class='line'>    Test submitting a URL
</span><span class='line'>       should <span class="k">return</span> the shortened URL <span class="o">(</span>47ms<span class="o">)</span>
</span><span class='line'>    Test following a URL
</span><span class='line'>      1<span class="o">)</span> should redirect the user to the shortened URL
</span><span class='line'>    Test following a non-existent-link
</span><span class='line'>      2<span class="o">)</span> should <span class="k">return</span> a <span class="m">404</span> error
</span><span class='line'>Stopping the server
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="m">2</span> passing <span class="o">(</span>322ms<span class="o">)</span>
</span><span class='line'>  <span class="m">2</span> failing
</span><span class='line'>
</span><span class='line'>  1<span class="o">)</span> server Test following a URL should redirect the user to the shortened URL:
</span><span class='line'>     Uncaught AssertionError: expected undefined to equal <span class="s1">&#39;http://www.google.com&#39;</span>
</span><span class='line'>      at Request._callback <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/test/test.js:63:58<span class="o">)</span>
</span><span class='line'>      at Request.self.callback <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:372:22<span class="o">)</span>
</span><span class='line'>      at Request.emit <span class="o">(</span>events.js:98:17<span class="o">)</span>
</span><span class='line'>      at Request.&lt;anonymous&gt; <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1310:14<span class="o">)</span>
</span><span class='line'>      at Request.emit <span class="o">(</span>events.js:117:20<span class="o">)</span>
</span><span class='line'>      at IncomingMessage.&lt;anonymous&gt; <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1258:12<span class="o">)</span>
</span><span class='line'>      at IncomingMessage.emit <span class="o">(</span>events.js:117:20<span class="o">)</span>
</span><span class='line'>      at _stream_readable.js:943:16
</span><span class='line'>      at process._tickCallback <span class="o">(</span>node.js:419:13<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  2<span class="o">)</span> server Test following a non-existent-link should <span class="k">return</span> a <span class="m">404</span> error:
</span><span class='line'>     Uncaught AssertionError: expected <span class="s1">&#39;Cannot GET /nonexistenturl\n&#39;</span> to include <span class="s1">&#39;Link not found&#39;</span>
</span><span class='line'>      at Request._callback <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/test/test.js:80:33<span class="o">)</span>
</span><span class='line'>      at Request.self.callback <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:372:22<span class="o">)</span>
</span><span class='line'>      at Request.emit <span class="o">(</span>events.js:98:17<span class="o">)</span>
</span><span class='line'>      at Request.&lt;anonymous&gt; <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1310:14<span class="o">)</span>
</span><span class='line'>      at Request.emit <span class="o">(</span>events.js:117:20<span class="o">)</span>
</span><span class='line'>      at IncomingMessage.&lt;anonymous&gt; <span class="o">(</span>/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1258:12<span class="o">)</span>
</span><span class='line'>      at IncomingMessage.emit <span class="o">(</span>events.js:117:20<span class="o">)</span>
</span><span class='line'>      at _stream_readable.js:943:16
</span><span class='line'>      at process._tickCallback <span class="o">(</span>node.js:419:13<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>Writing coverage object <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json<span class="o">]</span>
</span><span class='line'>Writing coverage reports at <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage<span class="o">]</span>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>
</span><span class='line'><span class="o">===============================</span> Coverage <span class="nv">summary</span> <span class="o">===============================</span>
</span><span class='line'>Statements   : 100% <span class="o">(</span> 29/29 <span class="o">)</span>, <span class="m">3</span> ignored
</span><span class='line'>Branches     : 100% <span class="o">(</span> 6/6 <span class="o">)</span>, <span class="m">1</span> ignored
</span><span class='line'>Functions    : 100% <span class="o">(</span> 3/3 <span class="o">)</span>
</span><span class='line'>Lines        : 100% <span class="o">(</span> 29/29 <span class="o">)</span>
</span><span class='line'><span class="o">================================================================================</span>
</span><span class='line'>&gt;&gt;
</span><span class='line'>Warning: Task <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> failed. Use --force to <span class="k">continue</span>.
</span><span class='line'>
</span><span class='line'>Aborted due to warnings.
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s add our final route:</p>

<figure class='code'><figcaption><span>index.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Define link route</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">).</span><span class="nx">all</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Get ID</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Look up the URL</span>
</span><span class='line'>    <span class="nx">client</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Redirect user to it</span>
</span><span class='line'>            <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">301</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">res</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="nx">reply</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Confirm no such link in database</span>
</span><span class='line'>            <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>We accept the ID as a parameter in the URL. We trim off any whitespace around it, and then we query Redis for a URL with that ID. If we find one, we set the status code to 301, and the location to the URL, and send the response. Otherwise, we set the status to 404 and render the error view.</p>

<p>Now, let&rsquo;s check it passes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>grunt <span class="nb">test</span>
</span><span class='line'>Running <span class="s2">&quot;jshint:all&quot;</span> <span class="o">(</span>jshint<span class="o">)</span> task
</span><span class='line'>&gt;&gt; <span class="m">2</span> files lint free.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;mocha_istanbul:coverage&quot;</span> <span class="o">(</span>mocha_istanbul<span class="o">)</span> task
</span><span class='line'>Listening on port 5000
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  server
</span><span class='line'>Starting the server
</span><span class='line'>    Test the index route
</span><span class='line'>       should <span class="k">return</span> a page with the title Shortbread <span class="o">(</span>90ms<span class="o">)</span>
</span><span class='line'>    Test submitting a URL
</span><span class='line'>       should <span class="k">return</span> the shortened URL <span class="o">(</span>47ms<span class="o">)</span>
</span><span class='line'>    Test following a URL
</span><span class='line'>       should redirect the user to the shortened URL
</span><span class='line'>    Test following a non-existent-link
</span><span class='line'>       should <span class="k">return</span> a <span class="m">404</span> error
</span><span class='line'>Stopping the server
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="m">4</span> passing <span class="o">(</span>191ms<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>Writing coverage object <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json<span class="o">]</span>
</span><span class='line'>Writing coverage reports at <span class="o">[</span>/Users/matthewdaly/Projects/url-shortener/coverage<span class="o">]</span>
</span><span class='line'><span class="o">=============================================================================</span>
</span><span class='line'>
</span><span class='line'><span class="o">===============================</span> Coverage <span class="nv">summary</span> <span class="o">===============================</span>
</span><span class='line'>Statements   : 100% <span class="o">(</span> 38/38 <span class="o">)</span>, <span class="m">3</span> ignored
</span><span class='line'>Branches     : 100% <span class="o">(</span> 10/10 <span class="o">)</span>, <span class="m">1</span> ignored
</span><span class='line'>Functions    : 100% <span class="o">(</span> 5/5 <span class="o">)</span>
</span><span class='line'>Lines        : 100% <span class="o">(</span> 38/38 <span class="o">)</span>
</span><span class='line'><span class="o">================================================================================</span>
</span><span class='line'>&gt;&gt; Done. Check coverage folder.
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span></code></pre></td></tr></table></div></figure>


<p>Excellent! Our URL shortener is now complete. From here, deploying it to Heroku is straightforward - you&rsquo;ll need to install the Redis to Go addon, and refer to Heroku&rsquo;s documentation on deploying Node.js applications for more details.</p>

<h2>Wrapping up</h2>

<p>You&rsquo;ll find the source for this application at <a href="https://github.com/matthewbdaly/Shortbread">https://github.com/matthewbdaly/Shortbread</a> and a demo at <a href="http://shortbread-example.herokuapp.com/">http://shortbread-example.herokuapp.com/</a>.</p>

<p>I hope you&rsquo;ve enjoyed this brief introduction to Redis, and that it&rsquo;s opened your eyes to at least one of the alternatives out there to a relational database. I&rsquo;ll hopefully be able to follow this up with examples of some other problems Redis is ideal for solving.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/19/my-django-web-server-setup/">My Django Web Server Setup</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-19T19:52:28+01:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:52 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This isn&rsquo;t really part of my Django tutorial series (that has now definitely concluded!), but I thought I&rsquo;d share the setup I generally use for deploying Django applications, partly for my own reference, and partly because it is quite complex, and those readers who don&rsquo;t wish to deploy to Heroku may want some guidance on how to deploy their new blogs to a VPS.</p>

<h2>Operating system</h2>

<p>This isn&rsquo;t actually that much of a big deal, but while I prefer Ubuntu on desktops, I generally use Debian Stable on servers, since it&rsquo;s fanatically stable.</p>

<h2>Database server</h2>

<p>For my first commercial Django app, I used MySQL. However, South had one or two issues with MySQL, and I figured that since using an ORM and migrations meant that I wouldn&rsquo;t need to write much SQL anyway, I might as well jump to PostgreSQL for the Django app I&rsquo;m currently in the process of deploying at work. So far I haven&rsquo;t had any problems with it.</p>

<h2>Web server</h2>

<p>It&rsquo;s customary to use two web servers with Django. One handles the static content, and reverse proxies everything else to a different port, where another web server serves the dynamic content.</p>

<p>For serving the static files, I use Nginx - it&rsquo;s generally considered to be faster than Apache for this use case. Here&rsquo;s a typical Nginx config file:</p>

<figure class='code'><figcaption><span>/etc/nginx/sites-available/default</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">server</span> <span class="p">{</span>
</span><span class='line'>    <span class="err">listen</span> <span class="err">80;</span>
</span><span class='line'>    <span class="err">server_name</span> <span class="err">example.com;</span>
</span><span class='line'>    <span class="err">client_max_body_size</span> <span class="err">50M;</span>
</span><span class='line'>
</span><span class='line'>    <span class="err">access_log</span> <span class="err">/var/log/nginx/access.log;</span>
</span><span class='line'>    <span class="err">error_log</span> <span class="err">/var/log/nginx/error.log;</span>
</span><span class='line'>
</span><span class='line'>    <span class="err">location</span> <span class="err">/static</span> <span class="err">{</span>
</span><span class='line'>        <span class="err">root</span> <span class="err">/var/www/mysite;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="err">location</span> <span class="err">/media</span> <span class="p">{</span>
</span><span class='line'>        <span class="err">root</span> <span class="err">/var/www/mysite;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="err">location</span> <span class="err">/</span> <span class="p">{</span>
</span><span class='line'>        <span class="err">proxy_pass</span> <span class="err">http://127.0.0.1:8000;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the application server, I use Gunicorn. You can install this with <code>pip install gunicorn</code>, then add it to <code>INSTALLED_APPS</code>. Then add the following config file to the root of your project:</p>

<figure class='code'><figcaption><span>gunicorn.conf.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">bind</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1:8000&quot;</span>
</span><span class='line'><span class="n">logfile</span> <span class="o">=</span> <span class="s">&quot;/var/log/gunicorn.log&quot;</span>
</span><span class='line'><span class="n">loglevel</span> <span class="o">=</span> <span class="s">&quot;debug&quot;</span>
</span><span class='line'><span class="n">workers</span> <span class="o">=</span> <span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should normally set the number of workers to 2 times the number of cores on your machine, plus one.</p>

<p>In order to keep Gunicorn running, I use Supervisor. As the installation commands will depend on your OS, I won&rsquo;t give details here - your package manager of choice should have a suitable package available. Here&rsquo;s a typical Supervisor config file I might use for running Gunicorn for a Django app:</p>

<figure class='code'><figcaption><span>/etc/supervisor/conf.d/mysite-supervisor.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>program:mysite<span class="o">]</span>
</span><span class='line'><span class="nb">command</span><span class="o">=</span>/var/www/mysite/venv/bin/gunicorn myapp.wsgi:application --workers<span class="o">=</span>3
</span><span class='line'><span class="nv">directory</span><span class="o">=</span>/var/www/mysite/
</span><span class='line'><span class="nv">user</span><span class="o">=</span>nobody
</span><span class='line'><span class="nv">autostart</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">autorestart</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once that&rsquo;s in place, you can easily add the new app:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo supervisorctl reread
</span><span class='line'>sudo supervisorctl update
</span></code></pre></td></tr></table></div></figure>


<p>Then to start it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo supervisorctl start mysite
</span></code></pre></td></tr></table></div></figure>


<p>Or stop it with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo supervisorctl stop mysite
</span></code></pre></td></tr></table></div></figure>


<p>Or restart it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo supervisorctl restart mysite
</span></code></pre></td></tr></table></div></figure>


<h2>Celery</h2>

<p>So far, both of the web apps I&rsquo;ve built professionally have been ones where it made sense to use <a href="http://www.celeryproject.org/">Celery</a> for some tasks. For the uninitiated, Celery lets you pass a task to a queue to be handled, rather than handling it within the context of the same HTTP request. This offers the following advantages:</p>

<ul>
<li>The user doesn&rsquo;t need to wait for the task to be completed before getting a response, improving performance</li>
<li>It&rsquo;s more robust, since if the task fails, it can be automatically retried</li>
<li>The task queue can be moved to another server if desired, making it easier to scale</li>
<li>Scheduling tasks</li>
</ul>


<p>I&rsquo;ve used it in cases where I needed to send an email or a push notification, since these don&rsquo;t have to be done within the context of the same HTTP request, but need to be reliable.</p>

<p>I generally use RabbitMQ as my message queue. I&rsquo;ll leave setting this up as an exercise for the reader since it&rsquo;s covered pretty well in the Celery documentation, but like with Gunicorn, I use Supervisor to run the Celery worker. Here&rsquo;s a typical config file:</p>

<figure class='code'><figcaption><span>/etc/supervisor/conf.d/celery-supervisor.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>program:celeryd<span class="o">]</span>
</span><span class='line'><span class="nb">command</span><span class="o">=</span>/var/www/mysite/venv/bin/python manage.py celery worker
</span><span class='line'><span class="nv">directory</span><span class="o">=</span>/var/www/mysite/
</span><span class='line'><span class="nv">user</span><span class="o">=</span>nobody
</span><span class='line'><span class="nv">autostart</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="nv">autorestart</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then start it up:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo supervisorctl reread
</span><span class='line'>sudo supervisorctl update
</span><span class='line'>sudo supervisorctl start celeryd
</span></code></pre></td></tr></table></div></figure>


<p>I make no claims about how good this setup is, but it works well for me. I haven&rsquo;t yet had the occasion to deploy a Django app to anywhere other than Heroku that really benefited from caching, so I haven&rsquo;t got any tips to share about that, but if I were building a content-driven web app, I would use Memcached since it&rsquo;s well-supported.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/05/introducing-generator-simple-static-blog/">Introducing Generator-simple-static-blog</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-05T19:56:46+01:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:56 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m a big fan of static site generators. I ditched WordPress for Octopress over two years ago because it was free to host on GitHub Pages and much faster, had much better syntax highlighting, and I liked being able to write posts in Vim, and I&rsquo;ve never looked back since.</p>

<p>That said, Octopress is written in Ruby, a language I&rsquo;ve never been that keen on. Ideally I&rsquo;d prefer to use Python or JavaScript, but none of the solutions I&rsquo;ve found have been to my liking. Recently I&rsquo;ve been using Grunt and Yeoman to some extent, and I&rsquo;ve wondered about the idea of creating a Yeoman generator to build a static blogging engine. After discovering <code>grunt-markdown-blog</code>, I took the plunge and have built a simple blog generator called <a href="https://github.com/matthewbdaly/generator-simple-static-blog">generator-simple-static-blog</a>.</p>

<p>I&rsquo;ve published it to NPM, so feel free to check it out. It includes code highlighting with the Zenburn colour scheme by default (although highlight.js includes many other themes, so just switch to another one if you want), and it should be easy to edit the templates. I&rsquo;ve also included the ability to deploy automatically to GitHub Pages using Grunt.</p>

<p>I don&rsquo;t anticipate moving over to this from Octopress for the foreseeable future, but it&rsquo;s been an interesting project for the weekend.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/28/django-blog-tutorial-the-next-generation-part-9/">Django Blog Tutorial - the Next Generation - Part 9</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-28T20:51:02+01:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:51 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Yes, I know the eight instalment was meant to be the last one! Within 24 hours of that post going live, Django 1.7 was released, so naturally I&rsquo;d like to show you how to upgrade to it.</p>

<p>The biggest change is that Django 1.7 introduces its own migration system, which means South is now surplus to requirements. We therefore need to switch from South to Django&rsquo;s native migrations. Fortunately, this is fairly straightforward.</p>

<p>First of all, activate your virtualenv:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>virtualenv venv
</span></code></pre></td></tr></table></div></figure>


<p>Then make sure your migrations are up to date:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py syncdb
</span><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Then, upgrade your Django version and uninstall South:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install Django --upgrade
</span><span class='line'>pip uninstall South
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Next, remove South from <code>INSTALLED_APPS</code> in <code>django_tutorial_blog_ng/settings.py</code>.</p>

<p>You now need to delete all of the numbered migration files in <code>blogengine/migrations/</code>, and the relevant <code>.pyc</code> files, but NOT the directory or the <code>__init__.py</code> file. You can do so with this command on Linux or OS X:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rm blogengine/migrations/00*
</span></code></pre></td></tr></table></div></figure>


<p>Next, we recreate our migrations with the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py makemigrations
</span><span class='line'>Migrations <span class="k">for</span> <span class="s1">&#39;blogengine&#39;</span>:
</span><span class='line'>  0001_initial.py:
</span><span class='line'>    - Create model Category
</span><span class='line'>    - Create model Post
</span><span class='line'>    - Create model Tag
</span><span class='line'>    - Add field tags to post
</span></code></pre></td></tr></table></div></figure>


<p>Then we run the migrations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py migrate
</span><span class='line'>Operations to perform:
</span><span class='line'>  Synchronize unmigrated apps: sitemaps, django_jenkins, debug_toolbar
</span><span class='line'>  Apply all migrations: sessions, admin, sites, flatpages, contenttypes, auth, blogengine
</span><span class='line'>Synchronizing apps without migrations:
</span><span class='line'>  Creating tables...
</span><span class='line'>  Installing custom SQL...
</span><span class='line'>  Installing indexes...
</span><span class='line'>Running migrations:
</span><span class='line'>  Applying contenttypes.0001_initial... FAKED
</span><span class='line'>  Applying auth.0001_initial... FAKED
</span><span class='line'>  Applying admin.0001_initial... FAKED
</span><span class='line'>  Applying sites.0001_initial... FAKED
</span><span class='line'>  Applying blogengine.0001_initial... FAKED
</span><span class='line'>  Applying flatpages.0001_initial... FAKED
</span><span class='line'>  Applying sessions.0001_initial... FAKED
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t worry too much if the output doesn&rsquo;t look exactly the same as this - as long as it works, that&rsquo;s the main thing.</p>

<p>Let&rsquo;s run our test suite to ensure it works:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>....FF.F.FFFFFF..............
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 385, in test_create_post
</span><span class='line'>    self.assertTrue<span class="o">(</span><span class="s1">&#39;added successfully&#39;</span> in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_post_without_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 417, in test_create_post_without_tag
</span><span class='line'>    self.assertTrue<span class="o">(</span><span class="s1">&#39;added successfully&#39;</span> in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_delete_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 278, in test_delete_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_delete_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 346, in test_delete_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 255, in test_edit_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 447, in test_edit_post
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 323, in test_edit_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_login <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 183, in test_login
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">302</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_logout <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 214, in test_logout
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">302</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">29</span> tests in 7.383s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>9<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>We have an issue here. A load of the tests for the admin interface now fail. If we now try running the dev server, we see this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py runserver
</span><span class='line'>Performing system checks...
</span><span class='line'>
</span><span class='line'>System check identified no issues <span class="o">(</span><span class="m">0</span> silenced<span class="o">)</span>.
</span><span class='line'>September 28, <span class="m">2014</span> - 20:16:47
</span><span class='line'>Django version 1.7, using settings <span class="s1">&#39;django_tutorial_blog_ng.settings&#39;</span>
</span><span class='line'>Starting development server at http://127.0.0.1:8000/
</span><span class='line'>Quit the server with CONTROL-C.
</span><span class='line'>Unhandled exception in thread started by &lt;<span class="k">function</span> wrapper at 0x1024a5ed8&gt;
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/autoreload.py&quot;</span>, line 222, in wrapper
</span><span class='line'>    fn<span class="o">(</span>*args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/management/commands/runserver.py&quot;</span>, line 132, in inner_run
</span><span class='line'>    <span class="nv">handler</span> <span class="o">=</span> self.get_handler<span class="o">(</span>*args, **options<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/contrib/staticfiles/management/commands/runserver.py&quot;</span>, line 25, in get_handler
</span><span class='line'>    <span class="nv">handler</span> <span class="o">=</span> super<span class="o">(</span>Command, self<span class="o">)</span>.get_handler<span class="o">(</span>*args, **options<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/management/commands/runserver.py&quot;</span>, line 48, in get_handler
</span><span class='line'>    <span class="k">return</span> get_internal_wsgi_application<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/servers/basehttp.py&quot;</span>, line 66, in get_internal_wsgi_application
</span><span class='line'>    sys.exc_info<span class="o">()[</span>2<span class="o">])</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/core/servers/basehttp.py&quot;</span>, line 56, in get_internal_wsgi_application
</span><span class='line'>    <span class="k">return</span> import_string<span class="o">(</span>app_path<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/utils/module_loading.py&quot;</span>, line 26, in import_string
</span><span class='line'>    <span class="nv">module</span> <span class="o">=</span> import_module<span class="o">(</span>module_path<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.8_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/importlib/__init__.py&quot;</span>, line 37, in import_module
</span><span class='line'>    __import__<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/django_tutorial_blog_ng/wsgi.py&quot;</span>, line 14, in &lt;module&gt;
</span><span class='line'>    from dj_static import Cling
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/dj_static.py&quot;</span>, line 7, in &lt;module&gt;
</span><span class='line'>    from django.core.handlers.base import get_path_info
</span><span class='line'>django.core.exceptions.ImproperlyConfigured: WSGI application <span class="s1">&#39;django_tutorial_blog_ng.wsgi.application&#39;</span> could not be loaded<span class="p">;</span> Error importing module: <span class="s1">&#39;cannot import name get_path_info&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fortunately, the error above is easy to fix by upgrading <code>dj_static</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install dj_static --upgrade
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>That resolves the error in serving static files, but not the error with the admin. If you run the dev server, you&rsquo;ll be able to see that the admin actually works fine. The problem is caused by the test client not following redirects in the admin. We can easily run just the admin tests with the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine.tests.AdminTest
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.FF.F.FFFFFF
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 385, in test_create_post
</span><span class='line'>    self.assertTrue<span class="o">(</span><span class="s1">&#39;added successfully&#39;</span> in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_post_without_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 417, in test_create_post_without_tag
</span><span class='line'>    self.assertTrue<span class="o">(</span><span class="s1">&#39;added successfully&#39;</span> in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_delete_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 278, in test_delete_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_delete_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 346, in test_delete_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 255, in test_edit_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 447, in test_edit_post
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 323, in test_edit_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_login <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 183, in test_login
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">302</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_logout <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 214, in test_logout
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">302</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">12</span> tests in 3.283s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>9<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit our changes so far first:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/ requirements.txt blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Upgraded to Django 1.7&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s fix our tests. Here&rsquo;s the amended version of the <code>AdminTest</code> class:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AdminTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;users.json&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Get login page</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log the user in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log out&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log out</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check &#39;Log in&#39; in response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Log in&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/add/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the new category</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;python&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check added successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new category now in database</span>
</span><span class='line'>        <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_edit_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">CategoryFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Edit the category</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;perl&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>            <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check changed successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check category amended</span>
</span><span class='line'>        <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_category</span> <span class="o">=</span> <span class="n">all_categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;perl&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Perl programming language&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_delete_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">CategoryFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Delete the category</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check deleted successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check category deleted</span>
</span><span class='line'>        <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/add/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the new tag</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;python&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check added successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new tag now in database</span>
</span><span class='line'>        <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_edit_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Edit the tag</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;perl&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>            <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check changed successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check tag amended</span>
</span><span class='line'>        <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_tag</span> <span class="o">=</span> <span class="n">all_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;perl&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Perl programming language&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_delete_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Delete the tag</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check deleted successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check tag deleted</span>
</span><span class='line'>        <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">CategoryFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the new post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span>
</span><span class='line'>            <span class="s">&#39;tags&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check added successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post now in database</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_create_post_without_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">CategoryFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check response code</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the new post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check added successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post now in database</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">CategoryFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Edit the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-second-post&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span>
</span><span class='line'>            <span class="s">&#39;tags&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check changed successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post amended</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Log in</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Delete the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check deleted successfully</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post deleted</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are two main issues here. The first is that when we try to edit or delete an existing item, or refer to it when creating something else, we can no longer rely on the number representing the primary key being set to 1. So we need to specifically obtain this, rather than hard-coding it to 1. Therefore, whenever we pass through a number to represent an item (with the exception of the site, but including tags, categories and posts), we need to instead fetch its primary key and return it. So, above where we try to delete a post, we replace <code>1</code> with <code>str(post.pk)</code>. This will solve a lot of the problems. As there&rsquo;s a lot of them, I won&rsquo;t go through each one, but you can see the entire class above for reference, and if you&rsquo;ve followed along so far, you shouldn&rsquo;t have any problems.</p>

<p>The other issue we need to fix is the login and logout tests. We simply add <code>follow=True</code> to these to ensure that the test client follows the redirects.</p>

<p>Let&rsquo;s run our tests to make sure they pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.............................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">29</span> tests in 8.210s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>With that done, you can commit your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/tests.py
</span><span class='line'>git commit -m <span class="s1">&#39;Fixed broken tests&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t forget to deploy your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>fab deploy
</span></code></pre></td></tr></table></div></figure>


<p>Our blog has now been happily migrated over to Django 1.7!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/28/changing-date-format-from-dd-slash-mm-slash-yyyy-to-yyyy-mm-dd-in-vim/">Changing Date Format From DD/MM/YYYY to YYYY-MM-DD in Vim</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-28T19:53:34+01:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:53 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I had the occasion to reformat a load of dates in Vim from <code>DD/MM/YYYY</code> to <code>YYYY-MM-DD</code>. In Vim, this is quite simple:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">:</span>%<span class="k">s</span><span class="sr">/\(\d\{2}\)\/\(\d\{2}\)\/\(\d\{4}\)/</span>\<span class="m">3</span><span class="p">-</span>\<span class="m">2</span><span class="p">-</span>\<span class="m">1</span>/<span class="k">g</span>
</span></code></pre></td></tr></table></div></figure>


<p>This should be easy to adapt to reformatting other date formats.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/31/django-blog-tutorial-the-next-generation-part-8/">Django Blog Tutorial - the Next Generation - Part 8</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-31T22:00:00+01:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>10:00 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello again! In our final instalment, we&rsquo;ll wrap up our blog by:</p>

<ul>
<li>Implementing a sitemap</li>
<li>Optimising and tidying up the site</li>
<li>Creating a Fabric task for easier deployment</li>
</ul>


<p>I&rsquo;ll also cover development tools and practices that can make using Django easier. But first there&rsquo;s a few housekeeping tasks that need doing&hellip;</p>

<p>Don&rsquo;t forget to activate your virtualenv - you should know how to do this off by heart by now!</p>

<h1>Upgrading Django</h1>

<p>At the time of writing, Django 1.7 is due any day now, but it&rsquo;s not out yet so I won&rsquo;t cover it. The biggest change is the addition of a built-in migration system, but switching from South to this is well-documented. When Django 1.7 comes out, it shouldn&rsquo;t be difficult to upgrade to it - because we have good test coverage, we shouldn&rsquo;t have much trouble catching errors.</p>

<p>However, Django 1.6.6 was recently released, and we need to upgrade to it. Just enter the following command to upgrade:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install Django --upgrade
</span></code></pre></td></tr></table></div></figure>


<p>Then add it to your <code>requirements.txt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Then commit your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Upgraded Django version&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Implementing a sitemap</h1>

<p>Creating a sitemap for your blog is a good idea - it can be submitted to search engines, so that they can easily find your content. With Django, it&rsquo;s pretty straightforward too.</p>

<p>First, let&rsquo;s create a test for our sitemap. Add the following code at the end of <code>tests.py</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">SitemapTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_sitemap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create a post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create a flat page</span>
</span><span class='line'>        <span class="n">page</span> <span class="o">=</span> <span class="n">FlatPageFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get sitemap</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/sitemap.xml&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post is present in sitemap</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;my-first-post&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check page is present in sitemap</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;/about/&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run it, and you should see the test fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>...........................F
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_sitemap <span class="o">(</span>blogengine.tests.SitemapTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 847, in test_sitemap
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">28</span> tests in 6.873s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s implement our sitemap. The sitemap application comes with Django, and needs to be activated in your settings file, under <code>INSTALLED_APPS</code>:</p>

<figure class='code'><figcaption><span>django_blog_tutorial_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="s">&#39;django.contrib.sitemaps&#39;</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, let&rsquo;s think about what content we want to include in the sitemap. We want to index our flat pages and our blog posts, so our sitemap should reflect that. Create a new file at <code>blogengine/sitemap.py</code> and enter the following text:</p>

<figure class='code'><figcaption><span>blogengine/sitemap.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="kn">import</span> <span class="n">Sitemap</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.flatpages.models</span> <span class="kn">import</span> <span class="n">FlatPage</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostSitemap</span><span class="p">(</span><span class="n">Sitemap</span><span class="p">):</span>
</span><span class='line'>    <span class="n">changefreq</span> <span class="o">=</span> <span class="s">&quot;always&quot;</span>
</span><span class='line'>    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">lastmod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">pub_date</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">FlatpageSitemap</span><span class="p">(</span><span class="n">Sitemap</span><span class="p">):</span>
</span><span class='line'>    <span class="n">changefreq</span> <span class="o">=</span> <span class="s">&quot;always&quot;</span>
</span><span class='line'>    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>We define two sitemaps, one for all the posts, and the other for all the flat pages. Note that this works in a very similar way to the syndication framework.</p>

<p>Next, we amend our URLs. Add the following text after the existing imports in your URL file:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sitemaps.views</span> <span class="kn">import</span> <span class="n">sitemap</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.sitemap</span> <span class="kn">import</span> <span class="n">PostSitemap</span><span class="p">,</span> <span class="n">FlatpageSitemap</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Define sitemaps</span>
</span><span class='line'><span class="n">sitemaps</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&#39;posts&#39;</span><span class="p">:</span> <span class="n">PostSitemap</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;pages&#39;</span><span class="p">:</span> <span class="n">FlatpageSitemap</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then add the following after the existing routes:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># Sitemap</span>
</span><span class='line'><span class="n">url</span><span class="p">(</span><span class="s">r&#39;^sitemap\.xml$&#39;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">},</span>
</span><span class='line'>        <span class="n">name</span><span class="o">=</span><span class="s">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we define what sitemaps we&rsquo;re going to use, and we define a URL for them. It&rsquo;s pretty straightforward to use.</p>

<p>Let&rsquo;s run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>............................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">28</span> tests in 6.863s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>And done! Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ django_tutorial_blog_ng/settings.py
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented a sitemap&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Fixing test coverage</h1>

<p>Our blog is now feature-complete, but there are a few gaps in test coverage, so we&rsquo;ll fix them. If, like me, you&rsquo;re using Coveralls.io, <a href="https://coveralls.io/builds/1151177">you can easily see via their web interface where there are gaps in the coverage</a>.</p>

<p>Now, our gaps are all in our view file - if you <a href="https://coveralls.io/files/280228813">take a look at my build</a>, you can easily identify the gaps as they&rsquo;re marked in red.</p>

<p>The first gap is where a tag does not exist. Interestingly, if we look at the code in the view, we can see that some of it is redundant:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TagPostsFeed</span><span class="p">(</span><span class="n">PostsFeed</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">slug</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSS feed - blog posts tagged  </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSS feed - blog posts tagged </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Tag</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Under the <code>items</code> function, we check to see if the tag exists. However, under <code>get_object</code> we can see that if the object didn&rsquo;t exist, it would already have returned a 404 error. We can therefore safely amend <code>items</code> to not check, since that try statement will never fail:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TagPostsFeed</span><span class="p">(</span><span class="n">PostsFeed</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">slug</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSS feed - blog posts tagged  </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSS feed - blog posts tagged </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>The other two gaps are in our search view - we never get an empty result for the search in the following section:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">getSearchResults</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Search for a post by title or text</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="c"># Get the query data</span>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Query the database</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
</span><span class='line'>        <span class="n">results</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">text__icontains</span><span class="o">=</span><span class="n">query</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">title__icontains</span><span class="o">=</span><span class="n">query</span><span class="p">))</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="n">results</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add pagination</span>
</span><span class='line'>    <span class="n">pages</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Get specified page</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">returned_page</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span class='line'>    <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
</span><span class='line'>        <span class="n">returned_page</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">pages</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Display the search results</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;blogengine/search_post_list.html&#39;</span><span class="p">,</span>
</span><span class='line'>                              <span class="p">{</span><span class="s">&#39;page_obj&#39;</span><span class="p">:</span> <span class="n">returned_page</span><span class="p">,</span>
</span><span class='line'>                               <span class="s">&#39;object_list&#39;</span><span class="p">:</span> <span class="n">returned_page</span><span class="o">.</span><span class="n">object_list</span><span class="p">,</span>
</span><span class='line'>                               <span class="s">&#39;search&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>So replace it with this:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">getSearchResults</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Search for a post by title or text</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="c"># Get the query data</span>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Query the database</span>
</span><span class='line'>    <span class="n">results</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">text__icontains</span><span class="o">=</span><span class="n">query</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">title__icontains</span><span class="o">=</span><span class="n">query</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add pagination</span>
</span><span class='line'>    <span class="n">pages</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Get specified page</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">returned_page</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span class='line'>    <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
</span><span class='line'>        <span class="n">returned_page</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">pages</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Display the search results</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;blogengine/search_post_list.html&#39;</span><span class="p">,</span>
</span><span class='line'>                              <span class="p">{</span><span class="s">&#39;page_obj&#39;</span><span class="p">:</span> <span class="n">returned_page</span><span class="p">,</span>
</span><span class='line'>                               <span class="s">&#39;object_list&#39;</span><span class="p">:</span> <span class="n">returned_page</span><span class="o">.</span><span class="n">object_list</span><span class="p">,</span>
</span><span class='line'>                               <span class="s">&#39;search&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>We don&rsquo;t need to check whether <code>query</code> is defined because if <code>q</code> is left blank, the value of <code>query</code> will be an empty string, so we may as well pull out the redundant code.</p>

<p>Finally, the other gap is for when a user tries to get an empty search page (eg, page two of something with five or less results). So let&rsquo;s add another test to our <code>SearchViewTest</code> class:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_failing_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Search for something that is not present</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/search?q=wibble&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;No posts found&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Try to get nonexistent second page</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/search?q=wibble&amp;page=2&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;No posts found&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run our tests and check the coverage:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>coverage run --include<span class="o">=</span><span class="s2">&quot;blogengine/*&quot;</span> --omit<span class="o">=</span><span class="s2">&quot;blogengine/migrations/*&quot;</span> manage.py <span class="nb">test </span>blogengine
</span><span class='line'>coverage html
</span></code></pre></td></tr></table></div></figure>


<p>If you open <code>htmlcov/index.html</code> in your browser, you should see that the test coverage is back up to 100%. With that done, it&rsquo;s time to commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Fixed gaps in coverage&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remember, it&rsquo;s not always possible to achieve 100% test coverage, and you shouldn&rsquo;t worry too much about it if it&rsquo;s not possible - <a href="http://nedbatchelder.com/code/coverage/excluding.html">it&rsquo;s possible to ignore code</a> if necessary. However, it&rsquo;s a good idea to aim for 100%.</p>

<h1>Using Fabric for deployment</h1>

<p>Next we&rsquo;ll cover using Fabric, a handy tool for deploying your changes (any pretty much any other task you want to automate). First, you need to install it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install Fabric
</span></code></pre></td></tr></table></div></figure>


<p>If you have any problems installing it, you should be able to resolve them via Google - most of them are likely to be absent libraries that Fabric depends upon. Once it&rsquo;s installed, add it to your <code>requirements.tzt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Next, create a file called <code>fabfile.py</code> and enter the following text:</p>

<figure class='code'><figcaption><span>fabfile.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">local</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">deploy</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Deploy the latest version to Heroku</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="c"># Push changes to master</span>
</span><span class='line'>    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git push origin master&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Push changes to Heroku</span>
</span><span class='line'>    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git push heroku master&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Run migrations on Heroku</span>
</span><span class='line'>    <span class="n">local</span><span class="p">(</span><span class="s">&quot;heroku run python manage.py migrate&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, all this file does is push our changes to Github (or wherever else your repository is hosted) and to Heroku, and runs your migrations. It&rsquo;s not a terribly big task anyway, but it&rsquo;s handy to have it in place. Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add fabfile.py requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Added Fabric task for deployment&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, let&rsquo;s try it out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fab deploy
</span></code></pre></td></tr></table></div></figure>


<p>There, wasn&rsquo;t that more convenient? Fabric is much more powerful than this simple demonstration indicates, and can run tasks on remote servers via SSH easily. I recommend you take a look at the <a href="http://www.fabfile.org/">documentation</a> to see what else you can do with it. If you&rsquo;re hosting your site on a VPS, you will probably find Fabric indispensable, as you will need to restart the application every time you push up a new revision.</p>

<h1>Tidying up</h1>

<p>We want our blog application to play nicely with other Django apps. For instance, say you&rsquo;re working on a new site that includes a blogging engine. Wouldn&rsquo;t it make sense to just be able to drop in this blogging engine and have it work immediately? At the moment, some of our URL&rsquo;s are hard-coded, so we may have problems in doing so. Let&rsquo;s fix that.</p>

<p>First we&rsquo;ll amend our tests. Add this at the top of the tests file:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, replace every instance of this:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>with this:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;blogengine:index&#39;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, rewrite the calls to the search route. For instance, this:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/search?q=first&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>should become this:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;blogengine:search&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;?q=first&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll leave changing these as an exercise for the reader, but check the repository if you get stuck.</p>

<p>Next, we need to assign a namespace to our app&rsquo;s routes:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Examples:</span>
</span><span class='line'>    <span class="c"># url(r&#39;^$&#39;, &#39;django_tutorial_blog_ng.views.home&#39;, name=&#39;home&#39;),</span>
</span><span class='line'>    <span class="c"># url(r&#39;^blog/&#39;, include(&#39;blog.urls&#39;)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Blog URLs</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;blogengine.urls&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&quot;blogengine&quot;</span><span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Flat pages</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;django.contrib.flatpages.urls&#39;</span><span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We then assign names to our routes in the app&rsquo;s <code>urls.py</code>:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span><span class="p">,</span> <span class="n">TagListView</span><span class="p">,</span> <span class="n">PostsFeed</span><span class="p">,</span> <span class="n">CategoryPostsFeed</span><span class="p">,</span> <span class="n">TagPostsFeed</span><span class="p">,</span> <span class="n">getSearchResults</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sitemaps.views</span> <span class="kn">import</span> <span class="n">sitemap</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.sitemap</span> <span class="kn">import</span> <span class="n">PostSitemap</span><span class="p">,</span> <span class="n">FlatpageSitemap</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Define sitemaps</span>
</span><span class='line'><span class="n">sitemaps</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&#39;posts&#39;</span><span class="p">:</span> <span class="n">PostSitemap</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;pages&#39;</span><span class="p">:</span> <span class="n">FlatpageSitemap</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="n">name</span><span class="o">=</span><span class="s">&#39;index&#39;</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Individual posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="n">name</span><span class="o">=</span><span class="s">&#39;post&#39;</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Categories</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Category</span><span class="p">,</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="n">name</span><span class="o">=</span><span class="s">&#39;category&#39;</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Tags</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">TagListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Tag</span><span class="p">,</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="n">name</span><span class="o">=</span><span class="s">&#39;tag&#39;</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Post RSS feed</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/$&#39;</span><span class="p">,</span> <span class="n">PostsFeed</span><span class="p">()),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Category RSS feed</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryPostsFeed</span><span class="p">()),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Tag RSS feed</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">TagPostsFeed</span><span class="p">()),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Search posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^search&#39;</span><span class="p">,</span> <span class="n">getSearchResults</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;search&#39;</span><span class="p">),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Sitemap</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^sitemap\.xml$&#39;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">},</span>
</span><span class='line'>            <span class="n">name</span><span class="o">=</span><span class="s">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>You also need to amend two of your templates:</p>

<figure class='code'><figcaption><span>blogengine/templates/blogengine/includes/base.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if lt IE 7]&gt;      &lt;html class=&quot;no-js lt-ie9 lt-ie8 lt-ie7&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 7]&gt;         &lt;html class=&quot;no-js lt-ie9 lt-ie8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 8]&gt;         &lt;html class=&quot;no-js lt-ie9&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="nt">&lt;html</span> <span class="na">class=</span><span class="s">&quot;no-js&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!--&lt;![endif]--&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>{% block title %}My Django Blog{% endblock %}<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;alternate&quot;</span> <span class="na">type=</span><span class="s">&quot;application/rss+xml&quot;</span> <span class="na">title=</span><span class="s">&quot;Blog posts&quot;</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
</span><span class='line'>
</span><span class='line'>        {% load staticfiles %}
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/normalize.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap-theme.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/code.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        <span class="c">&lt;!--[if lt IE 7]&gt;</span>
</span><span class='line'><span class="c">            &lt;p class=&quot;browsehappy&quot;&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href=&quot;http://browsehappy.com/&quot;&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;</span>
</span><span class='line'><span class="c">        &lt;![endif]--&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Add your site or application content here --&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;fb-root&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">js</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;//connect.facebook.net/en_GB/all.js#xfbml=1&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook-jssdk&#39;</span><span class="p">));</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-static-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container-fluid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">class=</span><span class="s">&quot;navbar-toggle&quot;</span> <span class="na">data-toggle=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-target=</span><span class="s">&quot;#header-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/button&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;blogengine:index&#39; %}&quot;</span><span class="nt">&gt;</span>My Django Blog<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;collapse navbar-collapse&quot;</span> <span class="na">id=</span><span class="s">&quot;header-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav navbar-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        {% load flatpages %}
</span><span class='line'>                        {% get_flatpages as flatpages %}
</span><span class='line'>                        {% for flatpage in flatpages %}
</span><span class='line'>                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ flatpage.url }}&quot;</span><span class="nt">&gt;</span>{{ flatpage.title }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>                        {% endfor %}
</span><span class='line'>                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/&quot;</span><span class="nt">&gt;</span>RSS feed<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>
</span><span class='line'>                        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/search&quot;</span> <span class="na">method=</span><span class="s">&quot;GET&quot;</span> <span class="na">class=</span><span class="s">&quot;navbar-form navbar-left&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;q&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Search...&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-default&quot;</span><span class="nt">&gt;</span>Search<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% block header %}
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;h1&gt;</span>My Django Blog<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endblock %}
</span><span class='line'>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                {% block content %}{% endblock %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container footer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;p&gt;</span>Copyright <span class="ni">&amp;copy;</span> {% now &quot;Y&quot; %}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;script src=&quot;{% static &#39;</span><span class="nx">bower_components</span><span class="o">/</span><span class="nx">html5</span><span class="o">-</span><span class="nx">boilerplate</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">vendor</span><span class="o">/</span><span class="nx">jquery</span><span class="o">-</span><span class="mf">1.10</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">js</span><span class="s1">&#39; %}&quot;&gt;&lt;\/script&gt;&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/plugins.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/js/bootstrap.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site&#39;s ID. --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span>
</span><span class='line'>            <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">GoogleAnalyticsObject</span><span class="o">=</span><span class="nx">l</span><span class="p">;</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">=</span>
</span><span class='line'>            <span class="kd">function</span><span class="p">(){(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)});</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">l</span><span class="o">=+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">e</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span><span class="nx">r</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="nx">e</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;//www.google-analytics.com/analytics.js&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">r</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">)}(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;ga&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span><span class="s1">&#39;UA-XXXXX-X&#39;</span><span class="p">);</span><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span><span class="s1">&#39;pageview&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>blogengine/templates/blogengine/search_post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% if object_list %}
</span><span class='line'>            {% for post in object_list %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>            {{ post.text|custom_markdown }}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% if post.category %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-primary&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% if post.tags %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% for tag in post.tags.all %}
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-success&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            {% endfor %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% endfor %}
</span><span class='line'>        {% else %}
</span><span class='line'>            <span class="nt">&lt;p&gt;</span>No posts found<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;pager&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;previous&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;blogengine:search&#39; %}?page={{ page_obj.previous_page_number }}&amp;q={{ search }}&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;next&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;blogengine:search&#39; %}?page={{ page_obj.next_page_number }}&amp;q={{ search }}&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine/
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.............................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">29</span> tests in 10.456s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>And commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .
</span><span class='line'>git commit -m <span class="s1">&#39;Now use named routes&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Debugging Django</h1>

<p>There are a number of handy ways to debug Django applications. One of the simplest is to use the Python debugger. To use it, just enter the following lines at the point you want to break at:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">pdb</span>
</span><span class='line'><span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, whenever that line of code is run, you&rsquo;ll be dropped into an interactive shell that lets you play around to find out what&rsquo;s going wrong. However, it doesn&rsquo;t offer autocompletion, so we&rsquo;ll install <code>ipdb</code>, which is an improved version:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install ipdb
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Now you can use <code>ipdb</code> in much the same way as you would use <code>pdb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">ipdb</span>
</span><span class='line'><span class="n">ipdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, <code>ipdb</code> is very useful, but it isn&rsquo;t much help for profiling your application. For that you need the Django Debug Toolbar. Run the following commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install django-debug-toolbar
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Then add the following line to <code>INSTALLED_APPS</code> in your settings file:</p>

<figure class='code'><figcaption><span>django_blog_tutorial_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="s">&#39;debug_toolbar&#39;</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, try running the development server, and you&rsquo;ll see a toolbar on the right-hand side of the screen that allows you to view some useful data about your page. For instance, you&rsquo;ll notice a field called <code>SQL</code> - this contains details of the queries carried out when building the page. To actually see the queries carried out, you&rsquo;ll want to disable caching in your settings file by commenting out all the constants that start with <code>CACHE</code>.</p>

<p>We won&rsquo;t go into using the toolbar to optimise queries, but using this, you can easily see what queries are being executed on a specific page, how long they take, and the values they return. Sometimes, you may need to optimise a slow query - in this case, Django allows you to drop down to writing raw SQL if necessary.</p>

<p>Note that if you&rsquo;re running Django in production, you should set <code>DEBUG</code> to <code>False</code> as otherwise it gives rather too much information to potential attackers, and with Django Debug Toolbar installed, that&rsquo;s even more important.</p>

<p>Please also note that when you disable debug mode, Django no longer handles static files automatically, so you&rsquo;ll need to run <code>python manage.py collectstatic</code> and commit the <code>staticfiles</code> directory.</p>

<p>Once you&rsquo;ve disabled debug mode, collected the static files, and re-enables caching, you can commit your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .
</span><span class='line'>git commit -m <span class="s1">&#39;Installed debugging tools&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Optimising static files</h1>

<p>We want our blog to get the best SEO results it can, so making it fast is essential. One of the simplest things you can do is to concatenate and minify static assets such as CSS and JavaScript. There are numerous ways to do this, but I generally use Grunt. Let&rsquo;s set up a Grunt config to concatenate and minify our CSS and JavaScript.</p>

<p>You&rsquo;ll need to have Node.js installed on your development machine for this. Then, you need to install the Grunt command-line interface:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo npm install -g grunt-cli
</span></code></pre></td></tr></table></div></figure>


<p>With that done, we need to create a <code>package.json</code> file. You can create one using the command <code>npm init</code>. Here&rsquo;s mine:</p>

<figure class='code'><figcaption><span>package.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;django_tutorial_blog_ng&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Django Tutorial Blog NG =======================&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;repository&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;git&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/matthewbdaly/django_tutorial_blog_ng.git&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Matthew Daly &lt;matthew@matthewdaly.co.uk&gt; (http://matthewdaly.co.uk/)&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;bugs&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/matthewbdaly/django_tutorial_blog_ng/issues&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;homepage&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/matthewbdaly/django_tutorial_blog_ng&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Feel free to amend  it as you see fit.</p>

<p>Next we install Grunt and the required plugins:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm install grunt grunt-contrib-cssmin grunt-contrib-concat grunt-contrib-uglify --save-dev
</span></code></pre></td></tr></table></div></figure>


<p>We now need to create a Gruntfile for our tasks:</p>

<figure class='code'><figcaption><span>Gruntfile.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">concat</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">dist</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                    <span class="s1">&#39;blogengine/static/bower_components/bootstrap/dist/css/bootstrap.css&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s1">&#39;blogengine/static/bower_components/bootstrap/dist/css/bootstrap-theme.css&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s1">&#39;blogengine/static/css/code.css&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s1">&#39;blogengine/static/css/main.css&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="p">],</span>
</span><span class='line'>                <span class="nx">dest</span><span class="o">:</span> <span class="s1">&#39;blogengine/static/css/style.css&#39;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">uglify</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">dist</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                    <span class="s1">&#39;blogengine/static/bower_components/jquery/jquery.js&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s1">&#39;blogengine/static/bower_components/bootstrap/dist/js/bootstrap.js&#39;</span>
</span><span class='line'>                <span class="p">],</span>
</span><span class='line'>                <span class="nx">dest</span><span class="o">:</span> <span class="s1">&#39;blogengine/static/js/all.min.js&#39;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">cssmin</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">dist</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">src</span><span class="o">:</span> <span class="s1">&#39;blogengine/static/css/style.css&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">dest</span><span class="o">:</span> <span class="s1">&#39;blogengine/static/css/style.min.css&#39;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-concat&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-uglify&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-cssmin&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;concat&#39;</span><span class="p">,</span> <span class="s1">&#39;uglify&#39;</span><span class="p">,</span> <span class="s1">&#39;cssmin&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll also need to change the paths in your base HTML file to point to the minified versions:</p>

<figure class='code'><figcaption><span>blogengine/templates/blogengine/includes/base.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if lt IE 7]&gt;      &lt;html class=&quot;no-js lt-ie9 lt-ie8 lt-ie7&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 7]&gt;         &lt;html class=&quot;no-js lt-ie9 lt-ie8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 8]&gt;         &lt;html class=&quot;no-js lt-ie9&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="nt">&lt;html</span> <span class="na">class=</span><span class="s">&quot;no-js&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!--&lt;![endif]--&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>{% block title %}My Django Blog{% endblock %}<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;alternate&quot;</span> <span class="na">type=</span><span class="s">&quot;application/rss+xml&quot;</span> <span class="na">title=</span><span class="s">&quot;Blog posts&quot;</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
</span><span class='line'>
</span><span class='line'>        {% load staticfiles %}
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/style.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        <span class="c">&lt;!--[if lt IE 7]&gt;</span>
</span><span class='line'><span class="c">            &lt;p class=&quot;browsehappy&quot;&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href=&quot;http://browsehappy.com/&quot;&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;</span>
</span><span class='line'><span class="c">        &lt;![endif]--&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Add your site or application content here --&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;fb-root&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">js</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;//connect.facebook.net/en_GB/all.js#xfbml=1&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook-jssdk&#39;</span><span class="p">));</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-static-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container-fluid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">class=</span><span class="s">&quot;navbar-toggle&quot;</span> <span class="na">data-toggle=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-target=</span><span class="s">&quot;#header-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/button&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;blogengine:index&#39; %}&quot;</span><span class="nt">&gt;</span>My Django Blog<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;collapse navbar-collapse&quot;</span> <span class="na">id=</span><span class="s">&quot;header-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav navbar-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        {% load flatpages %}
</span><span class='line'>                        {% get_flatpages as flatpages %}
</span><span class='line'>                        {% for flatpage in flatpages %}
</span><span class='line'>                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ flatpage.url }}&quot;</span><span class="nt">&gt;</span>{{ flatpage.title }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>                        {% endfor %}
</span><span class='line'>                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/&quot;</span><span class="nt">&gt;</span>RSS feed<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>
</span><span class='line'>                        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/search&quot;</span> <span class="na">method=</span><span class="s">&quot;GET&quot;</span> <span class="na">class=</span><span class="s">&quot;navbar-form navbar-left&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;q&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Search...&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-default&quot;</span><span class="nt">&gt;</span>Search<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% block header %}
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;h1&gt;</span>My Django Blog<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endblock %}
</span><span class='line'>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                {% block content %}{% endblock %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container footer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;p&gt;</span>Copyright <span class="ni">&amp;copy;</span> {% now &quot;Y&quot; %}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;js/all.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site&#39;s ID. --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span>
</span><span class='line'>            <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">GoogleAnalyticsObject</span><span class="o">=</span><span class="nx">l</span><span class="p">;</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">=</span>
</span><span class='line'>            <span class="kd">function</span><span class="p">(){(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)});</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">l</span><span class="o">=+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">e</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span><span class="nx">r</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="nx">e</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;//www.google-analytics.com/analytics.js&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">r</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">)}(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;ga&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span><span class="s1">&#39;UA-XXXXX-X&#39;</span><span class="p">);</span><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span><span class="s1">&#39;pageview&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, run the Grunt task:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>grunt
</span></code></pre></td></tr></table></div></figure>


<p>And collect the static files:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py collectstatic
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll also want to add your <code>node_modules</code> folder to your <code>gitignore</code>:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>venv/
</span><span class='line'>*.pyc
</span><span class='line'>db.sqlite3
</span><span class='line'>reports/
</span><span class='line'>htmlcov/
</span><span class='line'>.coverage
</span><span class='line'>node_modules/
</span></code></pre></td></tr></table></div></figure>


<p>Then commit your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .
</span><span class='line'>git commit -m <span class="s1">&#39;Optimised static assets&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, our <code>package.json</code> will cause a problem - it will mean that this app is mistakenly identified as a Node.js app. To prevent this, create the following file:</p>

<figure class='code'><figcaption><span>.slugignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>package.json
</span></code></pre></td></tr></table></div></figure>


<p>Then commit your changes and push them up:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .slugignore
</span><span class='line'>git commit -m <span class="s1">&#39;Added slugignore&#39;</span>
</span><span class='line'>fab deploy
</span></code></pre></td></tr></table></div></figure>


<p>If you check, your site should now be loading the minified versions of the static files.</p>

<p>That&rsquo;s our site done! As usual I&rsquo;ve tagged the final commit with <code>lesson-8</code>.</p>

<p>Sadly, that&rsquo;s our final instalment over with! I hope you&rsquo;ve enjoyed these tutorials, and I look forward to seeing what you create with them.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/25/django-blog-tutorial-the-next-generation-part-7/">Django Blog Tutorial - the Next Generation - Part 7</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-25T17:15:01+01:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:15 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello once again! In this instalment we&rsquo;ll cover:</p>

<ul>
<li>Caching your content with Memcached to improve your site&rsquo;s performance</li>
<li>Refactoring and simplifying our tests</li>
<li>Implementing additional feeds</li>
<li>Creating a simple search engine</li>
</ul>


<p>Don&rsquo;t forget to activate your virtualenv:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source </span>venv/bin/activate
</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s get started!</p>

<h1>Memcached</h1>

<p>If you frequent (or used to frequent) social media sites like Reddit, Slashdot or Digg, you may be familiar with something called variously the Digg or Slashdot effect, whereby if a page gets submitted to a social media site, and subsequently becomes popular, it can be hit by a huge number of HTTP requests in a very short period of time, slowing it down or even taking the server down completely.</p>

<p>Now, as a general rule of thumb, for most dynamic websites such as blogs, the bottleneck is not the web server or the programming language, but the database. If you have a lot of people hitting the same page over and over again in quick succession, then you&rsquo;re essentially running the same query over and over again and getting the same result each time, which is expensive in terms of processing power. What you need to be able to do is cache the results of the query in memory for a given period of time so that the number of queries is reduced.</p>

<p>That&rsquo;s where Memcached comes in. It&rsquo;s a simple key-value store that allows you to store values in memory for a given period of time so that they can be retrieved without having to query the database. Memcached is a very common choice for caching, and is by far the fastest and most efficient type of cache available for Django. It&rsquo;s also available on Heroku&rsquo;s free tier.</p>

<p>Django has a very powerful caching framework that supports numerous types of cache in addition to Memcached, such as:</p>

<ul>
<li>Database caching</li>
<li>Filesystem caching</li>
<li>Local memory caching</li>
</ul>


<p>There are also third-party backends for using other caching systems such as Redis.</p>

<p>Now, the cache can be used in a number of different ways. You can cache only certain parts of your site if you wish. However, because our site is heavily content-driven, we should be pretty safe to use the per-site cache, which is the simplest way to set up caching.</p>

<p>In order to set up Memcached, there&rsquo;s a couple of Python libraries we&rsquo;ll need. If you want to install them locally, however, you&rsquo;ll need to install both memcached and libmemcached (on Ubuntu, the packages you need are called <code>memcached</code> and <code>libmemcached-dev</code>) on your development machine. If you don&rsquo;t want to do this, then just copy and paste these lines into <code>requirements.txt</code> instead:</p>

<figure class='code'><figcaption><span>requirements.txt</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>django-pylibmc-sasl<span class="o">==</span>0.2.4
</span><span class='line'><span class="nv">pylibmc</span><span class="o">==</span>1.3.0
</span></code></pre></td></tr></table></div></figure>


<p>If you are happy to install these dependencies locally, then run this command once memcached and libmemcached are installed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install pylibmc django-pylibmc-sasl
</span></code></pre></td></tr></table></div></figure>


<p>With that done let&rsquo;s configure Memcached. Open up the settings file and add the following at the bottom:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">get_cache</span><span class="p">():</span>
</span><span class='line'>  <span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'>  <span class="k">try</span><span class="p">:</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHE_SERVERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHIER_SERVERS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHE_USERNAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHIER_USERNAME&#39;</span><span class="p">]</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHE_PASSWORD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHIER_PASSWORD&#39;</span><span class="p">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;django_pylibmc.memcached.PyLibMCCache&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;TIMEOUT&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;BINARY&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s">&#39;tcp_nodelay&#39;</span><span class="p">:</span> <span class="bp">True</span> <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">except</span><span class="p">:</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;django.core.cache.backends.locmem.LocMemCache&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">CACHES</span> <span class="o">=</span> <span class="n">get_cache</span><span class="p">()</span>
</span><span class='line'><span class="n">CACHE_MIDDLEWARE_ALIAS</span> <span class="o">=</span> <span class="s">&#39;default&#39;</span>
</span><span class='line'><span class="n">CACHE_MIDDLEWARE_SECONDS</span> <span class="o">=</span> <span class="mi">300</span>
</span><span class='line'><span class="n">CACHE_MIDDLEWARE_KEY_PREFIX</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then add the following to <code>MIDDLEWARE_CLASSES</code>:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="s">&#39;django.middleware.cache.UpdateCacheMiddleware&#39;</span><span class="p">,</span>
</span><span class='line'><span class="s">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
</span><span class='line'><span class="s">&#39;django.middleware.cache.FetchFromCacheMiddleware&#39;</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it! The first section configures the application to use Memcached to cache the content when running on Heroku, and sets some configuration parameters, while the second  section tells Django to use the per-site cache in order to cache all the site content.</p>

<p>Now, Heroku doesn&rsquo;t include Memcached by default - instead it&rsquo;s available as an add-on called Memcachier. To use add-ons you need to set up a credit card for billing. We will set it up to use the free developer plan, but if you outgrow this you can easily switch to a paid plan. To add Memcachier, run this command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku addons:add memcachier:dev
</span></code></pre></td></tr></table></div></figure>


<p>Please note that Memcachier can take a few minutes to get set up, so you may want to leave it a little while between adding it and pushing up your changes. Now we&rsquo;ll commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add requirements.txt django_tutorial_blog_ng/settings.py
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented caching with Memcached&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we&rsquo;ll push them up to our remote repository and to Heroku:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git push origin master
</span><span class='line'>git push heroku master
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s all you need to do to set up Memcached. In addition to storing your query results in Memcached, enabling the caching framework in Django will also set various HTTP headers to enable web proxies and browsers to cache content for an appropriate length of time. If you open up your browser&rsquo;s developer tools and compare the response headers for your homepage on the latest version of the code with the previous version, you&rsquo;ll notice that a number of additional headers appear, including <code>Cache-Control</code>, <code>Expires</code> and <code>Last-Modified</code>. These tell web browsers and web proxies how often to request the latest version of the HTML document, in order to help you reduce the bandwidth used.</p>

<p>As you can see, for a site like this where you are the only person adding content, it&rsquo;s really easy to implement caching with Django, and for a blog there&rsquo;s very little reason not to do it. If you&rsquo;re not using Heroku and are instead hosting your site on a VPS, then the configuration will be somewhat different - see <a href="https://docs.djangoproject.com/en/1.6/topics/cache/#memcached">here</a> for details. You can also find information on using other cache backends on the same page.</p>

<p>That isn&rsquo;t all you can do to speed up your site. Heroku doesn&rsquo;t seem to be very good for serving static files, and if your site is attracting a lot of traffic you might want to host your static files elsewhere, such as on Amazon&rsquo;s S3 service. Doing so is outside the scope of this tutorial, but for that use case, you should check out <a href="http://django-storages.readthedocs.org/en/latest/index.html">django-storages</a>.</p>

<h1>Clearing the cache automatically</h1>

<p>There is one issue with this implementation. As it is right now, if you view the home page, add a post, then reload the page, you may not see the new post immediately because the cache will continue serving the old version until it has expired. That behaviour is less than ideal - we would like the cache to be cleared automatically when a new post gets added so that users will see the new version immediately. That response will still be cached afterwards, so it only means one extra query.</p>

<p>This is the ideal place to introduce <a href="https://docs.djangoproject.com/en/dev/topics/signals/">signals</a>. Signals are a way to carry out a given action when an event takes place. In our case, we plan to clear the cache when a post is saved (either created or updated).</p>

<p>Note that as we&rsquo;ll be testing the behaviour of the cache at this point, you&rsquo;ll need to install Memcached on your local machine, and we&rsquo;ll need to change the settings to fall back to our local Memcached instance:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">get_cache</span><span class="p">():</span>
</span><span class='line'>  <span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'>  <span class="k">try</span><span class="p">:</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHE_SERVERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHIER_SERVERS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHE_USERNAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHIER_USERNAME&#39;</span><span class="p">]</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHE_PASSWORD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;MEMCACHIER_PASSWORD&#39;</span><span class="p">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;django_pylibmc.memcached.PyLibMCCache&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;TIMEOUT&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;BINARY&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s">&#39;tcp_nodelay&#39;</span><span class="p">:</span> <span class="bp">True</span> <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">except</span><span class="p">:</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;django.core.cache.backends.memcached.PyLibMCCache&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s">&#39;127.0.0.1:11211&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">CACHES</span> <span class="o">=</span> <span class="n">get_cache</span><span class="p">()</span>
</span><span class='line'><span class="n">CACHE_MIDDLEWARE_ALIAS</span> <span class="o">=</span> <span class="s">&#39;default&#39;</span>
</span><span class='line'><span class="n">CACHE_MIDDLEWARE_SECONDS</span> <span class="o">=</span> <span class="mi">300</span>
</span><span class='line'><span class="n">CACHE_MIDDLEWARE_KEY_PREFIX</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you don&rsquo;t want to install Memcached locally, you can skip this step, but be aware that the test we write for clearing the cache will always pass if you do skip it.</p>

<p>Then we&rsquo;ll run our tests to make sure nothing has been broken:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.......................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">23</span> tests in 6.164s
</span><span class='line'>
</span><span class='line'>OK
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/settings.py
</span><span class='line'>git commit -m <span class="s1">&#39;Now use Memcached in development&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;ll add a test for clearing the cache to <code>PostViewTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_clear_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;perl&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the first post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Fetch the index</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the second post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My second post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my second blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-second-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Fetch the index again</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check second post present</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;my second blog post&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This should be fairly self-explanatory. We create one post, and request the index page. We then add a second post, request the index page again, and check for the second post. The test should fail because the cached version is returned, rather than the version in the database.</p>

<p>Now we have a test in place, we can implement a fix. First, add this to the top of your <code>models.py</code>:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="kn">import</span> <span class="n">post_save</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then add the following at the bottom of the file:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#Define signals</span>
</span><span class='line'><span class="k">def</span> <span class="nf">new_post</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>    <span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c">#Set up signals</span>
</span><span class='line'><span class="n">post_save</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">new_post</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">Post</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is fairly straightforward. What we&rsquo;re doing is first defining a function called <code>new_post</code> that is called when a new post is created. We then connect it to the <code>post_save</code> signal. When a post is saved, it calls <code>new_post</code>, which clears the cache, making sure users are seeing the latest and greatest version of your site immediately.</p>

<p>Let&rsquo;s test it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">24</span> tests in 8.473s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>There are a number of signals available, and when you create one, you have access to the created object via the <code>instance</code> parameter. Using signals you can implement all kinds of functionality. For instance, you could implement the functionality to send an email when a new post is published.</p>

<p>If you&rsquo;re using Travis CI, you&rsquo;ll also need to update the config file:</p>

<figure class='code'><figcaption><span>.travis.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">language</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">python</span>
</span><span class='line'><span class="l-Scalar-Plain">python</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="s">&quot;2.7&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">memcached</span>
</span><span class='line'><span class="l-Scalar-Plain">before_install</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sudo apt-get install -y libmemcached-dev</span>
</span><span class='line'><span class="c1"># command to install dependencies</span>
</span><span class='line'><span class="l-Scalar-Plain">install</span><span class="p-Indicator">:</span> <span class="s">&quot;pip</span><span class="nv"> </span><span class="s">install</span><span class="nv"> </span><span class="s">-r</span><span class="nv"> </span><span class="s">requirements.txt&quot;</span>
</span><span class='line'><span class="c1"># command to run tests</span>
</span><span class='line'><span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">coverage run --include=&quot;blogengine/*&quot; --omit=&quot;blogengine/migrations/*&quot; manage.py test blogengine</span>
</span><span class='line'><span class="l-Scalar-Plain">after_success</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">coveralls</span>
</span></code></pre></td></tr></table></div></figure>


<p>Time to commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ .travis.yml
</span><span class='line'>git commit -m <span class="s1">&#39;Now clear cache when post added&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Formatting for RSS feeds</h1>

<p>Now, we want to offer more than one option for RSS feeds. For instance, if your blog is aggregated on a site such as <a href="http://planet.python.org/">Planet Python</a>, but you also blog about JavaScript, you may want to be able to provide a feed for posts in the <code>python</code> category only.</p>

<p>If you have written any posts that use any of Markdown&rsquo;s custom formatting, you may notice that if you load your RSS feed in a reader, it isn&rsquo;t formatted as Markdown. Let&rsquo;s fix that. First we&rsquo;ll amend our test:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">FeedTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_all_post_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create a post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my *first* blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Add the tag</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the feed</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/feeds/posts/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Parse the feed</span>
</span><span class='line'>        <span class="n">feed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check length</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post retrieved is the correct one</span>
</span><span class='line'>        <span class="n">feed_post</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">feed_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;This is my &lt;em&gt;first&lt;/em&gt; blog post&#39;</span> <span class="ow">in</span> <span class="n">feed_post</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t forget to run the tests to make sure they fail. Now, let&rsquo;s fix it:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.syndication.views</span> <span class="kn">import</span> <span class="n">Feed</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_unicode</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">markdown2</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your views here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TagListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Tag</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostsFeed</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;RSS feed - posts&quot;</span>
</span><span class='line'>    <span class="n">link</span> <span class="o">=</span> <span class="s">&quot;feeds/posts/&quot;</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;RSS feed - blog posts&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-pub_date&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">item_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">item_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="n">extras</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;fenced-code-blocks&quot;</span><span class="p">]</span>
</span><span class='line'>        <span class="n">content</span> <span class="o">=</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">markdown2</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">),</span>
</span><span class='line'>                                               <span class="n">extras</span> <span class="o">=</span> <span class="n">extras</span><span class="p">))</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">content</span>
</span></code></pre></td></tr></table></div></figure>


<p>All we&rsquo;re doing here is amending the <code>item_description</code> method of <code>PostsFeed</code> to render it as Markdown. Now let&rsquo;s run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">24</span> tests in 9.370s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>With that done, we&rsquo;ll commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Fixed rendering for post feed&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Refactoring our tests</h1>

<p>Now, before we get into implementing the feed, our tests are a bit verbose. We create a lot of items over and over again - let&rsquo;s sort that out. Factory Boy is a handy Python module that allows you to create easy-to-use factories for creating objects over and over again in tests. Let&rsquo;s install it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install factory_boy
</span><span class='line'>pip freeze &gt; requirements.txt
</span><span class='line'>git add requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Installed Factory Boy&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s set up a factory for creating posts. Add this at the top of the test file:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">factory.django</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, before your actual tests, insert the following:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># Factories</span>
</span><span class='line'><span class="k">class</span> <span class="nc">SiteFactory</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">django</span><span class="o">.</span><span class="n">DjangoModelFactory</span><span class="p">):</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">model</span> <span class="o">=</span> <span class="n">Site</span>
</span><span class='line'>        <span class="n">django_get_or_create</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>            <span class="s">&#39;name&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;domain&#39;</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, wherever you call <code>Site()</code>, add its attributes, and save it, replace those lines with the following:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">SiteFactory</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Much simpler and more concise, I&rsquo;m sure you&rsquo;ll agree! Now, let&rsquo;s run the tests to make sure they aren&rsquo;t broken:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">24</span> tests in 7.482s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/tests.py
</span><span class='line'>git commit -m <span class="s1">&#39;Now use Factory Boy for site objects&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s do the same thing with <code>Category</code> objects:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">CategoryFactory</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">django</span><span class="o">.</span><span class="n">DjangoModelFactory</span><span class="p">):</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
</span><span class='line'>        <span class="n">django_get_or_create</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>            <span class="s">&#39;name&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;description&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, just find every time we call <code>Category()</code> and replace it with the following:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">CategoryFactory</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now if we run our tests, we&rsquo;ll notice a serious error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>EE..EE.EE.EE...E.EEE..E.
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_category <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 42, in test_create_category
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 80, in test_create_post
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 339, in test_create_post
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post_without_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 378, in test_create_post_without_tag
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 245, in test_delete_category
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 467, in test_delete_post
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 221, in test_edit_category
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 410, in test_edit_post
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_all_post_feed <span class="o">(</span>blogengine.tests.FeedTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 810, in test_all_post_feed
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_category_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 640, in test_category_page
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_clear_cache <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 753, in test_clear_cache
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_index <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 518, in test_index
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_post_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 576, in test_post_page
</span><span class='line'>    <span class="nv">category</span> <span class="o">=</span> CategoryFactory<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 82, in __call__
</span><span class='line'>    <span class="k">return</span> cls.create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 585, in create
</span><span class='line'>    <span class="k">return</span> cls._generate<span class="o">(</span>True, attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 510, in _generate
</span><span class='line'>    <span class="nv">obj</span> <span class="o">=</span> cls._prepare<span class="o">(</span>create, **attrs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py&quot;</span>, line 485, in _prepare
</span><span class='line'>    <span class="k">return</span> cls._create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 151, in _create
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> cls._get_or_create<span class="o">(</span>model_class, *args, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py&quot;</span>, line 142, in _get_or_create
</span><span class='line'>    obj, <span class="nv">_created</span> <span class="o">=</span> manager.get_or_create<span class="o">(</span>*args, **key_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 154, in get_or_create
</span><span class='line'>    <span class="k">return</span> self.get_queryset<span class="o">()</span>.get_or_create<span class="o">(</span>**kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 383, in get_or_create
</span><span class='line'>    obj.save<span class="o">(</span><span class="nv">force_insert</span><span class="o">=</span>True, <span class="nv">using</span><span class="o">=</span>self.db<span class="o">)</span>
</span><span class='line'>TypeError: save<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;force_insert&#39;</span>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">24</span> tests in 5.162s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>13<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Thankfully, this is easy to fix. We just need to amend the custom <code>save()</code> method of the <code>Category</code> model:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span class='line'>    <span class="nb">super</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>That should resolve the issue:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">24</span> tests in 7.749s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Category now uses Factory Boy&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s do the same thing for tags:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TagFactory</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">django</span><span class="o">.</span><span class="n">DjangoModelFactory</span><span class="p">):</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">model</span> <span class="o">=</span> <span class="n">Tag</span>
</span><span class='line'>        <span class="n">django_get_or_create</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>            <span class="s">&#39;name&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;description&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And replace the sections where we create new <code>Tag</code> objects:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that some tags have different values. We can easily pass different values to our <code>TagFactory()</code> to override the default values:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;perl&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&#39;The Perl programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>Tag</code> model has the same issue as the <code>Category</code> one did, so let&rsquo;s fix that:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span class='line'>    <span class="nb">super</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine/
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">24</span> tests in 7.153s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Time to commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Now use Factory Boy for tags&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we&rsquo;ll create a factory for adding users. Note that the factory name doesn&rsquo;t have to match the object name, so you can create factories for different types of users. Here we create a factory for authors - you could, for instance, create a separate factory for subscribers if you wanted:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">AuthorFactory</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">django</span><span class="o">.</span><span class="n">DjangoModelFactory</span><span class="p">):</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
</span><span class='line'>        <span class="n">django_get_or_create</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">,</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">username</span> <span class="o">=</span> <span class="s">&#39;testuser&#39;</span>
</span><span class='line'>    <span class="n">email</span> <span class="o">=</span> <span class="s">&#39;user@example.com&#39;</span>
</span><span class='line'>    <span class="n">password</span> <span class="o">=</span> <span class="s">&#39;password&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And as before, replace those sections where we create users with the following:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">AuthorFactory</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">24</span> tests in 5.808s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>We commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Now use Factory Boy for creating authors&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;ll create a flat page factory:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">FlatPageFactory</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">django</span><span class="o">.</span><span class="n">DjangoModelFactory</span><span class="p">):</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">model</span> <span class="o">=</span> <span class="n">FlatPage</span>
</span><span class='line'>        <span class="n">django_get_or_create</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>            <span class="s">&#39;url&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;content&#39;</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;/about/&#39;</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;About me&#39;</span>
</span><span class='line'>    <span class="n">content</span> <span class="o">=</span> <span class="s">&#39;All about me&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And use it for our flat page test:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="n">page</span> <span class="o">=</span> <span class="n">FlatPageFactory</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Check the tests pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">24</span> tests in 5.796s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>And commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Now use Factory Boy for flat page test&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;ll create a final factory for posts:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostFactory</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">django</span><span class="o">.</span><span class="n">DjangoModelFactory</span><span class="p">):</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
</span><span class='line'>        <span class="n">django_get_or_create</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>            <span class="s">&#39;title&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;text&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;slug&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&#39;pub_date&#39;</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">SubFactory</span><span class="p">(</span><span class="n">AuthorFactory</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">SubFactory</span><span class="p">(</span><span class="n">SiteFactory</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">SubFactory</span><span class="p">(</span><span class="n">CategoryFactory</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This factory is a little bit different. Because our <code>Post</code> model depends on several others, we need to be able to create those additional objects on demand. By designating them as subfactories, we can easily create the associated objects for our <code>Post</code> object.</p>

<p>That means that not only can we get rid of our <code>Post()</code> calls, but we can also get rid of the factory calls to create the associated objects for <code>Post</code> models. Again, I&rsquo;ll leave actually doing this as an exercise for the reader, but you can always refer to the GitHub repository if you&rsquo;re not too sure.</p>

<p>Make sure your tests still pass, then commit the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Now use Factory Boy for testing posts&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using Factory Boy made a big difference to the size of the test file - I was able to cut it down by over 200 lines of code. As your application gets bigger, it gets harder to maintain, so do what you can to keep the size down.</p>

<h1>Additional RSS feeds</h1>

<p>Now, let&rsquo;s implement our additional RSS feeds. First, we&rsquo;ll write a test for the category feed. Add this to the <code>FeedTest</code> class:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_category_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create a post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;This is my *first* blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create another post in a different category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">CategoryFactory</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;perl&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&#39;The Perl programming language&#39;</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="s">&#39;perl&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">post2</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;This is my *second* blog post&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;My second post&#39;</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="s">&#39;my-second-post&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Fetch the feed</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/feeds/posts/category/python/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Parse the feed</span>
</span><span class='line'>    <span class="n">feed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check length</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post retrieved is the correct one</span>
</span><span class='line'>    <span class="n">feed_post</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">feed_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;This is my &lt;em&gt;first&lt;/em&gt; blog post&#39;</span> <span class="ow">in</span> <span class="n">feed_post</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check other post is not in this feed</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;This is my &lt;em&gt;second&lt;/em&gt; blog post&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we create two posts in different categories (note that we create a new category and override the post category for it). We then fetch `/feeds/posts/category/python/&lsquo; and assert that it contains only one post, with the content of the first post and not the content of the second.</p>

<p>Run the tests and they should fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>................F........
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_category_feed <span class="o">(</span>blogengine.tests.FeedTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 716, in test_category_feed
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">25</span> tests in 5.804s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Because we haven&rsquo;t yet implemented that route, we get a 404 error. So let&rsquo;s create a route for this:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span><span class="p">,</span> <span class="n">TagListView</span><span class="p">,</span> <span class="n">PostsFeed</span><span class="p">,</span> <span class="n">CategoryPostsFeed</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Individual posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Categories</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Category</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Tags</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">TagListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Tag</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Post RSS feed</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/$&#39;</span><span class="p">,</span> <span class="n">PostsFeed</span><span class="p">()),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Category RSS feed</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryPostsFeed</span><span class="p">()),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that the category RSS feed route is similar to the post RSS feed route, but accepts a <code>slug</code> parameter. We will use this to pass through the slug for the category in question. Also note we import the <code>CategoryPostsFeed</code> view. Now, we need to create that view. Fortunately, because it&rsquo;s written as a Python class, we can extend the existing <code>PostsFeed</code> class. Open up your views file and amend it to look like this:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.syndication.views</span> <span class="kn">import</span> <span class="n">Feed</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_unicode</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">markdown2</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your views here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TagListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Tag</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostsFeed</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;RSS feed - posts&quot;</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;RSS feed - blog posts&quot;</span>
</span><span class='line'>    <span class="n">link</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-pub_date&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">item_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">item_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="n">extras</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;fenced-code-blocks&quot;</span><span class="p">]</span>
</span><span class='line'>        <span class="n">content</span> <span class="o">=</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">markdown2</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">),</span>
</span><span class='line'>                                               <span class="n">extras</span> <span class="o">=</span> <span class="n">extras</span><span class="p">))</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">content</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">CategoryPostsFeed</span><span class="p">(</span><span class="n">PostsFeed</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">slug</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSS feed - blog posts in category </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSS feed - blog posts in category </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-pub_date&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that many of our fields don&rsquo;t have to be explicitly defined as they are inherited from <code>PostsFeed</code>. We can&rsquo;t hard-code the title, link or description because they depend on the category, so we instead define methods to return the appropriate text.</p>

<p>Also note <code>get_object()</code> - we define this so that we can ensure the category exists. If it doesn&rsquo;t exist, then it returns a 404 error rather than showing an empty feed.</p>

<p>We also override <code>items()</code> to filter it to just those posts that are in the given category.</p>

<p>If you run the tests again, they should now pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">25</span> tests in 5.867s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented category RSS feed&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we can get our category RSS feed, but how do we navigate to it? Let&rsquo;s add a link to each category page that directs a user to its RSS feed. To do so, we&rsquo;ll need to create a new template for category pages. First, let&rsquo;s add some code to our tests to ensure that the right template is used at all times. Add the following to the end of the <code>test_index</code> method of <code>PostViewTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="c"># Check the correct template was used</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;blogengine/post_list.html&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, add this to the end of <code>test_post_page</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>        <span class="c"># Check the correct template was used</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;blogengine/post_detail.html&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, add this to the end of <code>test_category_page</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="c"># Check the correct template was used</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;blogengine/category_post_list.html&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>These assertions confirm which template was used to generate which request.</p>

<p>Next, we head into our views file:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="n">template_name</span> <span class="o">=</span> <span class="s">&#39;blogengine/category_post_list.html&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CategoryListView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">context</span><span class="p">[</span><span class="s">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="n">context</span><span class="p">[</span><span class="s">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">context</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that we first of all change the template used by this view. Then, we override <code>get_context_data</code> to add in additional data. What we&rsquo;re doing is getting the slug that was passed through, looking up any category for which it is the slug, and returning it as additional context data. Using this method, you can easily add additional data that you may wish to render in your Django templates.</p>

<p>Finally, we create our new template:</p>

<figure class='code'><figcaption><span>templates/blogengine/category_post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% if object_list %}
</span><span class='line'>            {% for post in object_list %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>            {{ post.text|custom_markdown }}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% if post.category %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-primary&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% if post.tags %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% for tag in post.tags.all %}
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-success&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            {% endfor %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% endfor %}
</span><span class='line'>        {% else %}
</span><span class='line'>            <span class="nt">&lt;p&gt;</span>No posts found<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;pager&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;previous&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;next&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/category/{{ category.slug }}/&quot;</span><span class="nt">&gt;</span>RSS feed for category {{ category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Note that the category has been passed through to the template and is now accessible. If you run the tests, they should now pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">25</span> tests in 7.232s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>With that done. we can commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/ blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Added link to RSS feed from category page&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next up, let&rsquo;s implement another RSS feed for tags. First, we&rsquo;ll implement our test:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>  <span class="k">def</span> <span class="nf">test_tag_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>      <span class="c">#Create a post</span>
</span><span class='line'>      <span class="n">post</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;This is my *first* blog post&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">tag</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">()</span>
</span><span class='line'>      <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>      <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="c">#Create another post with a different tag</span>
</span><span class='line'>      <span class="n">tag2</span> <span class="o">=</span> <span class="n">TagFactory</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;perl&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&#39;The Perl programming language&#39;</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="s">&#39;perl&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">post2</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;This is my *second* blog post&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;My second post&#39;</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="s">&#39;my-second-post&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">post2</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag2</span><span class="p">)</span>
</span><span class='line'>      <span class="n">post2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>      <span class="c">#Fetch the feed</span>
</span><span class='line'>      <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/feeds/posts/tag/python/&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="c">#Parse the feed</span>
</span><span class='line'>      <span class="n">feed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="c">#Check length</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="c"># Check post retrieved is the correct one</span>
</span><span class='line'>      <span class="n">feed_post</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">feed_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;This is my &lt;em&gt;first&lt;/em&gt; blog post&#39;</span> <span class="ow">in</span> <span class="n">feed_post</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="c">#Check other post is not in this feed</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;This is my &lt;em&gt;second&lt;/em&gt; blog post&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is virtually identical to the test for the categroy feed, but we adjust it to work with the <code>Tag</code> attribute and change the URL. Let&rsquo;s check that our test fails:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.................F........
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_tag_feed <span class="o">(</span>blogengine.tests.FeedTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 757, in test_tag_feed
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">26</span> tests in 5.760s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>As before, we create a route for this:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span><span class="p">,</span> <span class="n">TagListView</span><span class="p">,</span> <span class="n">PostsFeed</span><span class="p">,</span> <span class="n">CategoryPostsFeed</span><span class="p">,</span> <span class="n">TagPostsFeed</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Individual posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Categories</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Category</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Tags</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">TagListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Tag</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Post RSS feed</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/$&#39;</span><span class="p">,</span> <span class="n">PostsFeed</span><span class="p">()),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Category RSS feed</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryPostsFeed</span><span class="p">()),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Tag RSS feed</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">TagPostsFeed</span><span class="p">()),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, we create our view:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TagPostsFeed</span><span class="p">(</span><span class="n">PostsFeed</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">slug</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSS feed - blog posts tagged  </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;RSS feed - blog posts tagged </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Tag</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, this inherits from <code>PostsFeed</code>, but the syntax for getting posts matching a tag is slightly different because they use a many-to-many relationship.</p>

<p>We also need a template for the tag pages. Add this to the end of the <code>test_tag_page</code> method:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>        <span class="c"># Check the correct template was used</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;blogengine/tag_post_list.html&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s create that template:</p>

<figure class='code'><figcaption><span>templates/blogengine/tag_post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% if object_list %}
</span><span class='line'>            {% for post in object_list %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>            {{ post.text|custom_markdown }}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% if post.category %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-primary&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% if post.tags %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% for tag in post.tags.all %}
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-success&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            {% endfor %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% endfor %}
</span><span class='line'>        {% else %}
</span><span class='line'>            <span class="nt">&lt;p&gt;</span>No posts found<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;pager&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;previous&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;next&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/tag/{{ tag.slug }}/&quot;</span><span class="nt">&gt;</span>RSS feed for tag {{ tag.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>This is virtually identical to the category template. You&rsquo;ll also need to apply this template in the view for the tag list, and pass the tag name through as context data:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TagListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="n">template_name</span> <span class="o">=</span> <span class="s">&#39;blogengine/tag_post_list.html&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Tag</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TagListView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">context</span><span class="p">[</span><span class="s">&#39;tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Tag</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="n">context</span><span class="p">[</span><span class="s">&#39;tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">context</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">26</span> tests in 5.770s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>You may want to do a quick check to ensure your tag feed link works as expected. Time to commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine templates
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented tag feeds&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Moving our templates</h1>

<p>Before we crack on with implementing search, there&rsquo;s one more piece of housekeeping. In Django, templates can be applied at project level or at app level. So far, we&rsquo;ve been storing them in the project, but we would like our app to be as self-contained as possible so it can just be dropped into future projects where we need a blog. That way, it can be easily overridden for specific projects. You can move the folders and update the Git repository at the same time with this command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git mv templates/ blogengine/
</span></code></pre></td></tr></table></div></figure>


<p>We run the tests to make sure nothing untoward has happened:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">26</span> tests in 5.847s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>And we commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git commit -m <span class="s1">&#39;Moved templates&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>git mv</code> updates Git and moves the files, so you don&rsquo;t need to call <code>git add</code>.</p>

<h1>Implementing search</h1>

<p>For our final task today, we will be implementing a very simple search engine. Our requirements are:</p>

<ul>
<li>It should be in the header, to allow for easy access from anywhere in the front end.</li>
<li>It should search the title and text of posts.</li>
</ul>


<p>First, we&rsquo;ll write our tests:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">SearchViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create a post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create another post</span>
</span><span class='line'>        <span class="n">post2</span> <span class="o">=</span> <span class="n">PostFactory</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;This is my *second* blog post&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;My second post&#39;</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="s">&#39;my-second-post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Search for first post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/search?q=first&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the first post is contained in the results</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;My first post&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the second post is not contained in the results</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;My second post&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Search for second post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/search?q=second&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the first post is not contained in the results</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;My first post&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the second post is contained in the results</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;My second post&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t forget to run the tests to make sure they fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..........................F
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_search <span class="o">(</span>blogengine.tests.SearchViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 819, in test_search
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">27</span> tests in 6.919s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>With that done, we can add the search form to the header:</p>

<figure class='code'><figcaption><span>blogengine/templates/blogengine/includes/base.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if lt IE 7]&gt;      &lt;html class=&quot;no-js lt-ie9 lt-ie8 lt-ie7&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 7]&gt;         &lt;html class=&quot;no-js lt-ie9 lt-ie8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 8]&gt;         &lt;html class=&quot;no-js lt-ie9&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="nt">&lt;html</span> <span class="na">class=</span><span class="s">&quot;no-js&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!--&lt;![endif]--&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>{% block title %}My Django Blog{% endblock %}<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;alternate&quot;</span> <span class="na">type=</span><span class="s">&quot;application/rss+xml&quot;</span> <span class="na">title=</span><span class="s">&quot;Blog posts&quot;</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
</span><span class='line'>
</span><span class='line'>        {% load staticfiles %}
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/normalize.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap-theme.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/code.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        <span class="c">&lt;!--[if lt IE 7]&gt;</span>
</span><span class='line'><span class="c">            &lt;p class=&quot;browsehappy&quot;&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href=&quot;http://browsehappy.com/&quot;&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;</span>
</span><span class='line'><span class="c">        &lt;![endif]--&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Add your site or application content here --&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;fb-root&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">js</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;//connect.facebook.net/en_GB/all.js#xfbml=1&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook-jssdk&#39;</span><span class="p">));</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-static-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container-fluid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">class=</span><span class="s">&quot;navbar-toggle&quot;</span> <span class="na">data-toggle=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-target=</span><span class="s">&quot;#header-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/button&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>My Django Blog<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;collapse navbar-collapse&quot;</span> <span class="na">id=</span><span class="s">&quot;header-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav navbar-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        {% load flatpages %}
</span><span class='line'>                        {% get_flatpages as flatpages %}
</span><span class='line'>                        {% for flatpage in flatpages %}
</span><span class='line'>                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ flatpage.url }}&quot;</span><span class="nt">&gt;</span>{{ flatpage.title }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>                        {% endfor %}
</span><span class='line'>                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/&quot;</span><span class="nt">&gt;</span>RSS feed<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>
</span><span class='line'>                        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/search&quot;</span> <span class="na">method=</span><span class="s">&quot;GET&quot;</span> <span class="na">class=</span><span class="s">&quot;navbar-form navbar-left&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;q&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Search...&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-default&quot;</span><span class="nt">&gt;</span>Search<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% block header %}
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;h1&gt;</span>My Django Blog<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endblock %}
</span><span class='line'>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                {% block content %}{% endblock %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container footer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;p&gt;</span>Copyright <span class="ni">&amp;copy;</span> {% now &quot;Y&quot; %}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;script src=&quot;{% static &#39;</span><span class="nx">bower_components</span><span class="o">/</span><span class="nx">html5</span><span class="o">-</span><span class="nx">boilerplate</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">vendor</span><span class="o">/</span><span class="nx">jquery</span><span class="o">-</span><span class="mf">1.10</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">js</span><span class="s1">&#39; %}&quot;&gt;&lt;\/script&gt;&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/plugins.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/js/bootstrap.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site&#39;s ID. --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span>
</span><span class='line'>            <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">GoogleAnalyticsObject</span><span class="o">=</span><span class="nx">l</span><span class="p">;</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">=</span>
</span><span class='line'>            <span class="kd">function</span><span class="p">(){(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)});</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">l</span><span class="o">=+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">e</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span><span class="nx">r</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="nx">e</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;//www.google-analytics.com/analytics.js&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">r</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">)}(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;ga&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span><span class="s1">&#39;UA-XXXXX-X&#39;</span><span class="p">);</span><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span><span class="s1">&#39;pageview&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;ll actually implement our search. Implementing search using Django&rsquo;s generic views can be fiddly, so we&rsquo;ll write our search view as a function instead. First, amend the imports at the top of your view file to look like this:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render_to_response</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span><span class="p">,</span> <span class="n">EmptyPage</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.syndication.views</span> <span class="kn">import</span> <span class="n">Feed</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_unicode</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">markdown2</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, add the following code to the end of the file:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">getSearchResults</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Search for a post by title or text</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="c"># Get the query data</span>
</span><span class='line'>    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Query the database</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
</span><span class='line'>        <span class="n">results</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">text__icontains</span><span class="o">=</span><span class="n">query</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">title__icontains</span><span class="o">=</span><span class="n">query</span><span class="p">))</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="n">results</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add pagination</span>
</span><span class='line'>    <span class="n">pages</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Get specified page</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">returned_page</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span class='line'>    <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
</span><span class='line'>        <span class="n">returned_page</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">pages</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Display the search results</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;blogengine/search_post_list.html&#39;</span><span class="p">,</span>
</span><span class='line'>                              <span class="p">{</span><span class="s">&#39;page_obj&#39;</span><span class="p">:</span> <span class="n">returned_page</span><span class="p">,</span>
</span><span class='line'>                               <span class="s">&#39;object_list&#39;</span><span class="p">:</span> <span class="n">returned_page</span><span class="o">.</span><span class="n">object_list</span><span class="p">,</span>
</span><span class='line'>                               <span class="s">&#39;search&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>As this is the first time we&rsquo;ve written a view without using generic views, a little explanation is called for. First we get the values of the <code>q</code> and <code>page</code> parameters passed to the view. <code>q</code> contains the query text and <code>page</code> contains the page number. Note also that our page defaults to 1 if not set.</p>

<p>We then use the Q object to perform a query. The Django ORM will <code>AND</code> together keyword argument queries, but that&rsquo;s not the behaviour we want here. Instead we want to be able to search for content in the title or text, so we need to use a query with an <code>OR</code> statement, which necessitates using the <a href="https://docs.djangoproject.com/en/dev/topics/db/queries/#complex-lookups-with-q-objects">Q</a> object.</p>

<p>Next, we use the <code>Paginator</code> object to manually paginate the results, and if it raises an <code>EmptyPage</code> exception, to just show the last page instead. Finally we render the template <code>blogengine/search_post_list.html</code>, and pass through the parameters <code>page_obj</code> for the returned page, <code>object_list</code> for the objects, and <code>search</code> for the query.</p>

<p>We also need to add a route for our new view:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'>    <span class="c"># Search posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^search&#39;</span><span class="p">,</span> <span class="s">&#39;blogengine.views.getSearchResults&#39;</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, let&rsquo;s create a new template to show our results:</p>

<figure class='code'><figcaption><span>blogengine/templates/blogengine/search_post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% if object_list %}
</span><span class='line'>            {% for post in object_list %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>            {{ post.text|custom_markdown }}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% if post.category %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-primary&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% if post.tags %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% for tag in post.tags.all %}
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-success&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            {% endfor %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% endfor %}
</span><span class='line'>        {% else %}
</span><span class='line'>            <span class="nt">&lt;p&gt;</span>No posts found<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;pager&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;previous&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/search?page={{ page_obj.previous_page_number }}&amp;q={{ search }}&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;next&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/search?page={{ page_obj.next_page_number }}&amp;q={{ search }}&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py <span class="nb">test</span>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>...........................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">27</span> tests in 6.421s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t forget to do a quick sense check to make sure it&rsquo;s all working as expected. Then it&rsquo;s time to commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented search&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And push up your changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git push origin master
</span><span class='line'>git push heroku master
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s the end of this instalment. Please note this particular search solution is quite basic, and if you want something more powerful, you may want to look at <a href="http://haystacksearch.org/">Haystack</a>.</p>

<p>As usual, you can get this lesson with <code>git checkout lesson-7</code> - if you have any problems, the <a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">repository</a> should be the first place you look for answers as this is the working code base for the application, and with judicious use of a tool like <code>diff</code>, it&rsquo;s generally pretty easy to track down most issues.</p>

<p>In our next, and final instalment, we&rsquo;ll cover:</p>

<ul>
<li>Tidying everything up</li>
<li>Implementing an XML sitemap for search engines</li>
<li>Optimising our site</li>
<li>Using Fabric to make deployment easier</li>
</ul>


<p>Hope to see you then!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/25/django-blog-tutorial-the-next-generation-part-6/">Django Blog Tutorial - the Next Generation - Part 6</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-05-25T17:23:28+01:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:23 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Welcome back! In this tutorial we&rsquo;ll cover the following:</p>

<ul>
<li>Fixing bugs the TDD way</li>
<li>Setting up syntax highlighting for code snippets</li>
<li>Tidying up the front end</li>
</ul>


<p>Apologies, but I&rsquo;m holding over implementing the search and additional feeds for a future instalment - in the past I&rsquo;ve tried to cover too much in one post and that has led to me putting them off for much too long. So this instalment and future ones are going to be shorter so I can get them out the door quicker.</p>

<p>Ready? Let&rsquo;s get started!</p>

<h1>Fixing bugs</h1>

<p>When someone reports a bug, it&rsquo;s tempting to just dive straight in and start fixing it. But TDD cautions us against this practice. If we have a bug, then our tests should have caught it. If they don&rsquo;t, then before we fix the bug, we have to make sure we can catch it if it crops up in future by implementing a test for it, and ensuring that it fails. Once that test is in place, we can then go ahead and fix the bug, safe in the knowledge that if it should reappear in future, we will be warned when our tests run.</p>

<p>As it happens, we have a bug in our web app. If you activate your virtualenv in the usual way and run the development server, and then try to create a new post without adding a tag, you&rsquo;ll see that it fails as the tag is empty. Now, it&rsquo;s pretty obvious that this is because the <code>tags</code> attribute of the <code>Post</code> model cannot be blank, so we have a good idea of what we need to do to fix this. But to make sure it never occurs again, we need to implement a test first.</p>

<p>Add the following method to <code>AdminTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post_without_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post now in database</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is virtually identical to our previous method for adding a post, but doesn&rsquo;t add a tag to the post. If you run <code>python manage.py jenkins</code>, the test should fail. Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/tests.py
</span><span class='line'>git commit -m <span class="s1">&#39;Added failing test for posts without tags&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;re in a position to fix our bug. Let&rsquo;s take a look at our models:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you compare <code>category</code> and <code>tags</code>, you&rsquo;ll immediately see that <code>category</code> has the additional parameters <code>blank</code> and <code>null</code> both set to <code>True</code>. So that&rsquo;s what we need to do for <code>tags</code> as well. Amend the model to look like this:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>You shouldn&rsquo;t have to create a migration for this. Let&rsquo;s run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.......................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">23</span> tests in 7.634s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Our tests pass! So we&rsquo;ve fixed our bug, and we&rsquo;ve ensured that if it happens again, we&rsquo;ll catch it. With that done, it&rsquo;s time to commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/models.py
</span><span class='line'>git commit -m <span class="s1">&#39;Fixed a bug with the Post model&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Remember</strong>: Always make the effort to create a test to reproduce your bug before fixing it. That way, you know you can catch it in future.</p>

<h1>Syntax highlighting</h1>

<p>This is one feature that not everyone will want to implement. If you want to be able to show code snippets on your blog, then implementing syntax highlighting is well worth your time. However, if that&rsquo;s not what you want to use your blog for, feel free to skip over this section.</p>

<p>Now, earlier in the series we implemented Markdown support. In Markdown there are two main ways to denote a code block. One is to indent the code by four spaces, while the other is to use <a href="https://help.github.com/articles/github-flavored-markdown#syntax-highlighting">fenced code blocks with syntax highlighting</a>. There are many flavours of Markdown available for Python, and unfortunately the one we&rsquo;ve been using so far doesn&rsquo;t support fenced code blocks, so we&rsquo;ll be switching to one that does.</p>

<p>We also need to be able to generate a suitable stylesheet to highlight the code appropriately. For that, we&rsquo;ll be using <a href="http://pygments.org/">Pygments</a>. So let&rsquo;s first uninstall our existing implementation of Markdown:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip uninstall Markdown
</span></code></pre></td></tr></table></div></figure>


<p>And install the new modules:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install markdown2 Pygments
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t forget to record the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Now, we need to amend our Markdown template tags to use the new version of Markdown:</p>

<figure class='code'><figcaption><span>blogengine/templatetags/custom_markdown.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">markdown2</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.template.defaultfilters</span> <span class="kn">import</span> <span class="n">stringfilter</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_unicode</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>
</span><span class='line'>
</span><span class='line'><span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@register.filter</span><span class="p">(</span><span class="n">is_safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'><span class="nd">@stringfilter</span>
</span><span class='line'><span class="k">def</span> <span class="nf">custom_markdown</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span class='line'>    <span class="n">extras</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;fenced-code-blocks&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">markdown2</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
</span><span class='line'>                                       <span class="n">extras</span> <span class="o">=</span> <span class="n">extras</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>All we do here is change the Markdown module that gets imported, and amend how it is called. Note that we pass through the parameter <code>fenced-code-blocks</code> to enable this functionality.</p>

<p>If you now run the development server and create a post with some code in it (just copy the Ruby example from <a href="https://help.github.com/articles/github-flavored-markdown#syntax-highlighting">here</a>), then view it on the site, you should be able to see that it&rsquo;s in a <code>&lt;code&gt;</code> block. However, it&rsquo;s not highlighted yet. Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add requirements/txt blogengine/templatetags/custom_markdown.py
</span><span class='line'>git commit -m <span class="s1">&#39;Now use Markdown2 to allow for syntax highlighting&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you examine the markup for your code blocks using your browser&rsquo;s developer tools, you&rsquo;ll notice that the code is wrapped in many different spans with various classes. Pygments can generate a CSS file that uses those classes to highlight your code.</p>

<p>First, let&rsquo;s create a folder to store our CSS files in:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir blogengine/static/css
</span></code></pre></td></tr></table></div></figure>


<p>Next, we&rsquo;ll add a blank CSS file for any other styling we may want to apply:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>touch blogengine/static/css/main.css
</span></code></pre></td></tr></table></div></figure>


<p>Then, we generate our CSS file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pygmentize -S default -f html &gt; blogengine/static/css/code.css
</span></code></pre></td></tr></table></div></figure>


<p>We need to include our CSS files in our HTML template:</p>

<figure class='code'><figcaption><span>templates/blogengine/includes/base.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if lt IE 7]&gt;      &lt;html class=&quot;no-js lt-ie9 lt-ie8 lt-ie7&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 7]&gt;         &lt;html class=&quot;no-js lt-ie9 lt-ie8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 8]&gt;         &lt;html class=&quot;no-js lt-ie9&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="nt">&lt;html</span> <span class="na">class=</span><span class="s">&quot;no-js&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!--&lt;![endif]--&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>{% block title %}My Django Blog{% endblock %}<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
</span><span class='line'>
</span><span class='line'>        {% load staticfiles %}
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/normalize.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap-theme.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/code.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        <span class="c">&lt;!--[if lt IE 7]&gt;</span>
</span><span class='line'><span class="c">            &lt;p class=&quot;browsehappy&quot;&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href=&quot;http://browsehappy.com/&quot;&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;</span>
</span><span class='line'><span class="c">        &lt;![endif]--&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Add your site or application content here --&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;fb-root&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">js</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;//connect.facebook.net/en_GB/all.js#xfbml=1&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook-jssdk&#39;</span><span class="p">));</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-static-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;btn btn-navbar&quot;</span> <span class="na">data-toggle=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-target=</span><span class="s">&quot;.nav-collapse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;brand&quot;</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>My Django Blog<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;nav-collapse collapse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% block header %}
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;h1&gt;</span>My Django Blog<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endblock %}
</span><span class='line'>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                {% block content %}{% endblock %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container footer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;p&gt;</span>Copyright <span class="ni">&amp;copy;</span> {% now &quot;Y&quot; %}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;script src=&quot;{% static &#39;</span><span class="nx">bower_components</span><span class="o">/</span><span class="nx">html5</span><span class="o">-</span><span class="nx">boilerplate</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">vendor</span><span class="o">/</span><span class="nx">jquery</span><span class="o">-</span><span class="mf">1.10</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">js</span><span class="s1">&#39; %}&quot;&gt;&lt;\/script&gt;&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/plugins.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/js/bootstrap.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site&#39;s ID. --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span>
</span><span class='line'>            <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">GoogleAnalyticsObject</span><span class="o">=</span><span class="nx">l</span><span class="p">;</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">=</span>
</span><span class='line'>            <span class="kd">function</span><span class="p">(){(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)});</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">l</span><span class="o">=+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">e</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span><span class="nx">r</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="nx">e</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;//www.google-analytics.com/analytics.js&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">r</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">)}(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;ga&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span><span class="s1">&#39;UA-XXXXX-X&#39;</span><span class="p">);</span><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span><span class="s1">&#39;pageview&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you run the development server and reload the page, your code will be highlighted using the default Pygments style. If you don&rsquo;t like it, there are plenty to choose from. Run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pygmentize -L styles
</span></code></pre></td></tr></table></div></figure>


<p>That will list the various styles available. For instance, let&rsquo;s say we want to try the Tango style:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pygmentize -S tango -f html &gt; blogengine/static/css/code.css
</span></code></pre></td></tr></table></div></figure>


<p>If you like the Monokai theme in Sublime Text, there&rsquo;s a Pygments version of that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pygmentize -S monokai -f html &gt; blogengine/static/css/code.css
</span></code></pre></td></tr></table></div></figure>


<p>If you like the Solarized theme, that&rsquo;s not bundled with Pygments, but can be installed separately:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install pygments-style-solarized
</span></code></pre></td></tr></table></div></figure>


<p>Then run this for the light version:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pygmentize -S solarizedlight -f html &gt; blogengine/static/css/code.css
</span></code></pre></td></tr></table></div></figure>


<p>And this for the dark version:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pygmentize -S solarizeddark -f html &gt; blogengine/static/css/code.css
</span></code></pre></td></tr></table></div></figure>


<p>Pick one that you like - I&rsquo;m going to go for the dark version of Solarized.</p>

<p>Note that this doesn&rsquo;t actually change the background colour of the code blocks. You will therefore need to set this manually using the CSS file we created earlier. If you&rsquo;re using Solarized Dark like I am, then this should set it correctly:</p>

<figure class='code'><figcaption><span>blogengine/static/css/main.css</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">div</span><span class="nc">.codehilite</span> <span class="nt">pre</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">background-color</span><span class="o">:</span> <span class="m">#002b36</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re using Solarized Light, then this should be more appropriate:</p>

<figure class='code'><figcaption><span>blogengine/static/css/main.css</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">div</span><span class="nc">.codehilite</span> <span class="nt">pre</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">background-color</span><span class="o">:</span> <span class="m">#fdf6e3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or, if you&rsquo;re using Monokai, black will do:</p>

<figure class='code'><figcaption><span>blogengine/static/css/main.css</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">div</span><span class="nc">.codehilite</span> <span class="nt">pre</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">background-color</span><span class="o">:</span> <span class="m">#000000</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that done, let&rsquo;s record the additional Pygments style:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>And commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add requirements.txt blogengine/static/css/ templates/blogengine/includes/base.html
</span><span class='line'>git commit -m <span class="s1">&#39;Styled code with Solarized Dark&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python manage.py jenkins
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="nv">E</span>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: blogengine.tests <span class="o">(</span>unittest.loader.ModuleImportFailure<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>ImportError: Failed to import <span class="nb">test </span>module: blogengine.tests
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 254, in _find_tests
</span><span class='line'>    <span class="nv">module</span> <span class="o">=</span> self._get_module_from_name<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 232, in _get_module_from_name
</span><span class='line'>    __import__<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 7, in &lt;module&gt;
</span><span class='line'>    import markdown
</span><span class='line'>ImportError: No module named markdown
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">1</span> <span class="nb">test </span>in 0.001s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Whoops! We introduced an error here. If we take a look, we can see that the problem is on line 7, where we import the Markdown module. That makes sense, as we now use a different implementation of Markdown. Fortunately, in Python you can import modules with a different name, which makes this a breeze to fix. Change the line to:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">markdown2</span> <span class="kn">as</span> <span class="nn">markdown</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you run your tests, they should pass. It&rsquo;s important that if a test breaks, you fix it as soon as possible and don&rsquo;t put it off. Let&rsquo;s commit these changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/tests.py
</span><span class='line'>git commit -m <span class="s1">&#39;Fixed a broken test&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our syntax highlighting is now done! If you want to see it in action using the Solarized Dark theme, check out the copy of this blogging engine hosted <a href="http://blog.shellshocked.info/">here</a>.</p>

<h1>Tidying up</h1>

<p>Now that our blog is up and running on Heroku, it could do with a bit of work on the front end to make it look a bit nicer. If you recall, we&rsquo;re using Bootstrap for our front end, so you may want to refer to the documentation for that to give you some ideas on how you want to style your blog.</p>

<p>Bootstrap has a nifty pager class for Next and Previous links, so let&rsquo;s apply that to our post list template:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;pager&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;previous&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;next&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s also add labels to our categories and tags. We&rsquo;ll also place our posts and other content inside proper columns:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% if object_list %}
</span><span class='line'>            {% for post in object_list %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>            {{ post.text|custom_markdown }}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% if post.category %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-primary&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% if post.tags %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% for tag in post.tags.all %}
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-success&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>            {% endfor %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endif %}
</span><span class='line'>            {% endfor %}
</span><span class='line'>        {% else %}
</span><span class='line'>            <span class="nt">&lt;p&gt;</span>No posts found<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;pager&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;previous&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;next&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll also want to tidy up the layout for our individual post pages:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_detail.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ object.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ object.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ object.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        {% if object.category %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ object.category.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-primary&quot;</span><span class="nt">&gt;</span>{{ object.category.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if object.tags %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        {% for tag in object.tags.all %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;label label-success&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h4&gt;</span>Comments<span class="nt">&lt;/h4&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fb-comments&quot;</span> <span class="na">data-href=</span><span class="s">&quot;http://{{ object.site }}{{ object.get_absolute_url }}&quot;</span> <span class="na">data-width=</span><span class="s">&quot;470&quot;</span> <span class="na">data-num-posts=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Time to commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Tidied up post templates&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that done, let&rsquo;s turn our attention to our base template. We&rsquo;ll amend the header to collapse down at smaller screen widths. This is easy to do with Bootstrap:</p>

<figure class='code'><figcaption><span>templates/blogengine/includes/base.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if lt IE 7]&gt;      &lt;html class=&quot;no-js lt-ie9 lt-ie8 lt-ie7&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 7]&gt;         &lt;html class=&quot;no-js lt-ie9 lt-ie8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 8]&gt;         &lt;html class=&quot;no-js lt-ie9&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if gt IE 8]&gt;&lt;!--&gt;</span> <span class="nt">&lt;html</span> <span class="na">class=</span><span class="s">&quot;no-js&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!--&lt;![endif]--&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>{% block title %}My Django Blog{% endblock %}<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;alternate&quot;</span> <span class="na">type=</span><span class="s">&quot;application/rss+xml&quot;</span> <span class="na">title=</span><span class="s">&quot;Blog posts&quot;</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span>
</span><span class='line'>
</span><span class='line'>        {% load staticfiles %}
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/normalize.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/css/bootstrap-theme.min.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/main.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;{% static &#39;css/code.css&#39; %}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        <span class="c">&lt;!--[if lt IE 7]&gt;</span>
</span><span class='line'><span class="c">            &lt;p class=&quot;browsehappy&quot;&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href=&quot;http://browsehappy.com/&quot;&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;</span>
</span><span class='line'><span class="c">        &lt;![endif]--&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Add your site or application content here --&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;fb-root&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">js</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">js</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;//connect.facebook.net/en_GB/all.js#xfbml=1&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook-jssdk&#39;</span><span class="p">));</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-static-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container-fluid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">class=</span><span class="s">&quot;navbar-toggle&quot;</span> <span class="na">data-toggle=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-target=</span><span class="s">&quot;#header-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;icon-bar&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/button&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>My Django Blog<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;collapse navbar-collapse&quot;</span> <span class="na">id=</span><span class="s">&quot;header-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav navbar-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        {% load flatpages %}
</span><span class='line'>                        {% get_flatpages as flatpages %}
</span><span class='line'>                        {% for flatpage in flatpages %}
</span><span class='line'>                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ flatpage.url }}&quot;</span><span class="nt">&gt;</span>{{ flatpage.title }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>                        {% endfor %}
</span><span class='line'>                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/feeds/posts/&quot;</span><span class="nt">&gt;</span>RSS feed<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            {% block header %}
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page-header&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;h1&gt;</span>My Django Blog<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            {% endblock %}
</span><span class='line'>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                {% block content %}{% endblock %}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container footer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;p&gt;</span>Copyright <span class="ni">&amp;copy;</span> {% now &quot;Y&quot; %}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;script src=&quot;{% static &#39;</span><span class="nx">bower_components</span><span class="o">/</span><span class="nx">html5</span><span class="o">-</span><span class="nx">boilerplate</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">vendor</span><span class="o">/</span><span class="nx">jquery</span><span class="o">-</span><span class="mf">1.10</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">js</span><span class="s1">&#39; %}&quot;&gt;&lt;\/script&gt;&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/html5-boilerplate/js/plugins.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;{% static &#39;bower_components/bootstrap/dist/js/bootstrap.min.js&#39; %}&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Google Analytics: change UA-XXXXX-X to be your site&#39;s ID. --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script&gt;</span>
</span><span class='line'>            <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">GoogleAnalyticsObject</span><span class="o">=</span><span class="nx">l</span><span class="p">;</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span><span class="o">=</span>
</span><span class='line'>            <span class="kd">function</span><span class="p">(){(</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)});</span><span class="nx">b</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">l</span><span class="o">=+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">e</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span><span class="nx">r</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="nx">e</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;//www.google-analytics.com/analytics.js&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">r</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">)}(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;ga&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span><span class="s1">&#39;UA-XXXXX-X&#39;</span><span class="p">);</span><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span><span class="s1">&#39;pageview&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we&rsquo;ve also added a link to our RSS feed in the header, and another in the page head to facilitate working with browsers that support RSS better.</p>

<p>Our blog&rsquo;s now looking much more presentable. All that remains is to commit it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/blogengine/includes/base.html
</span><span class='line'>git commit -m <span class="s1">&#39;Amended base template&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can push it to GitHub and deploy it on Heroku:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git push origin master
</span><span class='line'>git push heroku master
</span></code></pre></td></tr></table></div></figure>


<p>And we&rsquo;re done! Don&rsquo;t forget, you can grab this lesson with <code>git checkout lesson-6</code>.</p>

<p>Next time, we&rsquo;ll cover search (I promise!).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/24/django-blog-tutorial-the-next-generation-part-5/">Django Blog Tutorial - the Next Generation - Part 5</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-05-24T20:15:54+01:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:15 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello again! I was originally planning to cover implementing a search system, adding more feeds, and tidying up the front end in this instalment. However, I felt it was time for a change of pace, so instead, we&rsquo;re going to look at:</p>

<ul>
<li>Checking code coverage and getting it to 100%</li>
<li>Using continuous integration</li>
<li>Deploying to Heroku</li>
</ul>


<p>Don&rsquo;t worry, the original lesson isn&rsquo;t going anywhere. We&rsquo;ll still be implementing all of that later on, but today is the day we get your Django blog up and running on the web. That way, you can get a better idea of how Django works in the wild, and you have something concrete to show for your efforts.</p>

<h1>Continuous integration</h1>

<p>If you&rsquo;re not familiar with continuous integration, it&rsquo;s basically a process that carries out some tasks automatically when you push a new commit to the repository. These tasks may include running unit tests, linting your code, and checking it to see what percentage of the code base is covered by the tests (after all, if your tests don&rsquo;t actually cover every scenario, then there&rsquo;s more of a chance that something might slip through the net. It&rsquo;s also possible to implement hooks to automatically deploy your application only if the tests pass.</p>

<p>Typically, you will have a continuous integration server running somewhere that regularly polls your Git repository for changes, and when it finds a new commit, will check it out and run the tests (or whatever other task you configure it to). One of the most popular continuous integration servers around is <a href="http://jenkins-ci.org/">Jenkins</a> - I use it at work and can highly recommend it. However, we aren&rsquo;t going to cover using Jenkins here because setting it up is quite a big deal and it really is best kept on a server of its own (although feel free to use it if you prefer). Instead, we&rsquo;re going to use <a href="https://travis-ci.org/">Travis CI</a>, which integrates nicely with GitHub and is free for open source projects. If you don&rsquo;t mind your code being publicly available on GitHub, then Travis is a really great way to dip your toe into continuous integration.</p>

<p>NB: You don&rsquo;t have to use continuous integration at all if you don&rsquo;t want to - this isn&rsquo;t a big project so you don&rsquo;t really need it. If you don&rsquo;t want to put your code on GitHub, then feel free to just follow along and not bother pushing your code to GitHub and configuring Travis.</p>

<h1>Code coverage</h1>

<p>As mentioned above, code coverage is a measure of the percentage of the code that is covered by tests. While not infallible, it&rsquo;s a fairly good guide to how comprehensive your tests are. If you have 100% code coverage, you can be fairly confident that your tests are comprehensive enough to catch most errors, so it&rsquo;s a good rule of thumb to aim for 100% test coverage on a project.</p>

<p>So how do we check our test coverage? The <code>coverage</code> Python module is the most common tool for this. There&rsquo;s also a handy Django module called <code>django-jenkins</code>, which is designed to work with Jenkins, but can be used with any continuous integration server, that can not only run your tests, but also check code coverage at the same time. So, make sure your virtualenv is up and running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source </span>venv/bin/activate
</span></code></pre></td></tr></table></div></figure>


<p>Then, run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install coverage django-jenkins
</span></code></pre></td></tr></table></div></figure>


<p>Once that&rsquo;s done, add these to our requirements file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>We now need to configure our Django project to use <code>django-jenkins</code>. Add the following to the bottom of the settings file:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">INSTALLED_APPS</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;django_jenkins&#39;</span><span class="p">,)</span>
</span><span class='line'><span class="n">JENKINS_TASKS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="s">&#39;django_jenkins.tasks.run_pylint&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;django_jenkins.tasks.with_coverage&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="n">PROJECT_APPS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;blogengine&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This adds <code>django-jenkins</code> to our installed apps and tells it to include two additional tasks, besides running the tests. The first task runs Pylint to check our code quality (but we aren&rsquo;t really concerned about that at this point). The second checks the coverage. Finally, we tell <code>django-jenkins</code> that the <code>blogengine</code> app is the only one to be tested.</p>

<p>You&rsquo;ll also want to add the following lines to your <code>.gitignore</code>:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>reports/
</span><span class='line'>htmlcov/
</span></code></pre></td></tr></table></div></figure>


<p>These are the reports generated by <code>django-jenkins</code>, and should not be kept under version control. With that done, it&rsquo;s time to commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .gitignore django_tutorial_blog_ng/ requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Added coverage checking using django-jenkins&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s run our tests. From now on, you&rsquo;ll use the following command to run your tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins
</span></code></pre></td></tr></table></div></figure>


<p>This ensures we check the coverage at the same time. Now, you&rsquo;ll notice that the <code>reports</code> folder has been created, and it will contain three files, including one called <code>coverage.xml</code>. However, XML isn&rsquo;t a very friendly format. Happily, we can easily generate reports in HTML instead:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span></code></pre></td></tr></table></div></figure>


<p>Running this command will create another folder called <code>htmlcov/</code>, and in here you will find your report, nicely formatted as HTML. Open up <code>index.html</code> in your web browser and you should see a file-by-file breakdown of your code coverage. Nice, huh?</p>

<p>Now, if your code so far is largely identical to mine, you&rsquo;ll notice that the model and view files don&rsquo;t have 100% coverage yet. If you click on each one, you&rsquo;ll see a handy line-by-line breakdown of the test coverage for each file. You&rsquo;ll notice that in the views file, the areas of the code for when tags and categories don&rsquo;t exist are highlighted in pink - this tells you that these lines of code are never executed during the tests. So let&rsquo;s fix that.</p>

<p>First, our template needs to be able to handle empty lists.</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% if object_list %}
</span><span class='line'>            {% for post in object_list %}
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>            {{ post.text|custom_markdown }}
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>            {% for tag in post.tags.all %}
</span><span class='line'>            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>            {% endfor %}
</span><span class='line'>            {% endfor %}
</span><span class='line'>        {% else %}
</span><span class='line'>            <span class="nt">&lt;p&gt;</span>No posts found<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/blogengine/post_list.html
</span><span class='line'>git commit -m <span class="s1">&#39;Added a &quot;No posts found&quot; message to post list template&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to write tests to check that we get a &ldquo;No posts found&rdquo; message when we view a tag or category that does not exist. Add the following methods to the class <code>PostViewTest()</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_nonexistent_category_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="n">category_url</span> <span class="o">=</span> <span class="s">&#39;/category/blah/&#39;</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;No posts found&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_nonexistent_tag_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="n">tag_url</span> <span class="o">=</span> <span class="s">&#39;/tag/blah/&#39;</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;No posts found&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span></code></pre></td></tr></table></div></figure>


<p>Assuming they all pass as expected, then your coverage reports will be regenerated. If you reload the coverage report, you should see that your views now have 100% test coverage. Let&rsquo;s commit again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/tests.py
</span><span class='line'>git commit -m <span class="s1">&#39;Views file now has 100% coverage&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, our models still don&rsquo;t have 100% coverage yet. If you look at the breakdown for <code>models.py</code>, you&rsquo;ll see that the line <code>if not self.slug:</code> has only partial coverage, because we missed out setting a slug for the categories and tags in our test. So, let&rsquo;s fix that. In <code>PostTest()</code>, amend the <code>test_create_category()</code> and <code>test_create_tag()</code> methods as follows:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add attributes</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_category</span> <span class="o">=</span> <span class="n">all_categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add attributes</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_tag</span> <span class="o">=</span> <span class="n">all_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span></code></pre></td></tr></table></div></figure>


<p>Then refresh your coverage page, and we should have hit 100% coverage. Excellent news! This means that we can be confident that if any problems get introduced in future, we can pick them up easily. To demonstrate this, let&rsquo;s upgrade our Django install to the latest version and check everything still works as expected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install Django --upgrade
</span></code></pre></td></tr></table></div></figure>


<p>This will upgrade the copy of Django in our virtualenv to the latest version. Then we can run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py jenkins --coverage-html-report<span class="o">=</span>htmlcov
</span></code></pre></td></tr></table></div></figure>


<p>Our tests should still pass, indicating that the upgrade to our Django version does not appear to have broken any functionality. Let&rsquo;s update our <code>requirements.txt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip freeze &gt; requirements.txt
</span><span class='line'>git add requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Upgraded Django version&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Preparing our web app for deployment to Heroku</h1>

<p>As mentioned previously, I&rsquo;m going to assume you plan to deploy your site on <a href="https://www.heroku.com/">Heroku</a>. It has good Django support, and you can quite happily host a blog there using their free tariff. If you&rsquo;d prefer to use another hosting provider, then you should be able to adapt these instructions accordingly.</p>

<p>Now, so far we&rsquo;ve used SQLite as our database for development purposes. However, SQLite isn&rsquo;t really suitable for production purposes. Heroku provide a Postgresql database for each web app, so we will use that. To configure it, open up <code>settings.py</code> and amend the database configuration section to look like this:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, add the following at the end of the file:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># Heroku config</span>
</span><span class='line'><span class="c"># Parse database configuration from $DATABASE_URL</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">dj_database_url</span>
</span><span class='line'><span class="n">DATABASES</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">dj_database_url</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;sqlite:///db.sqlite3&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Honor the &#39;X-Forwarded-Proto&#39; header for request.is_secure()</span>
</span><span class='line'><span class="n">SECURE_PROXY_SSL_HEADER</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class="p">,</span> <span class="s">&#39;https&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Allow all host headers</span>
</span><span class='line'><span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Static asset configuration</span>
</span><span class='line'><span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="s">&#39;staticfiles&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>A little explanation is called for. Remember when we first started out, we installed the <code>django-toolbelt</code> package, which included <code>dj-database-url</code>? Well, here we use the <code>dj_database_url</code> module to get the database from an environment variable set on Heroku. We set a default value so as to fall back to SQLite when that variable is not set. The other settings are required by Heroku.</p>

<p>You may want to run your tests again to ensure everything is still working before committing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/settings.py
</span><span class='line'>git commit -m <span class="s1">&#39;Amended settings to work on desktop and Heroku&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Setting up Continuous Integration and coverage</h1>

<p>Now, as mentioned previously, I&rsquo;ll be demonstrating how to set up Travis CI for our project. Travis CI is only free for open-source projects, so if you don&rsquo;t want to make your code publicly accessible, you may want to use Jenkins instead. I&rsquo;ll leave setting that up and running it as an exercise for the reader, but I recommend a plugin called Cobertura which allows you to publish details of your code&rsquo;s test coverage.</p>

<p>Unfortunately, Travis CI doesn&rsquo;t have the capability to publish your coverage results. Fortunately, you can use <a href="https://coveralls.io/">Coveralls.io</a> to pick up the slack. Like Travis, it&rsquo;s free for open-source projects, and if you host your code on GitHub, it&rsquo;s pretty easy to use.</p>

<p>You can find instructions on setting up a project on Travis CI <a href="http://docs.travis-ci.com/user/getting-started/">here</a>. Once you&rsquo;ve configured it, you&rsquo;ll need to set up your <code>.travis.yml</code> file. This is a simple text file that tells Travis CI how to run your tests. Put the following content in the file:</p>

<figure class='code'><figcaption><span>.travis.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">language</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">python</span>
</span><span class='line'><span class="l-Scalar-Plain">python</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="s">&quot;2.7&quot;</span>
</span><span class='line'><span class="c1"># command to install dependencies</span>
</span><span class='line'><span class="l-Scalar-Plain">install</span><span class="p-Indicator">:</span> <span class="s">&quot;pip</span><span class="nv"> </span><span class="s">install</span><span class="nv"> </span><span class="s">-r</span><span class="nv"> </span><span class="s">requirements.txt&quot;</span>
</span><span class='line'><span class="c1"># command to run tests</span>
</span><span class='line'><span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">coverage run --include=&quot;blogengine/*&quot; --omit=&quot;blogengine/migrations/*&quot; manage.py test blogengine</span>
</span><span class='line'><span class="l-Scalar-Plain">after_success</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">coveralls</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, this tells Travis that this is a Python application, and we should be using Python 2.7. Please note you can test against multiple versions of Python if you wish - just add another line with the Python version you want to test against.</p>

<p>Then, we see that we use Pip to install our requirements. Finally we run our tests with Coverage, in order to generate coverage data, and afterwards call <code>coveralls</code> to pass the coverage data to Coveralls.io.</p>

<p>We also need to install the <code>coveralls</code> module:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install coveralls
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>And we need to keep our coverage data out of version control:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>env/
</span><span class='line'>*.pyc
</span><span class='line'>db.sqlite3
</span><span class='line'>blogengine/static/bower_components/
</span><span class='line'>reports/
</span><span class='line'>htmlcov/
</span><span class='line'>.coverage
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll also want to set up your project on Coveralls, as described <a href="https://coveralls.io/docs">here</a> - please note that this requires your project be in a public GitHub repository.</p>

<p>With that done, let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .gitignore .travis.yml requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;Added Travis config file and Coveralls support&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that done, assuming you have Travis CI and Coveralls configured, and your code is already hosted on GitHub, then you should be able to just push your code up to trigger the build:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git push origin master
</span></code></pre></td></tr></table></div></figure>


<p>If you keep an eye on Travis in your browser, you can watch what happens as your tests are run. If for any reason the build fails, then it shouldn&rsquo;t be too hard to figure out what has gone wrong using the documentation for Travis and Coveralls - both services are pretty easy to use.</p>

<p>Congratulations - you&rsquo;re now using Continuous Integration! That wasn&rsquo;t so hard, was it? Now, every time you push to GitHub, Travis will run your tests, and you&rsquo;ll get an email if they fail, giving you early warning of any problems, and you can check your coverage at the same time. Both Travis and Coveralls offer that you can place in your README file on GitHub to show off your coverage and build status - feel free to add these to your repo.</p>

<p>You may want to try making a change that breaks your tests and committing it, then pushing it up, so that you can see what happens when the build breaks.</p>

<h1>Deploying to Heroku</h1>

<p>Our final task today is deploying our blog to Heroku so we can see it in action. First of all, if you don&rsquo;t already have an account with Heroku, you&rsquo;ll need to sign up <a href="https://www.heroku.com/">here</a>. You should also be prompted to install the Heroku toolbelt. Once that&rsquo;s done, run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku login
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll be prompted for your credentials - enter these and you should be able to log in successfully.</p>

<p>Now, in order to run our Django app on Heroku, we&rsquo;ll need to add a <code>Procfile</code> to tell Heroku what command to run in order to start your app. In this case, we will be using Gunicorn as our web server. Assuming our project is called <code>django_tutorial_blog_ng</code>, this is what you need to put in this file:</p>

<figure class='code'><figcaption><span>Procfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>web: gunicorn django_tutorial_blog_ng.wsgi
</span></code></pre></td></tr></table></div></figure>


<p>That tells Heroku that the file we need to run for this application is <code>django_tutorial_blog_ng/wsgi.py</code>. To test it, run the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>foreman start
</span></code></pre></td></tr></table></div></figure>


<p>That will start our web server on port 5000, using Gunicorn rather than the Django development server. You should be able to see it in action <a href="http://127.0.0.1:5000/">here</a>, but you&rsquo;ll notice a very serious issue - namely that the static files aren&rsquo;t being served. Now, Django has a command called <code>collectstatic</code> that collects all the static files and drops them into one convenient folder. Heroku will run this command automatically, so we need to ensure our static files are available. Amend your <code>.gitignore</code> file so it no longer excludes our static files:</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>venv/
</span><span class='line'>*.pyc
</span><span class='line'>db.sqlite3
</span><span class='line'>reports/
</span><span class='line'>htmlcov/
</span><span class='line'>.coverage
</span></code></pre></td></tr></table></div></figure>


<p>We also need to amend our wsgi.py to serve static files:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/wsgi.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s">&quot;django_tutorial_blog_ng.settings&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.core.wsgi</span> <span class="kn">import</span> <span class="n">get_wsgi_application</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">dj_static</span> <span class="kn">import</span> <span class="n">Cling</span>
</span><span class='line'>
</span><span class='line'><span class="n">application</span> <span class="o">=</span> <span class="n">Cling</span><span class="p">(</span><span class="n">get_wsgi_application</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>This should solve our problem. Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add django_tutorial_blog_ng/wsgi.py Procfile blogengine/static/ .gitignore
</span><span class='line'>git commit -m <span class="s1">&#39;Configured app for deployment on Heroku&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;re ready to deploy our app!</p>

<h1>Deployment</h1>

<p>Every Heroku app needs a unique name. If you don&rsquo;t specify one, then Heroku will generate one for you. Your app will have the domain name <code>appname.herokuapp.com</code> - however, if you already have a domain name lined up for your blog, you can point that domain name at the Heroku app if you wish. I&rsquo;m going to deploy mine with the name <code>blog-shellshocked-info</code>.</p>

<p>You also need to consider where you want to deploy it. Heroku has two regions - North America and EU. By default it will deploy to North America, but as I&rsquo;m in the EU, that&rsquo;s where I want to deploy my app to - obviously if you&rsquo;re in the Americas, you may be better off sticking with North America.</p>

<p>So, let&rsquo;s create our app. Here&rsquo;s the command you need to run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku apps:create blog-shellshocked-info --region eu
</span></code></pre></td></tr></table></div></figure>


<p>You will want to change the app name, or remove it entirely if you&rsquo;re happy for Heroku to generate one for you. If you want to host it in North America, drop the <code>--region eu</code> section.</p>

<p>Once completed, this will have created your new app, and added a Git remote for it, but will not have deployed it. To deploy your app, run this command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git push heroku master
</span></code></pre></td></tr></table></div></figure>


<p>That will push your code up to Heroku. Please note that building the app may take a little while. Once it&rsquo;s done, you can run <code>heroku open</code> to open it in your web browser. You should see an error message stating that the relation <code>blogengine_post</code> does not exist. That&rsquo;s because we need to create our database structure. Heroku allows you to easily run commands on your app with <code>heroku run</code>, so let&rsquo;s create our database and run our migrations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>heroku run python manage.py syncdb
</span><span class='line'>heroku run python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>These are exactly the same commands you would run locally to create your database, but prefaced with <code>heroku run</code> so that they get run by Heroku. As usual, you will be prompted to create a superuser - you&rsquo;ll want to do this so you can log into the admin.</p>

<p>That&rsquo;s all for today! We&rsquo;ve finally got our site up and running on Heroku, and set up continuous integration so our tests will get run for us. You can see an example of the site working <a href="http://blog.shellshocked.info/">here</a>. As usual, you can check out the latest version of the code with <code>git checkout lesson-5</code>. If you&rsquo;d like a homework assignment, then take a look at <a href="http://docs.travis-ci.com/user/deployment/heroku/">automating deployment to Heroku on successful builds</a> and see if you can get it set up successfully.</p>

<p>Next time around, we&rsquo;ll get back to implementing our search and tidying up the front end. See you then!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/15/django-blog-tutorial-the-next-generation-part-4/">Django Blog Tutorial - the Next Generation - Part 4</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-15T17:45:00+00:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:45 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello again! As promised, in this instalment we&rsquo;ll implement categories and tags, as well as an RSS feed.</p>

<p>As usual, we need to switch into our virtualenv:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source </span>venv/bin/activate
</span></code></pre></td></tr></table></div></figure>


<h2>Categories</h2>

<p>It&rsquo;s worth taking a little time at this point to set out what we mean by categories and tags in this case, as the two can be very similar. In this case, we&rsquo;ll use the following criteria:</p>

<ul>
<li>A post can have only one category, or none, but a category can be applied to any number of posts</li>
<li>A post can have any number of tags, and a tag can be applied to any number of posts</li>
</ul>


<p>If you&rsquo;re not too familiar with relational database theory, the significance of this may not be apparent, so here&rsquo;s a quick explanation. Because the categories are limited to one per post, the relationship between a post and a category is known as <em>one-to-many</em>. In other words, one post can only have one category, but one category can have many posts. You can therefore define the categories in one table in your database, and refer to them by their ID (the reference to the category in the post table is referred to as a <em>foreign key</em>).</p>

<p>As usual, we will write a test first. Open up <code>blogengine/tests.py</code> and edit the line importing the <code>Post</code> model as follows:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span>
</span></code></pre></td></tr></table></div></figure>


<p>Also, add the following method before <code>test_create_post</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c">#Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Add attributes</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Save it</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Check we can find it</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_category</span> <span class="o">=</span> <span class="n">all_categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This test checks that we can create categories. But categories aren&rsquo;t much use unless we can actually apply them to our posts. So we need to edit our <code>Post</code> model as well, and to do so we need to have a test in place first. Edit the <code>test_create_post</code> method as follows:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c">#Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Set the attributes</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&#39;testuser&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>What we&rsquo;re doing here is adding a <code>category</code> attribute to the posts. This attribute contains a reference to a <code>Category</code> object.</p>

<p>Now, we also want to test adding, editing, and deleting a category from the admin interface. Add this code to the <code>AdminTest</code> class:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new category</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;python&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new category now in database</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_edit_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the category</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;perl&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check category amended</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_category</span> <span class="o">=</span> <span class="n">all_categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;perl&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Perl programming language&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_delete_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the category</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/category/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Check category deleted</span>
</span><span class='line'>    <span class="n">all_categories</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_categories</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is very similar to the prior code for the posts, and just checks we can create categories via the admin. We also need to check we can apply these categories to posts, and that they don&rsquo;t break the existing tests:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post now in database</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-second-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post amended</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post deleted</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we basically take our existing post tests in the admin interface and add the category to them. Finally, we edit the <code>PostViewTest</code> class to include categories:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now it&rsquo;s time to run our tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="nv">E</span>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: blogengine.tests <span class="o">(</span>unittest.loader.ModuleImportFailure<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>ImportError: Failed to import <span class="nb">test </span>module: blogengine.tests
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 254, in _find_tests
</span><span class='line'>    <span class="nv">module</span> <span class="o">=</span> self._get_module_from_name<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 232, in _get_module_from_name
</span><span class='line'>    __import__<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 3, in &lt;module&gt;
</span><span class='line'>    from blogengine.models import Post, Category
</span><span class='line'>ImportError: cannot import name Category
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">1</span> <span class="nb">test </span>in 0.000s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>This is the expected result. We need to create our Category model. So let&rsquo;s do that:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that we add <code>Category</code> before <code>Post</code> - this is because <code>Category</code> is a foreign key in <code>Post</code>, and must be defined in order to be used. Also, note that we add the <code>category</code> attribute as a <code>ForeignKey</code> field, like <code>User</code> and <code>Site</code>, indicating that it is an item in another table being references.</p>

<p>We also allow for <code>category</code> to be blank or null, so the user does not have to apply a category if they don&rsquo;t wish to.</p>

<p>If we run our tests, they should still fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>EEFEEEEE...EE
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_category <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 20, in test_create_category
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 37, in test_create_post
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 215, in test_create_post
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 192, in test_delete_category
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 304, in test_delete_post
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 165, in test_edit_category
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 250, in test_edit_post
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_index <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 353, in test_index
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_post_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 403, in test_post_page
</span><span class='line'>    category.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_category</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 142, in test_create_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">13</span> tests in 3.393s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1, <span class="nv">errors</span><span class="o">=</span>9<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>The category table hasn&rsquo;t yet been created, so we need to use South to create and run the migrations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>If we then run our tests again, some of them will still fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..F.F.F......
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 142, in test_create_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_delete_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 201, in test_delete_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_category <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 175, in test_edit_category
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">13</span> tests in 4.047s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s because we haven&rsquo;t registered the categories in the admin. So, that&rsquo;s our next job:</p>

<figure class='code'><figcaption><span>blogengine/admin.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span><span class='line'>    <span class="n">prepopulated_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,)}</span>
</span><span class='line'>    <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Category</span><span class="p">)</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostAdmin</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we try again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.............
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">13</span> tests in 4.092s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>It passes! Let&rsquo;s do a quick sense check before committing. Run the server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py runserver
</span></code></pre></td></tr></table></div></figure>


<p>If you visit the <a href="http://127.0.0.1:8000/admin/">admin</a>, you&rsquo;ll see the text for category is <code>Categorys</code>, which is incorrect. We also don&rsquo;t have a good representation of the category in the admin. Let&rsquo;s fix that:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;categories&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented categories&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, as yet our categories don&rsquo;t actually do all that much. We would like to be able to:</p>

<ul>
<li>List all posts under a category</li>
<li>Show the post category at the base of the post</li>
</ul>


<p>So, let&rsquo;s implement that. First, as usual, we implement tests first:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">#Check the post category is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">#Check the post category is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>All we do here is assert that for both the post pages and the index, the text from the category name is shown in the response. We also need to check the category-specific route works. Add this method to <code>PostViewTest</code>:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_category_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Get the category URL</span>
</span><span class='line'>    <span class="n">category_url</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Fetch the category</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the category name is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post text is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post date is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is very similar to the previous tests, but fetches the absolute URL for the category, and ensures the category name and post content are shown. Now, let&rsquo;s run our new tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>...........EFF
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_category_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 494, in test_category_page
</span><span class='line'>    <span class="nv">category_url</span> <span class="o">=</span> post.category.get_absolute_url<span class="o">()</span>
</span><span class='line'>AttributeError: <span class="s1">&#39;Category&#39;</span> object has no attribute <span class="s1">&#39;get_absolute_url&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_index <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 391, in test_index
</span><span class='line'>    self.assertTrue<span class="o">(</span>post.category.name in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_post_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 446, in test_post_page
</span><span class='line'>    self.assertTrue<span class="o">(</span>post.category.name in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">14</span> tests in 5.017s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>2, <span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s take a look at why they failed. <code>test_category_page</code> failed because the <code>Category</code> object had no method <code>get_absolute_url</code>. So we need to implement one. To do so, we really need to add a slug field, like the posts already have. Ideally, we want this to be populated automatically, but with the option to create one manually. So, edit the models as follows:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils.text</span> <span class="kn">import</span> <span class="n">slugify</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your models here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/category/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;categories&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;re adding the <code>slug</code> attribute to the <code>Category</code> model here. However, we&rsquo;re also overriding the <code>save</code> method to detect if the slug is set, and if not, to create a slug using the <code>slugify</code> function, and set it as the category&rsquo;s slug. We also define an absolute URL for the category.</p>

<p>Now, if you run the tests, they will fail because we haven&rsquo;t made the changes to the database. So, we use South again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span></code></pre></td></tr></table></div></figure>


<p>Then run the migration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Now, running our tests will show that the tables are in place, but we still have some work to do. The index and post pages don&rsquo;t show our categories, so we&rsquo;ll fix that. First, we&rsquo;ll fix our post list:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Next, we&rsquo;ll take care of our post detail page:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_detail.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ object.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ object.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ object.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ object.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ object.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;h4&gt;</span>Comments<span class="nt">&lt;/h4&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fb-comments&quot;</span> <span class="na">data-href=</span><span class="s">&quot;http://{{ post.site }}{{ post.get_absolute_url }}&quot;</span> <span class="na">data-width=</span><span class="s">&quot;470&quot;</span> <span class="na">data-num-posts=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>Note that in both cases we include a link to the category URL.</p>

<p>Now, we should only have one failing test outstanding - the category page. For this, generic views aren&rsquo;t sufficient as we need to limit the queryset to only show those posts with a specific category. Fortunately, we can extend Django&rsquo;s generic views to add this functionality. First, we edit our URLconfs:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Individual posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Categories</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Category</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note we import a new view from <code>blogengine.views</code> called <code>CategoryListView</code>. Next, we create that listview:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your views here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is quite simple. We import the <code>ListView</code>, as well as our models. Then we extend <code>ListView</code> by getting the slug from the request, fetching the appropriate category, and returning only those posts that have that category. If the category does not exist, we return the empty <code>Post</code> object list. We haven&rsquo;t had to set the template manually as it is inherited from <code>ListView</code>.</p>

<p>If you run the tests, they should now pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..............
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">14</span> tests in 5.083s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>So let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ templates/
</span><span class='line'>git commit -m <span class="s1">&#39;Categories are now shown&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Tags</h2>

<p>Tags are fairly similar to categories, but more complex. The relationship they have is called <em>many-to-many</em> - in other words, a tag can be applied to many posts, and one post can have many tags. This is more difficult to model with a relational database. The usual way to do so is to create an intermediate table between the posts and tags, to identify mappings between the two. Fortunately, Django makes this quite easy.</p>

<p>Let&rsquo;s write the tests for our tagging system. As with the categories, we&rsquo;ll write the tests for creating and editing them first, and add in tests for them being visible later. First we&rsquo;ll create a test for creating a new tag object:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Add attributes</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_tag</span> <span class="o">=</span> <span class="n">all_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, we&rsquo;ll amend the test for creating a post to include tags:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Set the attributes</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Save it</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add the tag</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check we can find it</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check attributes</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My first post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my first blog post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="s">&#39;example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&#39;testuser&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#Check tags</span>
</span><span class='line'>    <span class="n">post_tags</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post_tag</span> <span class="o">=</span> <span class="n">post_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post_tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;python&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Python programming language&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note the difference in how we apply the tags. Because a post can have more than one tag, we can&rsquo;t just define <code>post.tag</code> in the same way. Instead, we have <code>post.tags</code>, which you can think of as a list, and we use the <code>add</code> method to add a new tag. Note also that the post must already exist before we can add a tag.</p>

<p>We also need to create acceptance tests for creating, editing and deleting tags:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new tag</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;python&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new tag now in database</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_edit_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the tag</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;perl&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>        <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check tag amended</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_tag</span> <span class="o">=</span> <span class="n">all_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;perl&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_tag</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;The Perl programming language&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_delete_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the tag</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/tag/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check tag deleted</span>
</span><span class='line'>    <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_tags</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>These tests are virtually identical to those for the <code>Category</code> objects, as we plan for our <code>Tag</code> objects to be very similar. Finally, we need to amend the acceptance tests for <code>Post</code> objects to include a tag:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check response code</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the new post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my first post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-first-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;tags&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check added successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;added successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post now in database</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_edit_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Edit the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;My second post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;text&#39;</span><span class="p">:</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2013-12-28&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;pub_date_1&#39;</span><span class="p">:</span> <span class="s">&#39;22:00:04&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;my-second-post&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;site&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;category&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;tags&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check changed successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;changed successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post amended</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;My second post&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;This is my second blog post&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_delete_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the category</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Log in</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;bobsmith&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Delete the post</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/admin/blogengine/post/1/delete/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span>
</span><span class='line'>    <span class="p">},</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check deleted successfully</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;deleted successfully&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check post deleted</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we&rsquo;re just adding tags to our <code>Post</code> objects.</p>

<p>Now it&rsquo;s time to run our tests to make sure they fail as expected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'><span class="nv">E</span>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: blogengine.tests <span class="o">(</span>unittest.loader.ModuleImportFailure<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>ImportError: Failed to import <span class="nb">test </span>module: blogengine.tests
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 254, in _find_tests
</span><span class='line'>    <span class="nv">module</span> <span class="o">=</span> self._get_module_from_name<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/loader.py&quot;</span>, line 232, in _get_module_from_name
</span><span class='line'>    __import__<span class="o">(</span>name<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 3, in &lt;module&gt;
</span><span class='line'>    from blogengine.models import Post, Category, Tag
</span><span class='line'>ImportError: cannot import name Tag
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">1</span> <span class="nb">test </span>in 0.000s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">errors</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>So here we can&rsquo;t import our <code>Tag</code> model, because we haven&rsquo;t created it. So, we&rsquo;ll do that:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/tag/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our <code>Tag</code> model is very much like our <code>Category</code> model, but we don&rsquo;t need to change the <code>verbose_name_plural</code> value, and we amend the absolute URL to show it as a tag rather than a category.</p>

<p>We also need to amend our <code>Post</code> model to include a <code>tags</code> field:</p>

<figure class='code'><figcaption><span>blogengine/models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class='line'>    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span>
</span><span class='line'>    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-pub_date&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>tags</code> is a <code>ManyToManyField</code>, and we pass through the model we wish to use, much like we did with the categories. The difference is that one tag can be applied to many posts and a post can have many tags, so we need an intermediate database table to handle the relationship between the two. With Django&rsquo;s ORM we can handle this quickly and easily.</p>

<p>Run our tests and they should still fail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.EE.EF.EE.EE......
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 64, in test_create_post
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_tag <span class="o">(</span>blogengine.tests.PostTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 41, in test_create_tag
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_create_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 335, in test_create_post
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 440, in test_delete_post
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_delete_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 306, in test_delete_tag
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_post <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 377, in test_edit_post
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>ERROR: test_edit_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 279, in test_edit_tag
</span><span class='line'>    tag.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/models.py&quot;</span>, line 34, in save
</span><span class='line'>    super<span class="o">(</span>Tag, self<span class="o">)</span>.save<span class="o">()</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 545, in save
</span><span class='line'>    <span class="nv">force_update</span><span class="o">=</span>force_update, <span class="nv">update_fields</span><span class="o">=</span>update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 573, in save_base
</span><span class='line'>    <span class="nv">updated</span> <span class="o">=</span> self._save_table<span class="o">(</span>raw, cls, force_insert, force_update, using, update_fields<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 654, in _save_table
</span><span class='line'>    <span class="nv">result</span> <span class="o">=</span> self._do_insert<span class="o">(</span>cls._base_manager, using, fields, update_pk, raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/base.py&quot;</span>, line 687, in _do_insert
</span><span class='line'>    <span class="nv">using</span><span class="o">=</span>using, <span class="nv">raw</span><span class="o">=</span>raw<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py&quot;</span>, line 232, in _insert
</span><span class='line'>    <span class="k">return</span> insert_query<span class="o">(</span>self.model, objs, fields, **kwargs<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py&quot;</span>, line 1511, in insert_query
</span><span class='line'>    <span class="k">return</span> query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>return_id<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/sql/compiler.py&quot;</span>, line 898, in execute_sql
</span><span class='line'>    cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/utils.py&quot;</span>, line 99, in __exit__
</span><span class='line'>    six.reraise<span class="o">(</span>dj_exc_type, dj_exc_value, traceback<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/util.py&quot;</span>, line 53, in execute
</span><span class='line'>    <span class="k">return</span> self.cursor.execute<span class="o">(</span>sql, params<span class="o">)</span>
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&quot;</span>, line 450, in execute
</span><span class='line'>    <span class="k">return</span> Database.Cursor.execute<span class="o">(</span>self, query, params<span class="o">)</span>
</span><span class='line'>OperationalError: no such table: <span class="nv">blogengine_tag</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 256, in test_create_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">18</span> tests in 3.981s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1, <span class="nv">errors</span><span class="o">=</span>7<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Again, we can easily see why they failed - the <code>blogengine_tag</code> table is not in place. So let&rsquo;s create and run our migrations to fix that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python manage.py schemamigration --auto blogengine
</span><span class='line'>python manage.py migrate
</span></code></pre></td></tr></table></div></figure>


<p>Now, we run our tests again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>.....F..F..F......
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_create_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 256, in test_create_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_delete_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 315, in test_delete_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> <span class="nv">200</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_edit_tag <span class="o">(</span>blogengine.tests.AdminTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 289, in test_edit_tag
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">18</span> tests in 5.124s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>We can&rsquo;t yet amend our tags in the admin, because we haven&rsquo;t registered them. So we do that next:</p>

<figure class='code'><figcaption><span>blogengine/admin.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span><span class='line'>    <span class="n">prepopulated_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,)}</span>
</span><span class='line'>    <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</span><span class='line'>        <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Category</span><span class="p">)</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Tag</span><span class="p">)</span>
</span><span class='line'><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostAdmin</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if we run our tests, they should pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">18</span> tests in 5.444s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Time to commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Implemented tags&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, like with the categories beforehand, we want to be able to show the tags applied to a post at the base of it, and list all posts for a specific tag. So, first of all, we&rsquo;ll amend our <code>PostViewTest</code> class to check for the tags:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostViewTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;perl&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the index</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post category is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post tag is in the response</span>
</span><span class='line'>        <span class="n">post_tag</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post_tag</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_post_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;perl&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Perl programming language&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check new post saved</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the post URL</span>
</span><span class='line'>        <span class="n">post_url</span> <span class="o">=</span> <span class="n">only_post</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the post</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post title is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post category is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post tag is in the response</span>
</span><span class='line'>        <span class="n">post_tag</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post_tag</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post text is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the post date is in the response</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We create a tag near the top, and check for the text in the page (note that to avoid false positives from the categories, we set the name of the tags to something different). We do this on both the index and post pages.</p>

<p>We also need to put a test in place for the tag-specific page:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">test_tag_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Create the tag</span>
</span><span class='line'>    <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>    <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the author</span>
</span><span class='line'>    <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the site</span>
</span><span class='line'>    <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>    <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create the post</span>
</span><span class='line'>    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is [my first blog post](http://127.0.0.1:8000/)&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check new post saved</span>
</span><span class='line'>    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Get the tag URL</span>
</span><span class='line'>    <span class="n">tag_url</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Fetch the tag</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag_url</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the tag name is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post text is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the post date is in the response</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Check the link is marked up properly</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;http://127.0.0.1:8000/&quot;&gt;my first blog post&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, this is virtually identical to the category page, adjusted to allow for the fact that we need to get a specific tag. If we now run our tests, they should fail as expected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>................FFF
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_index <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 540, in test_index
</span><span class='line'>    self.assertTrue<span class="o">(</span>post_tag.name in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_post_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 607, in test_post_page
</span><span class='line'>    self.assertTrue<span class="o">(</span>post_tag.name in response.content<span class="o">)</span>
</span><span class='line'>AssertionError: False is not <span class="nb">true</span>
</span><span class='line'>
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_tag_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 714, in test_tag_page
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">19</span> tests in 5.375s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>3<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>So, we need to implement the following things:</p>

<ul>
<li>Show tags on the index page</li>
<li>Show tags on the post pages</li>
<li>Create a page listing the posts with a specific tag</li>
</ul>


<p>As we have seen already with the categories, this is actually quite simple. First, we&rsquo;ll sort out the tags on the index page:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_list.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        {% for post in object_list %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ post.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ post.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ post.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% for tag in post.tags.all %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>        {% endfor %}
</span><span class='line'>
</span><span class='line'>        {% if page_obj.has_previous %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.previous_page_number }}/&quot;</span><span class="nt">&gt;</span>Previous Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>        {% if page_obj.has_next %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/{{ page_obj.next_page_number }}/&quot;</span><span class="nt">&gt;</span>Next Page<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endif %}
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>This is quite simple. We retrieve all the tags with <code>post.tags.all</code> and loop through them. We then do basically the same for the individual post pages:</p>

<figure class='code'><figcaption><span>templates/blogengine/post_detail.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% extends &quot;blogengine/includes/base.html&quot; %}
</span><span class='line'>
</span><span class='line'>    {% load custom_markdown %}
</span><span class='line'>
</span><span class='line'>    {% block content %}
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h1&gt;</span>{{ object.title }}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{ object.pub_date }}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>        {{ object.text|custom_markdown }}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ object.category.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ object.category.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% for tag in post.tags.all %}
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ tag.get_absolute_url }}&quot;</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        {% endfor %}
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;h4&gt;</span>Comments<span class="nt">&lt;/h4&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fb-comments&quot;</span> <span class="na">data-href=</span><span class="s">&quot;http://{{ post.site }}{{ post.get_absolute_url }}&quot;</span> <span class="na">data-width=</span><span class="s">&quot;470&quot;</span> <span class="na">data-num-posts=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    {% endblock %}
</span></code></pre></td></tr></table></div></figure>


<p>This should resolve two of our outstanding tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..................F
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_tag_page <span class="o">(</span>blogengine.tests.PostViewTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 714, in test_tag_page
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">19</span> tests in 5.440s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>The final test is for the tag pages. As we saw with the categories, we can limit our querysets on specific pages. So we&rsquo;ll extend the <code>ListView</code> generic view again to handle tags:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create your views here.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TagListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="k">except</span> <span class="n">Tag</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that here, <code>Tag</code> objects have access to their assigned <code>Post</code> objects - we just use <code>post_set</code> to refer to them and get all of the posts associated with that tag. Next we&rsquo;ll add the URLconfs:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span><span class="p">,</span> <span class="n">TagListView</span>
</span><span class='line'>
</span><span class='line'><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c"># Index</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;page&gt;\d+)?/?$&#39;</span><span class="p">,</span> <span class="n">ListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Individual posts</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;pub_date__year&gt;\d{4})/(?P&lt;pub_date__month&gt;\d{1,2})/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Post</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Categories</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">CategoryListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Category</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Tags</span>
</span><span class='line'>    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^tag/(?P&lt;slug&gt;[a-zA-Z0-9-]+)/?$&#39;</span><span class="p">,</span> <span class="n">TagListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
</span><span class='line'>        <span class="n">paginate_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span class='line'>        <span class="n">model</span><span class="o">=</span><span class="n">Tag</span><span class="p">,</span>
</span><span class='line'>        <span class="p">)),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We import the <code>Tag</code> model and the <code>TagListView</code> view, and use them to set up the tag page.</p>

<p>If we now run our tests again, they should pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>...................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">19</span> tests in 5.473s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Well done! Time to commit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add templates/ blogengine/
</span><span class='line'>git commit -m <span class="s1">&#39;Tags are now shown&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>RSS Feed</h2>

<p>For the final task today, we&rsquo;ll implement an RSS feed for our posts. Django ships with a handy syndication framework that makes it easy to implement this kind of functionality.</p>

<p>As usual, we&rsquo;ll create some tests first. In this case, we won&rsquo;t be adding any new models, so we don&rsquo;t need to test them. Instead we can jump straight into creating acceptance tests for our feed. For now we&rsquo;ll just create one type of feed: a feed of all the blog posts. In a later instalment we&rsquo;ll add feeds for categories and tags.</p>

<p>First of all, we&rsquo;ll implement our test. Now, in order to test our feed, we need to have a solution in place for parsing an RSS feed. Django won&rsquo;t do this natively, so we&rsquo;ll install the <code>feedparser</code> Python module. Run the following commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pip install feedparser
</span><span class='line'>pip freeze &gt; requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Once that&rsquo;s done, feedparser should be available. You may wish to refer to the <a href="http://pythonhosted.org/feedparser/">documentation</a> as we go to help.</p>

<p>Let&rsquo;s write our test for the RSS feed. First, we import feedparser near the top of the file:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">feedparser</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we define a new class for our feed tests. Put this towards the end of the file - I put it just before the flat page tests:</p>

<figure class='code'><figcaption><span>blogengine/tests.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">FeedTest</span><span class="p">(</span><span class="n">BaseAcceptanceTest</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">test_all_post_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Create the category</span>
</span><span class='line'>        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">()</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">category</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the tag</span>
</span><span class='line'>        <span class="n">tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;The Python programming language&#39;</span>
</span><span class='line'>        <span class="n">tag</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the author</span>
</span><span class='line'>        <span class="n">author</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;testuser&#39;</span><span class="p">,</span> <span class="s">&#39;user@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create the site</span>
</span><span class='line'>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">()</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">&#39;example.com&#39;</span>
</span><span class='line'>        <span class="n">site</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Create a post</span>
</span><span class='line'>        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;My first post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;This is my first blog post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="s">&#39;my-first-post&#39;</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Save it</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Add the tag</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span class='line'>        <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check we can find it</span>
</span><span class='line'>        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_posts</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">only_post</span> <span class="o">=</span> <span class="n">all_posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">only_post</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Fetch the feed</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/feeds/posts/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">#Parse the feed</span>
</span><span class='line'>        <span class="n">feed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check length</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Check post retrieved is the correct one</span>
</span><span class='line'>        <span class="n">feed_post</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">feed_post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">feed_post</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the tests and you&rsquo;ll see something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>..............F.....
</span><span class='line'><span class="o">======================================================================</span>
</span><span class='line'>FAIL: test_all_post_feed <span class="o">(</span>blogengine.tests.FeedTest<span class="o">)</span>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py&quot;</span>, line 781, in test_all_post_feed
</span><span class='line'>    self.assertEquals<span class="o">(</span>response.status_code, 200<span class="o">)</span>
</span><span class='line'>AssertionError: <span class="m">404</span> !<span class="o">=</span> 200
</span><span class='line'>
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">20</span> tests in 6.743s
</span><span class='line'>
</span><span class='line'>FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;re getting a 404 error because the post feed isn&rsquo;t implemented. So let&rsquo;s implement it. We&rsquo;re going to use Django&rsquo;s syndication framework, which will make it easy, but we need to enable it. Open up <code>django_tutorial_blog_ng/settings/py</code> and add the following under <code>INSTALLED_APPS</code>:</p>

<figure class='code'><figcaption><span>django_tutorial_blog_ng/settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="s">&#39;django.contrib.syndication&#39;</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to enable the URLconf for this RSS feed. Open up <code>blogengine/urls.py and amend the import from</code>blogengine.views` near the top:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">blogengine.views</span> <span class="kn">import</span> <span class="n">CategoryListView</span><span class="p">,</span> <span class="n">TagListView</span><span class="p">,</span> <span class="n">PostsFeed</span>
</span></code></pre></td></tr></table></div></figure>


<p>Further down, add in the following code to define the URL for the feed:</p>

<figure class='code'><figcaption><span>blogengine/urls.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#Post RSS feed</span>
</span><span class='line'><span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/posts/$&#39;</span><span class="p">,</span> <span class="n">PostsFeed</span><span class="p">()),</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that we imported the PostsFeed class, but that hasn&rsquo;t yet been defined. So we need to do that. First of all, add this line near the top:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.contrib.syndication.views</span> <span class="kn">import</span> <span class="n">Feed</span>
</span></code></pre></td></tr></table></div></figure>


<p>This imports the syndication views - yes, they&rsquo;re another generic view! Our <code>PostsFeed</code> class is going to inherit from <code>Feed</code>. Next, we define the class:</p>

<figure class='code'><figcaption><span>blogengine/views.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">PostsFeed</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;RSS feed - posts&quot;</span>
</span><span class='line'>    <span class="n">link</span> <span class="o">=</span> <span class="s">&quot;feeds/posts/&quot;</span>
</span><span class='line'>    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;RSS feed - blog posts&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-pub_date&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">item_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">item_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is fairly straightforward. We define our title, link, and description for the feed inside the class definition. We define the <code>items</code> method which sets what items are returned by the RSS feed. We also define the <code>item_title</code> and <code>item_description</code> methods.</p>

<p>Now, if we run our tests, they should pass:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>venv<span class="o">)</span>Smith:django_tutorial_blog_ng matthewdaly<span class="nv">$ </span>python manage.py <span class="nb">test </span>blogengine
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span><span class='line'>....................
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Ran <span class="m">20</span> tests in 5.933s
</span><span class='line'>
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for</span> <span class="nb">alias</span> <span class="s1">&#39;default&#39;</span>...
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s commit our changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add blogengine/ django_tutorial_blog_ng/ requirements.txt
</span><span class='line'>git commit -m <span class="s1">&#39;RSS feed implemented&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s enough for now. Don&rsquo;t forget, you can get the code for this lesson by cloning the repository from <a href="https://github.com/matthewbdaly/django_tutorial_blog_ng">Github</a> and running <code>git checkout lesson-4</code> to switch to this lesson.</p>

<p>Next time we&rsquo;ll:</p>

<ul>
<li>Implement a search system</li>
<li>Add feeds for categories and posts</li>
<li>Tidy up the user interface</li>
</ul>


<p>Hope to see you then!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/09/building-a-url-shortener-with-node-dot-js-and-redis/">Building a URL Shortener With Node.js and Redis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/19/my-django-web-server-setup/">My Django Web Server Setup</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/05/introducing-generator-simple-static-blog/">Introducing Generator-simple-static-blog</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/28/django-blog-tutorial-the-next-generation-part-9/">Django Blog Tutorial - the Next Generation - Part 9</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/28/changing-date-format-from-dd-slash-mm-slash-yyyy-to-yyyy-mm-dd-in-vim/">Changing Date Format From DD/MM/YYYY to YYYY-MM-DD in Vim</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/matthewbdaly">@matthewbdaly</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'matthewbdaly',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Matthew Daly -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'matthewdaly';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
